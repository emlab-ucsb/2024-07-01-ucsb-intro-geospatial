<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Intro to Geospatial Raster and Vector Data: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="assets/images/data-logo.svg">
</div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Intro to Geospatial Raster and Vector Data
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Intro to Geospatial Raster and Vector Data
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Intro to Geospatial Raster and Vector Data
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-rstudio-intro.html">1. Introduction to R and RStudio</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-project-intro.html">2. Project Management With RStudio</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-data-structures-part1.html">3. Data Structures</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-data-structures-part2.html">4. Exploring Data Frames</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-data-subsetting.html">5. Subsetting Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-dplyr.html">6. Data frame Manipulation with dplyr</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-plot-ggplot2.html">7. Introduction to Visualization</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-writing-data.html">8. Writing Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-raster-structure.html">9. Intro to Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-raster-plot.html">10. Plot Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="11-raster-reproject-in-r.html">11. Reproject Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="12-vector-open-shapefile-in-r.html">12. Open and Plot Vector Layers</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="13-vector-shapefile-attributes-in-r.html">13. Explore and Plot by Vector Layer Attributes</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="14-vector-plot-shapefiles-custom-legend.html">14. Plot Multiple Vector and Raster Layers</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="15-vector-when-data-dont-line-up-crs.html">15. Handling Spatial Projection &amp; CRS</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="16-vector-csv-to-shapefile-in-r.html">16. Convert from .csv to a Vector Layer</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush18">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading18">
        <a href="17-vector-raster-integration.html">17. Manipulate Raster Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush19">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading19">
        <a href="18-plot-time-series-rasters-in-r.html">18. Create Publication-quality Graphics</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-rstudio-intro"><p>Content from <a href="01-rstudio-intro.html">Introduction to R and RStudio</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/01-rstudio-intro.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to find your way around RStudio?</li>
<li>How to interact with R?</li>
<li>How to install packages?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the purpose and use of each pane in the RStudio IDE</li>
<li>Locate buttons and options in the RStudio IDE</li>
<li>Define a variable</li>
<li>Assign data to a variable</li>
<li>Use mathematical and comparison operators</li>
<li>Call functions</li>
<li>Manage packages</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="motivation"><h2 class="section-heading">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<hr class="half-width">
<p>Science is a multi-step process: once you’ve designed an experiment
and collected data, the real fun begins! This lesson will teach you how
to start this process using R and RStudio. We will begin with raw data,
perform exploratory analyses, and learn how to plot results graphically.
This example starts with a dataset from <a href="https://www.gapminder.org" class="external-link">gapminder.org</a> containing population
information for many countries through time. Can you read the data into
R? Can you plot the population for Senegal? Can you calculate the
average income for countries on the continent of Asia? By the end of
these lessons you will be able to do things like plot the populations
for all of these countries in under a minute!</p>
</section><section id="before-starting-the-workshop"><h2 class="section-heading">Before Starting The Workshop<a class="anchor" aria-label="anchor" href="#before-starting-the-workshop"></a>
</h2>
<hr class="half-width">
<p>Please ensure you have the latest version of R and RStudio installed
on your machine. This is important, as some packages used in the
workshop may not install correctly (or at all) if R is not up to
date.</p>
<ul>
<li><a href="https://www.r-project.org/" class="external-link">Download and install the latest
version of R here</a></li>
<li><a href="https://www.rstudio.com/" class="external-link">Download and install RStudio
here</a></li>
</ul></section><section id="introduction-to-rstudio"><h2 class="section-heading">Introduction to RStudio<a class="anchor" aria-label="anchor" href="#introduction-to-rstudio"></a>
</h2>
<hr class="half-width">
<p>Throughout this lesson, we’re going to teach you some of the
fundamentals of the R language as well as some best practices for
organizing code for scientific projects that will make your life
easier.</p>
<p>We’ll be using RStudio: a free, open source R integrated development
environment (IDE). It provides a built in editor, works on all platforms
(including on servers) and provides many advantages such as integration
with version control and project management.</p>
<p><strong>Basic layout</strong></p>
<p>When you first open RStudio, you will be greeted by three panels:</p>
<ul>
<li>The interactive R console (entire left)</li>
<li>Environment/History (tabbed in upper right)</li>
<li>Files/Plots/Packages/Help/Viewer (tabbed in lower right)</li>
</ul>
<figure><img src="fig/01-rstudio.png" alt="RStudio layout" class="figure mx-auto d-block"></figure><p>Once you open files, such as R scripts, an editor panel will also
open in the top left.</p>
<figure><img src="fig/01-rstudio-script.png" alt="RStudio layout with .R file open" class="figure mx-auto d-block"></figure></section><section id="workflow-within-rstudio"><h2 class="section-heading">Workflow within RStudio<a class="anchor" aria-label="anchor" href="#workflow-within-rstudio"></a>
</h2>
<hr class="half-width">
<p>There are two main ways one can work within RStudio.</p>
<ol style="list-style-type: decimal">
<li>Test and play within the interactive R console then copy code into a
.R file to run later.</li>
</ol>
<ul>
<li>This works well when doing small tests and initially starting
off.</li>
<li>It quickly becomes laborious</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Start writing in an .R file and use RStudio’s shortcut keys for the
Run command to push the current line, selected lines or modified lines
to the interactive R console.</li>
</ol>
<ul>
<li>This is a great way to start; all your code is saved for later</li>
<li>You will be able to run the file you create from within RStudio or
using R’s <code>source()</code> function.</li>
</ul>
<div id="tip-running-segments-of-your-code" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-running-segments-of-your-code" class="callout-inner">
<h3 class="callout-title">Tip: Running segments of your code<a class="anchor" aria-label="anchor" href="#tip-running-segments-of-your-code"></a>
</h3>
<div class="callout-content">
<p>RStudio offers you great flexibility in running code from within the
editor window. There are buttons, menu choices, and keyboard shortcuts.
To run the current line, you can</p>
<ol style="list-style-type: decimal">
<li>click on the <code>Run</code> button above the editor panel, or</li>
<li>select “Run Lines” from the “Code” menu, or</li>
<li>hit <kbd>Ctrl</kbd>+<kbd>Enter</kbd> in Windows,
<kbd>Ctrl</kbd>+<kbd>Return</kbd> in Linux, or
<kbd>⌘</kbd>+<kbd>Return</kbd> on OS X. (This shortcut can also be seen
by hovering the mouse over the button). To run a block of code, select
it and then <code>Run</code>.</li>
</ol>
</div>
</div>
</div>
</section><section id="introduction-to-r"><h2 class="section-heading">Introduction to R<a class="anchor" aria-label="anchor" href="#introduction-to-r"></a>
</h2>
<hr class="half-width">
<p>Much of your time in R will be spent in the R interactive console.
This is where you will run all of your code, and can be a useful
environment to try out ideas before adding them to an R script file.
This console in RStudio is the same as the one you would get if you
typed in <code>R</code> in your command-line environment.</p>
<p>The first thing you will see in the R interactive session is a bunch
of information, followed by a “&gt;” and a blinking cursor. When you are
running a section of your code, this is the location where R will first
read your code, attempt to execute them, and then returns a result.</p>
</section><section id="using-r-as-a-calculator"><h2 class="section-heading">Using R as a calculator<a class="anchor" aria-label="anchor" href="#using-r-as-a-calculator"></a>
</h2>
<hr class="half-width">
<p>The simplest thing you could do with R is do arithmetic:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">+</span> <span class="fl">100</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 101</code></pre>
</div>
<p>And R will print out the answer, with a preceding “<code>[1]</code>”.
Don’t worry about this for now, we’ll explain that later. For now think
of it as indicating output.</p>
<p>Like bash, if you type in an incomplete command, R will wait for you
to complete it:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">+</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>+</code></pre>
</div>
<p>Any time you hit return and the R session shows a “<code>+</code>”
instead of a “<code>&gt;</code>”, it means it’s waiting for you to
complete the command. If you want to cancel a command you can simply hit
“<kbd>Esc</kbd>” and RStudio will give you back the “<code>&gt;</code>”
prompt.</p>
<div id="tip-cancelling-commands" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-cancelling-commands" class="callout-inner">
<h3 class="callout-title">Tip: Cancelling commands<a class="anchor" aria-label="anchor" href="#tip-cancelling-commands"></a>
</h3>
<div class="callout-content">
<p>If you’re using R from the command line instead of from within
RStudio, you need to use <kbd>Ctrl</kbd>+<kbd>C</kbd> instead of
<kbd>Esc</kbd> to cancel the command. This applies to Mac users as
well!</p>
<p>Cancelling a command isn’t only useful for killing incomplete
commands: you can also use it to tell R to stop running code (for
example if it’s taking much longer than you expect), or to get rid of
the code you’re currently writing.</p>
</div>
</div>
</div>
<p>When using R as a calculator, the order of operations is the same as
you would have learned back in school.</p>
<p>From highest to lowest precedence:</p>
<ul>
<li>Parentheses: <code>(</code> <code>)</code>
</li>
<li>Exponents: <code>^</code> or <code>**</code>
</li>
<li>Divide: <code>/</code>
</li>
<li>Multiply: <code>*</code>
</li>
<li>Add: <code>+</code>
</li>
<li>Subtract: <code>-</code>
</li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 13</code></pre>
</div>
<p>Use parentheses to group operations in order to force the order of
evaluation if it differs from the default, or to make clear what you
intend.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 16</code></pre>
</div>
<p>This can get unwieldy when not needed, but clarifies your intentions.
Remember that others may later read your code.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">3</span> <span class="op">+</span> <span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># hard to read</span></span>
<span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span>       <span class="co"># clear, if you remember the rules</span></span>
<span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>     <span class="co"># if you forget some rules, this might help</span></span></code></pre>
</div>
<p>The text after each line of code is called a “comment”. Anything that
follows after the hash (or octothorpe) symbol <code>#</code> is ignored
by R when it executes code.</p>
<p>Really small or large numbers get a scientific notation:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">/</span><span class="fl">10000</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2e-04</code></pre>
</div>
<p>Which is shorthand for “multiplied by <code>10^XX</code>”. So
<code>2e-4</code> is shorthand for <code>2 * 10^(-4)</code>.</p>
<p>You can write numbers in scientific notation too:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">5e3</span>  <span class="co"># Note the lack of minus here</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5000</code></pre>
</div>
<p>Don’t worry about trying to remember every function in R. You can
look them up using a search engine, or if you can remember the start of
the function’s name, use the tab completion in RStudio.</p>
<p>This is one advantage that RStudio has over R on its own, it has
auto-completion abilities that allow you to more easily look up
functions, their arguments, and the values that they take.</p>
<p>Typing a <code>?</code> before the name of a command will open the
help page for that command. As well as providing a detailed description
of the command and how it works, scrolling to the bottom of the help
page will usually show a collection of code examples which illustrate
command usage. We’ll go through an example later.</p>
</section><section id="comparing-things"><h2 class="section-heading">Comparing things<a class="anchor" aria-label="anchor" href="#comparing-things"></a>
</h2>
<hr class="half-width">
<p>We can also do comparison in R:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span>  <span class="co"># equality (note two equals signs, read as "is equal to")</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">!=</span> <span class="fl">2</span>  <span class="co"># inequality (read as "is not equal to")</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&lt;</span> <span class="fl">2</span>  <span class="co"># less than</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&lt;=</span> <span class="fl">1</span>  <span class="co"># less than or equal to</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&gt;</span> <span class="fl">0</span>  <span class="co"># greater than</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">9</span> <span class="co"># greater than or equal to</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<div id="tip-comparing-numbers" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-comparing-numbers" class="callout-inner">
<h3 class="callout-title">Tip: Comparing Numbers<a class="anchor" aria-label="anchor" href="#tip-comparing-numbers"></a>
</h3>
<div class="callout-content">
<p>A word of warning about comparing numbers: you should never use
<code>==</code> to compare two numbers unless they are integers (a data
type which can specifically represent only whole numbers).</p>
<p>Computers may only represent decimal numbers with a certain degree of
precision, so two numbers which look the same when printed out by R, may
actually have different underlying representations and therefore be
different by a small margin of error (called Machine numeric
tolerance).</p>
<p>Instead you should use the <code>all.equal</code> function.</p>
<p>Further reading: <a href="https://floating-point-gui.de/" class="external-link">http://floating-point-gui.de/</a></p>
</div>
</div>
</div>
</section><section id="variables-and-assignment"><h2 class="section-heading">Variables and assignment<a class="anchor" aria-label="anchor" href="#variables-and-assignment"></a>
</h2>
<hr class="half-width">
<p>We can store values in variables using the assignment operator
<code>&lt;-</code>, like this:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>Notice that assignment does not print a value. Instead, we stored it
for later in something called a <strong>variable</strong>.
<code>x</code> now contains the <strong>value</strong>
<code>0.025</code>:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.025</code></pre>
</div>
<p>More precisely, the stored value is a <em>decimal approximation</em>
of this fraction called a <a href="https://en.wikipedia.org/wiki/Floating_point" class="external-link">floating point
number</a>.</p>
<p>Look for the <code>Environment</code> tab in one of the panes of
RStudio, and you will see that <code>x</code> and its value have
appeared. Our variable <code>x</code> can be used in place of a number
in any calculation that expects a number:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -3.688879</code></pre>
</div>
<p>Notice also that variables can be reassigned:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre>
</div>
<p><code>x</code> used to contain the value 0.025 and and now it has the
value 100.</p>
<p>Assignment values can contain the variable being assigned to:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span> <span class="co">#notice how RStudio updates its description of x on the top right tab</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre>
</div>
<p>The right hand side of the assignment can be any valid R expression.
The right hand side is <em>fully evaluated</em> before the assignment
occurs.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>What will be the value of each variable after each statement in the
following program?</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">122</span></span>
<span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.3</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Solution to challenge 1</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span></span></code></pre>
</div>
<p>This will give a value of 47.5 for the variable mass</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fl">122</span></span></code></pre>
</div>
<p>This will give a value of 122 for the variable age</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.3</span></span></code></pre>
</div>
<p>This will multiply the existing value of 47.5 by 2.3 to give a new
value of 109.25 to the variable mass.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span></span></code></pre>
</div>
<p>This will subtract 20 from the existing value of 122 to give a new
value of 102 to the variable age.</p>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Run the code from the previous challenge, and write a command to
compare mass to age. Is mass larger than age?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Solution to challenge 2</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>One way of answering this question in R is to use the
<code>&gt;</code> to set up the following:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&gt;</span> <span class="va">age</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
<p>This should yield a boolean value of TRUE since 109.25 is greater
than 102.</p>
</div>
</div>
</div>
</div>
<p>Variable names can contain letters, numbers, underscores and periods.
They cannot start with a number nor contain spaces at all. Different
people use different conventions for long variable names, these
include</p>
<ul>
<li>periods.between.words</li>
<li>underscores_between_words</li>
<li>camelCaseToSeparateWords</li>
</ul>
<p>What you use is up to you, but <strong>be consistent</strong>.</p>
<p>It is also possible to use the <code>=</code> operator for
assignment:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">40</span></span></code></pre>
</div>
<p>But this is much less common among R users. The most important thing
is to <strong>be consistent</strong> with the operator you use. There
are occasionally places where it is less confusing to use
<code>&lt;-</code> than <code>=</code>, and it is the most common symbol
used in the community. So the recommendation is to use
<code>&lt;-</code>.</p>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<p>Which of the following are valid R variable names?</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>min_height</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>max.height</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>_age</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>.mass</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>MaxLength</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>min<span class="sc">-</span>length</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>2widths</span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>celsius2kelvin</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Solution to challenge 3</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>The following can be used as R variables:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_height</span></span>
<span><span class="va">max.height</span></span>
<span><span class="va">MaxLength</span></span>
<span><span class="va">celsius2kelvin</span></span></code></pre>
</div>
<p>The following creates a hidden variable:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.mass</span></span></code></pre>
</div>
<p>We won’t be discussing hidden variables in this lesson. We recommend
not using a period at the beginning of variable names unless you intend
your variables to be hidden.</p>
<p>The following will not be able to be used to create a variable</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>_age</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>min<span class="sc">-</span>length</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>2widths</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="installing-packages"><h2 class="section-heading">Installing Packages<a class="anchor" aria-label="anchor" href="#installing-packages"></a>
</h2>
<hr class="half-width">
<p>We can use R as a calculator to do mathematical operations (e.g.,
addition, subtraction, multiplication, division), as we did above.
However, we can also use R to carry out more complicated analyses, make
visualizations, and much more. In later episodes, we’ll use R to do some
data wrangling, plotting, and saving of reformatted data.</p>
<p>R coders around the world have developed collections of R code to
accomplish themed tasks (e.g., data wrangling). These collections of R
code are known as <em>R packages</em>. It is also important to note that
R packages refer to code that is <em>not</em> automatically downloaded
when we install R on our computer. Therefore, we’ll have to install each
R package that we want to use (more on this below).</p>
<p>We will practice using the <code>dplyr</code> package to wrangle our
datasets in episode 6 and will also practice using the
<code>ggplot2</code> package to plot our data in episode 7. To give an
example, the <code>dplyr</code> package includes code for a function
called <code>filter()</code>. A <em>function</em> is something that
takes input(s) does some internal operations and produces output(s). For
the <code>filter()</code> function, the inputs are a dataset and a
logical statement (i.e., when data value is greater than or equal to
100) and the output is data within the dataset that has a value greater
than or equal to 100.</p>
<p>There are two main ways to install packages in R:</p>
<ol style="list-style-type: decimal">
<li><p>If you are using RStudio, we can go to <code>Tools</code> &gt;
<code>Install Packages...</code> and then search for the name of the R
package we need and click <code>Install</code>.</p></li>
<li><p>We can use the <code>install.packages( )</code> function. We can
do this to install the <code>dplyr</code> R package.</p></li>
</ol>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following package(s) will be installed:
- dplyr [1.1.4]
These packages will be installed into "~/Documents/2024-07-01-ucsb-intro-geospatial/renv/profiles/lesson-requirements/renv/library/R-4.3/aarch64-apple-darwin20".

# Installing packages --------------------------------------------------------
- Installing dplyr ...                          OK [linked from cache]
Successfully installed 1 package in 5.6 milliseconds.</code></pre>
</div>
<p>It’s important to note that we only need to install the R package on
our computer once. Well, if we install a new version of R on the same
computer, then we will likely need to also re-install the R packages
too.</p>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge-4"></a>
</h3>
<div class="callout-content">
<p>What code would we use to install the <code>ggplot2</code>
package?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Solution to challenge 4</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We would use the following R code to install the <code>ggplot2</code>
package:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now that we’ve installed the R package, we’re ready to use it! To use
the R package, we need to “load” it into our R session. We can think of
“loading” an R packages as telling R that we’re ready to use the package
we just installed. It’s important to note that while we only have to
install the package <em>once</em>, we’ll have to load the package
<em>each time we open R (or RStudio)</em>.</p>
<p>To load an R package, we use the <code>library( )</code> function. We
can load the <code>dplyr</code> package like this:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div id="challenge-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5" class="callout-inner">
<h3 class="callout-title">Challenge 5<a class="anchor" aria-label="anchor" href="#challenge-5"></a>
</h3>
<div class="callout-content">
<p>Which of the following could we use to load the <code>ggplot2</code>
package? (Select all that apply.)</p>
<ol style="list-style-type: lower-alpha">
<li>install.packages(“ggplot2”)</li>
<li>library(“ggplot2”)</li>
<li>library(ggplot2)</li>
<li>library(ggplo2)</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Solution to challenge 5</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>The correct answers are b and c. Answer a will install, not load, the
ggplot2 package. Answer b will correctly load the ggplot2 package. Note
there are no quotation marks. Answer c will correctly load the ggplot2
package. Note there are quotation marks. Answer d will produce an error
because ggplot2 is misspelled.</p>
<p>Note: It is more common for coders to <em>not use quotation</em>
marks when loading an R package (i.e., answer c).</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to write and run R programs.</li>
<li>R has the usual arithmetic operators.</li>
<li>Use <code>&lt;-</code> to assign values to variables.</li>
<li>Use <code>install.packages()</code> to install packages
(libraries).</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-02-project-intro"><p>Content from <a href="02-project-intro.html">Project Management With RStudio</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/02-project-intro.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I manage my projects in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create self-contained projects in RStudio</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>The scientific process is naturally incremental, and many projects
start life as random notes, some code, then a manuscript, and eventually
everything is a bit mixed together. Organising a project involving
spatial data is no different from any other data analysis project,
although you may require more disk space than usual.</p>
<div class="text-center">
<blockquote class="twitter-tweet">
<p>
Managing your projects in a reproducible fashion doesn’t just make your
science reproducible, it makes your life easier.
</p>
— Vince Buffalo (<span class="citation">@vsbuffalo</span>)
<a href="https://twitter.com/vsbuffalo/status/323638476153167872" class="external-link">April
15, 2013</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
<p>Most people tend to organize their projects like this:</p>
<figure><img src="fig/bad_layout.png" alt="A screenshot of a project folder containing multiple versions of data, analysis scripts, figures, and results files" class="figure mx-auto d-block"></figure><p>There are many reasons why we should <em>ALWAYS</em> avoid this:</p>
<ol style="list-style-type: decimal">
<li>It is really hard to tell which version of your data is the original
and which is the modified;</li>
<li>It gets really messy because it mixes files with various extensions
together;</li>
<li>It probably takes you a lot of time to actually find things, and
relate the correct figures to the exact code that has been used to
generate it;</li>
</ol>
<p>A good project layout will ultimately make your life easier:</p>
<ul>
<li>It will help ensure the integrity of your data;</li>
<li>It makes it simpler to share your code with someone else (a
lab-mate, collaborator, or supervisor);</li>
<li>It allows you to easily upload your code with your manuscript
submission;</li>
<li>It makes it easier to pick the project back up after a break.</li>
</ul></section><section id="a-possible-solution"><h2 class="section-heading">A possible solution<a class="anchor" aria-label="anchor" href="#a-possible-solution"></a>
</h2>
<hr class="half-width">
<p>Fortunately, there are tools and packages which can help you manage
your work effectively.</p>
<p>One of the most powerful and useful aspects of RStudio is its project
management functionality. We’ll be using this today to create a
self-contained, reproducible project.</p>

<div id="challenge-creating-a-self-contained-project" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-creating-a-self-contained-project" class="callout-inner">
<h3 class="callout-title">Challenge: Creating a self-contained
project<a class="anchor" aria-label="anchor" href="#challenge-creating-a-self-contained-project"></a>
</h3>
<div class="callout-content">
<p>We’re going to create a new project in RStudio:</p>
<ol style="list-style-type: decimal">
<li>Click the “File” menu button, then “New Project”.</li>
<li>Click “New Directory”.</li>
<li>Click “New Project”.</li>
<li>Type in “r-geospatial” as the name of the directory.</li>
<li>Click the “Create Project” button.</li>
</ol>
</div>
</div>
</div>
<p>A key advantage of an RStudio Project is that whenever we open this
project in subsequent RStudio sessions our working directory will
<em>always</em> be set to the folder <code>r-geospatial</code>. Let’s
check our working directory by entering the following into the R
console:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">getwd</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>R should return <code>your/path/r-geospatial</code> as the working
directory.</p>
</section><section id="best-practices-for-project-organization"><h2 class="section-heading">Best practices for project organization<a class="anchor" aria-label="anchor" href="#best-practices-for-project-organization"></a>
</h2>
<hr class="half-width">
<p>Although there is no “best” way to lay out a project, there are some
general principles to adhere to that will make project management
easier:</p>
<div class="section level3">
<h3 id="treat-data-as-read-only">Treat data as read only<a class="anchor" aria-label="anchor" href="#treat-data-as-read-only"></a>
</h3>
<p>This is probably the most important goal of setting up a project.
Data is typically time consuming and/or expensive to collect. Working
with them interactively (e.g., in Excel) where they can be modified
means you are never sure of where the data came from, or how it has been
modified since collection. It is therefore a good idea to treat your
data as “read-only”.</p>
</div>
<div class="section level3">
<h3 id="data-cleaning">Data Cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning"></a>
</h3>
<p>In many cases your data will be “dirty”: it will need significant
preprocessing to get into a format R (or any other programming language)
will find useful. This task is sometimes called “data munging”. I find
it useful to store these scripts in a separate folder, and create a
second “read-only” data folder to hold the “cleaned” data sets.</p>
</div>
<div class="section level3">
<h3 id="treat-generated-output-as-disposable">Treat generated output as disposable<a class="anchor" aria-label="anchor" href="#treat-generated-output-as-disposable"></a>
</h3>
<p>Anything generated by your scripts should be treated as disposable:
it should all be able to be regenerated from your scripts.</p>
<p>There are lots of different ways to manage this output. I find it
useful to have an output folder with different sub-directories for each
separate analysis. This makes it easier later, as many of my analyses
are exploratory and don’t end up being used in the final project, and
some of the analyses get shared between projects.</p>
</div>
<div class="section level3">
<h3 id="keep-related-data-together">Keep related data together<a class="anchor" aria-label="anchor" href="#keep-related-data-together"></a>
</h3>
<p>Some GIS file formats are really 3-6 files that need to be kept
together and have the same name, e.g. shapefiles. It may be tempting to
store those components separately, but your spatial data will be
unusable if you do that.</p>
</div>
<div class="section level3">
<h3 id="keep-a-consistent-naming-scheme">Keep a consistent naming scheme<a class="anchor" aria-label="anchor" href="#keep-a-consistent-naming-scheme"></a>
</h3>
<p>It is generally best to avoid renaming downloaded spatial data, so
that a clear connection is maintained with the point of truth. You may
otherwise find yourself wondering whether <code>file_A</code> really is
just a copy of <code>Official_file_on_website</code> or not.</p>
<p>For datasets you generate, it’s worth taking the time to come up with
a naming convention that works for your project, and sticking to it.
File names don’t have to be long, they just have to be long enough that
you can tell what the file is about. Date generated, topic, and whether
a product is intermediate or final are good bits of information to keep
in a file name. For more tips on naming files, check out <a href="https://speakerdeck.com/jennybc/how-to-name-files" class="external-link">the slides from
Jenny Bryan’s talk “Naming things” at the 2015 Reproducible Science
Workshop</a>.</p>
<div id="tip-good-enough-practices-for-scientific-computing" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-good-enough-practices-for-scientific-computing" class="callout-inner">
<h3 class="callout-title">Tip: Good Enough Practices for Scientific
Computing<a class="anchor" aria-label="anchor" href="#tip-good-enough-practices-for-scientific-computing"></a>
</h3>
<div class="callout-content">
<p><a href="https://github.com/swcarpentry/good-enough-practices-in-scientific-computing/blob/gh-pages/good-enough-practices-for-scientific-computing.pdf" class="external-link">Good
Enough Practices for Scientific Computing</a> gives the following
recommendations for project organization:</p>
<ol style="list-style-type: decimal">
<li>Put each project in its own directory, which is named after the
project.</li>
<li>Put text documents associated with the project in the
<code>doc</code> directory.</li>
<li>Put raw data and metadata in the <code>data</code> directory, and
files generated during cleanup and analysis in a <code>results</code>
directory.</li>
<li>Put source for the project’s scripts and programs in the
<code>src</code> directory, and programs brought in from elsewhere or
compiled locally in the <code>bin</code> directory.</li>
<li>Name all files to reflect their content or function.</li>
</ol>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="save-the-data-in-the-data-directory">Save the data in the data directory<a class="anchor" aria-label="anchor" href="#save-the-data-in-the-data-directory"></a>
</h3>
<p>Now we have a good directory structure we will now place/save our
data files in the <code>data/</code> directory.</p>
<div id="challenge-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>1. Download each of the data files listed below
(<kbd>Ctrl</kbd>+<kbd>S</kbd>, right mouse click -&gt; “Save as”, or
File -&gt; “Save page as”)</p>
<ul>
<li><a href="https://datacarpentry.org/r-intro-geospatial/data/nordic-data.csv" class="external-link">nordic
country data</a></li>
<li><a href="https://datacarpentry.org/r-intro-geospatial/data/nordic-data-2.csv" class="external-link">nordic
country data (version 2)</a></li>
<li><a href="https://datacarpentry.org/r-intro-geospatial/data/gapminder_data.csv" class="external-link">gapminder
data</a></li>
</ul>
<p>2. Make sure the files have the following names:</p>
<ul>
<li><code>nordic-data.csv</code></li>
<li><code>nordic-data-2.csv</code></li>
<li><code>gapminder_data.csv</code></li>
</ul>
<p>3. Save the files in the <code>data/</code> folder within your
project.</p>
<p>We will load and inspect these data later.</p>
</div>
</div>
</div>
<div id="challenge-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>We also want to move the data that we downloaded previously for this
workshop into a subdirectory inside <code>r-geospatial</code>. If you
haven’t already downloaded the data, you can do so by clicking <a href="https://ndownloader.figshare.com/articles/2009586/versions/10" class="external-link">this
download link</a>.</p>
<ol style="list-style-type: decimal">
<li>Move the downloaded zip file to the <code>data</code>
directory.</li>
<li>Once the data have been moved, unzip all files.</li>
</ol>
</div>
</div>
</div>
<p>Once you have completed moving the data across to the new folder,
your data directory should look as follows:</p>
<pre><code>data/
   gapminder_data.csv
   NEON-DS-Airborne-Remote-Sensing/
   NEON-DS-Landsat-NDVI/
   NEON-DS-Met-Time-Series/
   NEON-DS-Site-Layout-Files/
   NEON-DS-Airborne-Remote-Sensing.zip
   NEON-DS-Landsat-NDVI.zip
   NEON-DS-Met-Time-Series.zip
   NEON-DS-Site-Layout-Files.zip
   nordic-data.csv
   nordic-data-2.csv</code></pre>
</div>
<div class="section level3">
<h3 id="stage-your-scripts">Stage your scripts<a class="anchor" aria-label="anchor" href="#stage-your-scripts"></a>
</h3>
<p>Creating separate R scripts or Rmarkdown documents for different
stages of a project will maximise efficiency. For instance, separating
data download commands into their own file means that you won’t
re-download data unnecessarily.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use RStudio to create and manage projects with consistent
layout.</li>
<li>Treat raw data as read-only.</li>
<li>Treat generated output as disposable.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></section><section id="aio-03-data-structures-part1"><p>Content from <a href="03-data-structures-part1.html">Data Structures</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/03-data-structures-part1.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I read data in R?</li>
<li>What are the basic data types in R?</li>
<li>How do I represent categorical information in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be aware of the different types of data.</li>
<li>To begin exploring data frames, and understand how they are related
to vectors, factors and lists.</li>
<li>To be able to ask questions from R about the type, class, and
structure of an object.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Let’s start by creating a new R script and saving it to the
<code>scripts</code> folder in our project directory. We will create new
scripts for each episode in this workshop.</p>
<p>We can create a new R script by clicking the button at the top left
of our RStudio, the one that looks like a piece of paper with a green
plus sign next to it. On the drop down, click “R Script”. We can also
create an R script using File &gt; New file &gt; R script.</p>
<p>We can add a comment to our script to remind us what we’re working
on:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R script for data structures</span></span></code></pre>
</div>
<p>Comments are useful notes to us that are ignored by the computer.</p>
<p>Now that we’ve got the basics covered, we can move on to the lesson.
One of R’s most powerful features is its ability to deal with tabular
data - like you may already have in a spreadsheet or a CSV file. Let’s
start by downloading and reading in a file <code>nordic-data.csv</code>.
We will save this data as an object named <code>nordic</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/nordic-data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="tip-running-segments-of-your-code" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-running-segments-of-your-code" class="callout-inner">
<h3 class="callout-title">Tip: Running segments of your code<a class="anchor" aria-label="anchor" href="#tip-running-segments-of-your-code"></a>
</h3>
<div class="callout-content">
<p>RStudio offers you great flexibility in running code from within the
editor window. There are buttons, menu choices, and keyboard shortcuts.
To run the current line, you can</p>
<ol style="list-style-type: decimal">
<li>click on the <code>Run</code> button above the editor panel, or</li>
<li>select “Run Lines” from the “Code” menu, or</li>
<li>hit <kbd>Ctrl</kbd>+<kbd>Enter</kbd> in Windows,
<kbd>Ctrl</kbd>+<kbd>Return</kbd> in Linux, or
<kbd>⌘</kbd>+<kbd>Return</kbd> on OS X. (This shortcut can also be seen
by hovering the mouse over the button). To run a block of code, select
it and then <code>Run</code>.</li>
</ol>
</div>
</div>
</div>
<p>The <code>read.table</code> function is used for reading in tabular
data stored in a text file where the columns of data are separated by
punctuation characters such as CSV files (csv = comma-separated values).
Tabs and commas are the most common punctuation characters used to
separate or delimit data points in csv files. For convenience R provides
2 other versions of <code>read.table</code>. These are:
<code>read.csv</code> for files where the data are separated with commas
and <code>read.delim</code> for files where the data are separated with
tabs. Of these three functions <code>read.csv</code> is the most
commonly used. If needed it is possible to override the default
delimiting punctuation marks for both <code>read.csv</code> and
<code>read.delim</code>.</p>
<p>We can begin exploring our dataset right away, pulling out columns by
specifying them using the <code>$</code> operator:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Sweden"  "Norway" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 77.2 80.0 79.0</code></pre>
</div>
<p>We can do other operations on the columns. For example, if we
discovered that the life expectancy is two years higher:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 79.2 82.0 81.0</code></pre>
</div>
<p>But what about:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">+</span> <span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in nordic$lifeExp + nordic$country: non-numeric argument to binary operator</code></pre>
</div>
<p>Understanding what happened here is key to successfully analyzing
data in R.</p>
<section id="data-types"><h2 class="section-heading">Data Types<a class="anchor" aria-label="anchor" href="#data-types"></a>
</h2>
<hr class="half-width">
<p>If you guessed that the last command will return an error because
<code>77.2</code> plus <code>"Denmark"</code> is nonsense, you’re right
- and you already have some intuition for an important concept in
programming called <em>data classes</em>. We can ask what class of data
something is:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "numeric"</code></pre>
</div>
<p>There are 6 main types:</p>
<ul>
<li>
<code>numeric</code>: values like 1.254, 0.8, -7.2</li>
<li>
<code>integer</code>: values like 1, 10, 150</li>
<li>
<code>complex</code>: values like 1+1i</li>
<li>
<code>logical</code>: TRUE or FALSE</li>
<li>
<code>character</code>: values like “cats”, “dogs”, and
“animals”</li>
<li>
<code>factor</code>: categories with all possible values, like the
months of the year</li>
</ul>
<p>No matter how complicated our analyses become, all data in R is
interpreted a specific data class. This strictness has some really
important consequences.</p>
<p>A user has added new details of age expectancy. This information is
in the file <code>data/nordic-data-2.csv</code>.</p>
<p>Load the new nordic data as <code>nordic_2</code>, and check what
class of data we find in the <code>lifeExp</code> column:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_2</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/nordic-data-2.csv"</span><span class="op">)</span></span>
<span><span class="fu">class</span><span class="op">(</span><span class="va">nordic_2</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "character"</code></pre>
</div>
<p>Oh no, our life expectancy lifeExp aren’t the numeric type anymore!
If we try to do the same math we did on them before, we run into
trouble:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_2</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in nordic_2$lifeExp + 2: non-numeric argument to binary operator</code></pre>
</div>
<p>What happened? When R reads a csv file into one of these tables, it
insists that everything in a column be the same class; if it can’t
understand <em>everything</em> in the column as numeric, then
<em>nothing</em> in the column gets to be numeric. The table that R
loaded our nordic data into is something called a dataframe, and it is
our first example of something called a <em>data structure</em> - that
is, a structure which R knows how to build out of the basic data
types.</p>
<p>We can look at the data within R by clicking the object in our
environment or using <code>View(nordic)</code>. We see that the
<code>lifeExp</code> column now has the value “79.0 or 83” in the third
row. R needed all values in that column to be the same type, so it
forced everything to be a character instead of a number.</p>
<p>In order to successfully use our data in R, we need to understand
what the basic data structures are, and how they behave.</p>
</section><section id="vectors-and-type-coercion"><h2 class="section-heading">Vectors and Type Coercion<a class="anchor" aria-label="anchor" href="#vectors-and-type-coercion"></a>
</h2>
<hr class="half-width">
<p>To better understand this behavior, let’s meet another of the data
structures: the vector.</p>
<p>A vector in R is essentially an ordered list of things, with the
special condition that everything in the vector must be the same basic
data type. If you don’t choose the data type, it’ll default to
<code>logical</code>; or, you can declare an empty vector of whatever
type you like.</p>
<p>You can specify a vector either using the <code>vector()</code>
function or the combine (<code>c()</code>) function.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">vector</span><span class="op">(</span>length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># this creates an empty vector of logical values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] FALSE FALSE FALSE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># this creates a vector with numerical values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="st">"this"</span>, <span class="st">"that"</span>, <span class="st">"the other"</span><span class="op">)</span> <span class="co"># this creates a vector with character values</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "this"      "that"      "the other"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_vector</span> <span class="op">&lt;-</span> <span class="fu">vector</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">'character'</span>, length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">another_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "" "" ""</code></pre>
</div>
<p>You can check if something is a vector using <code>str</code> which
asks for an object’s structure:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">another_vector</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "" "" ""</code></pre>
</div>
<p>The somewhat cryptic output from this command indicates the basic
data type found in this vector - in this case <code>chr</code>,
character; an indication of the number of things in the vector -
actually, the indexes of the vector, in this case <code>[1:3]</code>;
and a few examples of what’s actually in the vector - in this case empty
character strings. If we similarly do</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3] 77.2 80 79</code></pre>
</div>
<p>we see that <code>nordic$lifeExp</code> is a vector, too - the
columns of data we load into R data frames are all vectors, and that’s
the root of why R forces everything in a column to be the same basic
data type.</p>
<div id="discussion-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="discussion-1" class="callout-inner">
<h3 class="callout-title">Discussion 1<a class="anchor" aria-label="anchor" href="#discussion-1"></a>
</h3>
<div class="callout-content">
<p>Why is R so opinionated about what we put in our columns of data? How
does this help us?</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Discussion 1</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>By keeping everything in a column the same, we allow ourselves to
make simple assumptions about our data; if you can interpret one entry
in the column as a number, then you can interpret <em>all</em> of them
as numbers, so we don’t have to check every time. This consistency is
what people mean when they talk about <em>clean data</em>; in the long
run, strict consistency goes a long way to making our lives easier in
R.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Given what we’ve learned so far, what do you think the following will
produce?</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quiz_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="st">'3'</span><span class="op">)</span></span></code></pre>
</div>
<p>This is something called <em>type coercion</em>, and it is the source
of many surprises and the reason why we need to be aware of the basic
data types and how R will interpret them. When R encounters a mix of
types (here numeric and character) to be combined into a single vector,
it will force them all to be the same type. Consider:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coercion_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">coercion_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"    "TRUE"</code></pre>
</div>
<p>The coercion rules go: <code>logical</code> -&gt;
<code>integer</code> -&gt; <code>numeric</code> -&gt;
<code>complex</code> -&gt; <code>character</code>, where -&gt; can be
read as <em>are transformed into</em>. You can try to force coercion
against this flow using the <code>as.</code> functions:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_vector_example</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'0'</span>, <span class="st">'2'</span>, <span class="st">'4'</span><span class="op">)</span></span>
<span><span class="va">character_vector_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "0" "2" "4"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">character_coerced_to_numeric</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">character_vector_example</span><span class="op">)</span></span>
<span><span class="va">character_coerced_to_numeric</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0 2 4</code></pre>
</div>
<p>As you can see, some surprising things can happen when R forces one
basic data type into another! Nitty-gritty of type coercion aside, the
point is: if your data doesn’t look like what you thought it was going
to look like, type coercion may well be to blame; make sure everything
is the same type in your vectors and your columns of data frames, or you
will get nasty surprises!</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Given what you now know about type conversion, look at the class of
data in <code>nordic_2$lifeExp</code> and compare it with
<code>nordic$lifeExp</code>. Why are these columns different
classes?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic_2</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "77.2" "80" "79.0 or 83"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3] 77.2 80 79</code></pre>
</div>
<p>The data in <code>nordic_2$lifeExp</code> is stored as a character
vector, rather than as a numeric vector. This is because of the “or”
character string in the third data point.</p>
</div>
</div>
</div>
</div>
<p>The combine function, <code>c()</code>, will also append things to an
existing vector:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ab_vector</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span></span>
<span><span class="va">ab_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combine_example</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">ab_vector</span>, <span class="st">'DC'</span><span class="op">)</span></span>
<span><span class="va">combine_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a"  "b"  "DC"</code></pre>
</div>
<p>You can also make series of numbers:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_series</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">my_series</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">seq</span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  2.0  2.1  2.2  2.3  2.4
[16]  2.5  2.6  2.7  2.8  2.9  3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
[31]  4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  5.0  5.1  5.2  5.3  5.4
[46]  5.5  5.6  5.7  5.8  5.9  6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9
[61]  7.0  7.1  7.2  7.3  7.4  7.5  7.6  7.7  7.8  7.9  8.0  8.1  8.2  8.3  8.4
[76]  8.5  8.6  8.7  8.8  8.9  9.0  9.1  9.2  9.3  9.4  9.5  9.6  9.7  9.8  9.9
[91] 10.0</code></pre>
</div>
<p>We can ask a few questions about vectors:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sequence_example</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5 6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tail</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1]  5  6  7  8  9 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 10</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">sequence_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "integer"</code></pre>
</div>
<p>Finally, you can give names to elements in your vector:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_example</span> <span class="op">&lt;-</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">my_example</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span><span class="va">my_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>a b c d 
5 6 7 8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">my_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "a" "b" "c" "d"</code></pre>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Start by making a vector with the numbers 1 through 26. Multiply the
vector by 2, and give the resulting vector names A through Z (hint:
there is a built in vector called <code>LETTERS</code>)</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="factors"><h2 class="section-heading">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h2>
<hr class="half-width">
<p>We said that columns in data frames were vectors:</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> num [1:3] 77.2 80 79</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> int [1:3] 2002 2002 2002</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "Denmark" "Sweden" "Norway"</code></pre>
</div>
<p>One final important data structure in R is called a “factor”. Factors
look like character data, but are used to represent data where each
element of the vector must be one of a limited number of “levels”. To
phrase that another way, factors are an “enumerated” type where there
are a finite number of pre-defined values that your vector can have.</p>
<p>For example, let’s make a vector of strings labeling nordic countries
for all the countries in our study:</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic_countries</span> <span class="op">&lt;-</span> <span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">nordic_countries</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> chr [1:3] "Denmark" "Sweden" "Norway"</code></pre>
</div>
<p>We can turn a vector into a factor like so:</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic_countries</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">categories</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> Factor w/ 3 levels "Denmark","Norway",..: 1 3 2</code></pre>
</div>
<p>Now R has noticed that there are 3 possible categories in our data -
but it also did something surprising; instead of printing out the
strings we gave it, we got a bunch of numbers instead. R has replaced
our human-readable categories with numbered indices under the hood, this
is necessary as many statistical calculations utilise such numerical
representations for categorical data.</p>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<p>Can you guess why these numbers are used to represent these
countries?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>They are sorted in alphabetical order</p>
</div>
</div>
</div>
</div>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge-4"></a>
</h3>
<div class="callout-content">
<p>Convert the <code>country</code> column of our <code>nordic</code>
data frame to a factor. Then try converting it back to a character
vector.</p>
<p>Now try converting <code>lifeExp</code> in our <code>nordic</code>
data frame to a factor, then back to a numeric vector. What happens if
you use <code>as.numeric()</code>?</p>
<p>Remember that you can reload the <code>nordic</code> data frame using
<code>read.csv("data/nordic-data.csv")</code> if you accidentally lose
some data!</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Converting character vectors to factors can be done using the
<code>factor()</code> function:</p>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Denmark Sweden  Norway 
Levels: Denmark Norway Sweden</code></pre>
</div>
<p>You can convert these back to character vectors using
<code>as.character()</code>:</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Sweden"  "Norway" </code></pre>
</div>
<p>You can convert numeric vectors to factors in the exact same way:</p>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 77.2 80   79  
Levels: 77.2 79 80</code></pre>
</div>
<p>But be careful – you can’t use <code>as.numeric()</code> to convert
factors to numerics!</p>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as.numeric</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 3 2</code></pre>
</div>
<p>Instead, <code>as.numeric()</code> converts factors to those “numbers
under the hood” we talked about. To go from a factor to a number, you
need to first turn the factor into a character vector, and <em>then</em>
turn that into a numeric vector:</p>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&lt;-</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span><span class="va">nordic</span><span class="op">$</span><span class="va">lifeExp</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 77.2 80.0 79.0</code></pre>
</div>
<p>Note: new students find the help files difficult to understand; make
sure to let them know that this is typical, and encourage them to take
their best guess based on semantic meaning, even if they aren’t
sure.</p>
</div>
</div>
</div>
</div>
<p>When doing statistical modelling, it’s important to know what the
baseline levels are. This is assumed to be the first factor, but by
default factors are labeled in alphabetical order. You can change this
by specifying the levels:</p>
<div class="codewrapper sourceCode" id="cb81">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"case"</span>, <span class="st">"control"</span>, <span class="st">"control"</span>, <span class="st">"case"</span><span class="op">)</span></span>
<span><span class="va">factor_ordering_example</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">mydata</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"case"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">factor_ordering_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> Factor w/ 2 levels "control","case": 2 1 1 2</code></pre>
</div>
<p>In this case, we’ve explicitly told R that “control” should
represented by 1, and “case” by 2. This designation can be very
important for interpreting the results of statistical models!</p>
</section><section id="lists"><h2 class="section-heading">Lists<a class="anchor" aria-label="anchor" href="#lists"></a>
</h2>
<hr class="half-width">
<p>Another data structure you’ll want in your bag of tricks is the
<code>list</code>. A list is simpler in some ways than the other types,
because you can put anything you want in it:</p>
<div class="codewrapper sourceCode" id="cb83">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_example</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"a"</span>, <span class="cn">TRUE</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">list_example</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
[1] 1

[[2]]
[1] "a"

[[3]]
[1] TRUE

[[4]]
[1] 2 6 7</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb85">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Numbers"</span>, numbers <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, data <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">another_list</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$title
[1] "Numbers"

$numbers
 [1]  1  2  3  4  5  6  7  8  9 10

$data
[1] TRUE</code></pre>
</div>
<p>We can now understand something a bit surprising in our data frame;
what happens if we compare <code>str(nordic)</code> and
<code>str(another_list)</code>:</p>
<div class="codewrapper sourceCode" id="cb87">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">nordic</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	3 obs. of  3 variables:
 $ country: chr  "Denmark" "Sweden" "Norway"
 $ year   : int  2002 2002 2002
 $ lifeExp: num  77.2 80 79</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb89">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">another_list</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>List of 3
 $ title  : chr "Numbers"
 $ numbers: int [1:10] 1 2 3 4 5 6 7 8 9 10
 $ data   : logi TRUE</code></pre>
</div>
<p>We see that the output for these two objects look very similar. It is
because data frames are lists ‘under the hood’. Data frames are a
special case of lists where each element (the columns of the data frame)
have the same lengths.</p>
<p>In our <code>nordic</code> example, we have a character, an integer,
and a numerical variable. As we have seen already, each column of data
frame is a vector.</p>
<div class="codewrapper sourceCode" id="cb91">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Sweden"  "Norway" </code></pre>
</div>
<p>We can also call to the contents within the items in a list via
indexing. For example, if we wanted to just return the contents from the
first object in <code>another_list</code> (the title), we can do that by
using double brackets and specifying either the index value of the item,
or it’s name.</p>
<div class="codewrapper sourceCode" id="cb93">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Numbers"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">another_list</span><span class="op">[[</span><span class="st">"title"</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Numbers"</code></pre>
</div>
<div id="challenge-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5" class="callout-inner">
<h3 class="callout-title">Challenge 5<a class="anchor" aria-label="anchor" href="#challenge-5"></a>
</h3>
<div class="callout-content">
<p>There are several subtly different ways to call variables,
observations and elements from data frames:</p>
<ul>
<li><code>nordic[1]</code></li>
<li><code>nordic[[1]]</code></li>
<li><code>nordic$country</code></li>
<li><code>nordic["country"]</code></li>
<li><code>nordic[1, 1]</code></li>
<li><code>nordic[, 1]</code></li>
<li><code>nordic[1, ]</code></li>
</ul>
<p>Try out these examples and explain what is returned by each one.</p>
<p><em>Hint:</em> Use the function <code>class()</code> to examine what
is returned in each case.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">Show me the solution</h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb97">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  country
1 Denmark
2  Sweden
3  Norway</code></pre>
</div>
<p>We can think of a data frame as a list of vectors. The single brace
<code>[1]</code> returns the first slice of the list, as another list.
In this case it is the first column of the data frame.</p>
<div class="codewrapper sourceCode" id="cb99">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Sweden"  "Norway" </code></pre>
</div>
<p>The double brace <code>[[1]]</code> returns the contents of the list
item. In this case it is the contents of the first column, a
<em>vector</em> of type <em>character</em>.</p>
<div class="codewrapper sourceCode" id="cb101">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">$</span><span class="va">country</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Sweden"  "Norway" </code></pre>
</div>
<p>This example uses the <code>$</code> character to address items by
name. <em>country</em> is the first column of the data frame, again a
<em>vector</em> of type <em>character</em>.</p>
<div class="codewrapper sourceCode" id="cb103">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">[</span><span class="st">"country"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  country
1 Denmark
2  Sweden
3  Norway</code></pre>
</div>
<p>Here we are using a single brace <code>["country"]</code> replacing
the index number with the column name. Like example 1, the returned
object is a <em>list</em>.</p>
<div class="codewrapper sourceCode" id="cb105">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark"</code></pre>
</div>
<p>This example uses a single brace, but this time we provide row and
column coordinates. The returned object is the value in row 1, column 1.
The object is an <em>character</em>: the first value of the first vector
in our <code>nordic</code> object.</p>
<div class="codewrapper sourceCode" id="cb107">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Denmark" "Sweden"  "Norway" </code></pre>
</div>
<p>Like the previous example we use single braces and provide row and
column coordinates. The row coordinate is not specified, R interprets
this missing value as all the elements in this <em>column</em>
<em>vector</em>.</p>
<div class="codewrapper sourceCode" id="cb109">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nordic</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  country year lifeExp
1 Denmark 2002    77.2</code></pre>
</div>
<p>Again we use the single brace with row and column coordinates. The
column coordinate is not specified. The return value is a <em>list</em>
containing all the values in the first row.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>read.csv</code> to read tabular data in R.</li>
<li>The basic data types in R are double, integer, complex, logical, and
character.</li>
<li>Use factors to represent categories in R.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-04-data-structures-part2"><p>Content from <a href="04-data-structures-part2.html">Exploring Data Frames</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/04-data-structures-part2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I manipulate a data frame?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Append two data frames.</li>
<li>Understand what a <code>factor</code> is.</li>
<li>Convert a <code>factor</code> to a <code>character</code> vector and
vice versa.</li>
<li>Display basic properties of data frames including size and class of
the columns, names, and first few rows.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>At this point, you’ve seen it all: in the last lesson, we toured all
the basic data types and data structures in R. Everything you do will be
a manipulation of those tools. But most of the time, the star of the
show is the data frame—the table that we created by loading information
from a csv file. In this lesson, we’ll learn a few more things about
working with data frames.</p>
<section id="realistic-example"><h2 class="section-heading">Realistic example<a class="anchor" aria-label="anchor" href="#realistic-example"></a>
</h2>
<hr class="half-width">
<p>We already learned that the columns of a data frame are vectors, so
that our data are consistent in type throughout the columns. So far, you
have seen the basics of manipulating data frames with our nordic data;
now let’s use those skills to digest a more extensive dataset. Let’s
read in the gapminder dataset that we downloaded previously:</p>

<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s investigate the <code>gapminder</code> data frame a bit; the
first thing we should always do is check out what the data looks like
with <code>str</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<p>We can also interrogate the data frame for information about its
dimensions; remembering that <code>str(gapminder)</code> said there were
1704 observations of 6 variables in gapminder, what do you think the
following will produce, and why?</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<p>A fair guess would have been to say that the length of a data frame
would be the number of rows it has (1704), but this is not the case; it
gives us the number of columns.</p>
<p>To get the number of rows and columns in our dataset, try:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>Or, both at once:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dim</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704    6</code></pre>
</div>
<p>We’ll also likely want to know what the titles of all the columns
are, so we can ask for them later:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colnames</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"</code></pre>
</div>
<p>At this stage, it’s important to ask ourselves if the structure R is
reporting matches our intuition or expectations; do the basic data types
reported for each column make sense? If not, we need to sort any
problems out now before they turn into bad surprises down the road,
using what we’ve learned about how R interprets data, and the importance
of <em>strict consistency</em> in how we record our data.</p>
<p>Once we’re happy that the data types and structures seem reasonable,
it’s time to start digging into our data proper. Check out the first few
lines:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>It’s good practice to also check the last few lines of your data and
some in the middle. How would you do this?</p>
<p>Searching for ones specifically in the middle isn’t too hard but we
could simply ask for a few lines at random. How would you code this?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>To check the last few lines it’s relatively simple as R already has a
function for this:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre>
</div>
<p>What about a few arbitrary rows just for sanity (or insanity
depending on your view)?</p>
<p>There are several ways to achieve this.</p>
<p>The solution here presents one form using nested functions. i.e. a
function passed as an argument to another function. This might sound
like a new concept but you are already using it in fact.</p>
<p>Remember <code>my_dataframe[rows, cols]</code> will print to screen
your data frame with the number of rows and columns you asked for
(although you might have asked for a range or named columns for
example). How would you get the last row if you don’t know how many rows
your data frame has? R has a function for this. What about getting a
(pseudorandom) sample? R also has a function for this.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fu">sample</span><span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Read the output of <code>str(gapminder)</code> again; this time, use
what you’ve learned about factors and vectors, as well as the output of
functions like <code>colnames</code> and <code>dim</code> to explain
what everything that <code>str</code> prints out for
<code>gapminder</code> means. If there are any parts you can’t
interpret, discuss with your neighbors!</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The object <code>gapminder</code> is a data frame with columns</p>
<ul>
<li>
<code>country</code> and <code>continent</code> are character
vectors.</li>
<li>
<code>year</code> is an integer vector.</li>
<li>
<code>pop</code>, <code>lifeExp</code>, and <code>gdpPercap</code>
are numeric vectors.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section id="adding-columns-and-rows-in-data-frames"><h2 class="section-heading">Adding columns and rows in data frames<a class="anchor" aria-label="anchor" href="#adding-columns-and-rows-in-data-frames"></a>
</h2>
<hr class="half-width">
<p>We would like to create a new column to hold information on whether
the life expectancy is below the world average life expectancy (70.5) or
above:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">below_average</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&lt;</span> <span class="fl">70.5</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">below_average</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE TRUE TRUE TRUE TRUE TRUE</code></pre>
</div>
<p>We can then add this as a column via:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">below_average</span><span class="op">)</span></span></code></pre>
</div>
<p>Note that if we tried to add a vector of <code>below_average</code>
with a different number of entries than the number of rows in the
dataframe, it would fail:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">below_average</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">cbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">below_average</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 1704, 5</code></pre>
</div>
<p>Why didn’t this work? R wants to see one element in our new column
for every row in the table:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1704</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">below_average</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 5</code></pre>
</div>
<p>So for it to work we need either to have <code>nrow(gapminder)</code>
= <code>length(below_average)</code> or <code>nrow(gapminder)</code> to
be a multiple of <code>length(below_average)</code>:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">below_average</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="fu">cbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">below_average</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap below_average
1 Afghanistan 1952  8425333      Asia  28.801  779.4453          TRUE
2 Afghanistan 1957  9240934      Asia  30.332  820.8530          TRUE
3 Afghanistan 1962 10267083      Asia  31.997  853.1007         FALSE
4 Afghanistan 1967 11537966      Asia  34.020  836.1971          TRUE
5 Afghanistan 1972 13079460      Asia  36.088  739.9811          TRUE
6 Afghanistan 1977 14880372      Asia  38.438  786.1134         FALSE</code></pre>
</div>
<p>The sequence <code>TRUE,TRUE,FALSE</code> is repeated over all the
gapminder rows.</p>
<p>Let’s overwrite the content of gapminder with our new data frame. We
can do this in two ways: using <code>cbind</code> and overwriting the
<code>gapminder</code> object, or by identifying and adding a new
column.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">below_average</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">&lt;</span><span class="fl">70.5</span></span>
<span></span>
<span><span class="co"># Option 1 - use cbind and overwrite the object</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">below_average</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2 - identifying and adding a new column</span></span>
<span><span class="va">gapminder</span><span class="op">$</span><span class="va">below_average</span> <span class="op">&lt;-</span> <span class="va">below_average</span></span></code></pre>
</div>
<p>Now how about adding rows? The rows of a data frame are lists, so we
can add a new row by either specifying a new list, or a new data
frame.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1 - create a new list</span></span>
<span><span class="va">new_row</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>country <span class="op">=</span> <span class="st">'Norway'</span>, </span>
<span>                year <span class="op">=</span> <span class="fl">2016</span>, </span>
<span>                pop <span class="op">=</span> <span class="fl">5000000</span>, </span>
<span>                continent <span class="op">=</span> <span class="st">'Nordic'</span>, </span>
<span>                lifeExp <span class="op">=</span> <span class="fl">80.3</span>, </span>
<span>                gdpPercap <span class="op">=</span> <span class="fl">49400.0</span>, </span>
<span>                below_average <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2 - perhaps more intuitive, create a new data frame</span></span>
<span><span class="va">new_row</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>country <span class="op">=</span> <span class="st">'Norway'</span>, </span>
<span>                      year <span class="op">=</span> <span class="fl">2016</span>, </span>
<span>                      pop <span class="op">=</span> <span class="fl">5000000</span>, </span>
<span>                      continent <span class="op">=</span> <span class="st">'Nordic'</span>, </span>
<span>                      lifeExp <span class="op">=</span> <span class="fl">80.3</span>, </span>
<span>                      gdpPercap <span class="op">=</span> <span class="fl">49400.0</span>, </span>
<span>                      below_average <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gapminder_norway</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">new_row</span><span class="op">)</span></span>
<span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder_norway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp  gdpPercap below_average
1700 Zimbabwe 1987  9216418    Africa  62.351   706.1573          TRUE
1701 Zimbabwe 1992 10704340    Africa  60.377   693.4208          TRUE
1702 Zimbabwe 1997 11404948    Africa  46.809   792.4500          TRUE
1703 Zimbabwe 2002 11926563    Africa  39.989   672.0386          TRUE
1704 Zimbabwe 2007 12311143    Africa  43.487   469.7093          TRUE
1705   Norway 2016  5000000    Nordic  80.300 49400.0000         FALSE</code></pre>
</div>
</section><section id="factors"><h2 class="section-heading">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h2>
<hr class="half-width">
<p>Here is another thing to look out for: in a <code>factor</code>, each
different value represents what is called a <code>level</code>. Let’s
alter our gapminder data so that the “continent” column is a factor.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] Asia Asia Asia Asia Asia Asia
Levels: Africa Americas Asia Europe Oceania</code></pre>
</div>
<p>Now the <code>factor</code> “continent” has 5 levels: “Africa”,
“Americas”, “Asia”, “Europe” and “Oceania”. R will only accept values
that match one of the levels. If you add a new value, it will become
<code>NA</code>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Africa"   "Americas" "Asia"     "Europe"   "Oceania" </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fu">levels</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span>, <span class="st">"Nordic"</span><span class="op">)</span></span>
<span><span class="va">gapminder_norway</span>  <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">new_row</span><span class="op">)</span></span>
<span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder_norway</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp  gdpPercap below_average
1700 Zimbabwe 1987  9216418    Africa  62.351   706.1573          TRUE
1701 Zimbabwe 1992 10704340    Africa  60.377   693.4208          TRUE
1702 Zimbabwe 1997 11404948    Africa  46.809   792.4500          TRUE
1703 Zimbabwe 2002 11926563    Africa  39.989   672.0386          TRUE
1704 Zimbabwe 2007 12311143    Africa  43.487   469.7093          TRUE
1705   Norway 2016  5000000    Nordic  80.300 49400.0000         FALSE</code></pre>
</div>
<p>Alternatively, we can change a factor into a character vector; we
lose the handy categories of the factor, but we can subsequently add any
word we want to the column without babysitting the factor levels:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  7 variables:
 $ country      : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year         : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop          : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent    : Factor w/ 6 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ lifeExp      : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap    : num  779 821 853 836 740 ...
 $ below_average: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">&lt;-</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  7 variables:
 $ country      : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year         : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop          : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent    : chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp      : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap    : num  779 821 853 836 740 ...
 $ below_average: logi  TRUE TRUE TRUE TRUE TRUE TRUE ...</code></pre>
</div>
</section><section id="appending-to-a-data-frame"><h2 class="section-heading">Appending to a data frame<a class="anchor" aria-label="anchor" href="#appending-to-a-data-frame"></a>
</h2>
<hr class="half-width">
<p>The key to remember when adding data to a data frame is that
<em>columns are vectors and rows are lists.</em> We can also glue two
data frames together with <code>rbind</code>:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="fu">tail</span><span class="op">(</span><span class="va">gapminder</span>, n<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap below_average
3406 Zimbabwe 1997 11404948    Africa  46.809  792.4500          TRUE
3407 Zimbabwe 2002 11926563    Africa  39.989  672.0386          TRUE
3408 Zimbabwe 2007 12311143    Africa  43.487  469.7093          TRUE</code></pre>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<p>You can create a new data frame right from within R with the
following syntax:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>id <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>                 x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                 y <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Make a data frame that holds the following information for
yourself:</p>
<ul>
<li>first name</li>
<li>last name</li>
<li>lucky number</li>
</ul>
<p>Then use <code>rbind</code> to add an entry for the people sitting
beside you. Finally, use <code>cbind</code> to add a column with each
person’s answer to the question, “Is it time for coffee break?”</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>first <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Grace"</span><span class="op">)</span>,</span>
<span>                 last <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Hopper"</span><span class="op">)</span>,</span>
<span>                 lucky_number <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span><span class="va">df</span>, <span class="fu">list</span><span class="op">(</span><span class="st">"Marie"</span>, <span class="st">"Curie"</span>, <span class="fl">238</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">cbind</span><span class="op">(</span><span class="va">df</span>, coffeetime <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>cbind()</code> to add a new column to a data frame.</li>
<li>Use <code>rbind()</code> to add a new row to a data frame.</li>
<li>Use <code>levels()</code> and <code>as.character()</code> to explore
and manipulate factors.</li>
<li>Use <code>str()</code>, <code>nrow()</code>, <code>ncol()</code>,
<code>dim()</code>, <code>colnames()</code>, <code>rownames()</code>,
<code>head()</code>, and <code>tail()</code> to understand the structure
of a data frame.</li>
<li>Read in a csv file using <code>read.csv()</code>.</li>
<li>Understand what <code>length()</code> of a data frame
represents.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-05-data-subsetting"><p>Content from <a href="05-data-subsetting.html">Subsetting Data</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/05-data-subsetting.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I work with subsets of data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to subset vectors and data frames</li>
<li>To be able to extract individual and multiple elements: by index, by
name, using comparison operations</li>
<li>To be able to skip and remove elements from various data
structures.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>R has many powerful subset operators. Mastering them will allow you
to easily perform complex operations on any kind of dataset.</p>
<p>There are six different ways we can subset any kind of object, and
three different subsetting operators for the different data
structures.</p>
<p>Let’s start with the workhorse of R: a simple numeric vector.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e 
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<div id="atomic-vectors" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="atomic-vectors" class="callout-inner">
<h3 class="callout-title">Atomic vectors<a class="anchor" aria-label="anchor" href="#atomic-vectors"></a>
</h3>
<div class="callout-content">
<p>In R, simple vectors containing character strings, numbers, or
logical values are called <em>atomic</em> vectors because they can’t be
further simplified.</p>
</div>
</div>
</div>
<p>So now that we’ve created a dummy vector to play with, how do we get
at its contents?</p>
<section id="accessing-elements-using-their-indices"><h2 class="section-heading">Accessing elements using their indices<a class="anchor" aria-label="anchor" href="#accessing-elements-using-their-indices"></a>
</h2>
<hr class="half-width">
<p>To extract elements of a vector we can give their corresponding
index, starting from one:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">a</span> </span>
<span><span class="fl">5.4</span> </span></code></pre>
</div>
<p>It may look different, but the square brackets operator is a
function. For vectors (and matrices), it means “get me the nth
element”.</p>
<p>We can ask for multiple elements at once:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c 
5.4 7.1 </code></pre>
</div>
<p>Or slices of the vector:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d 
5.4 6.2 7.1 4.8 </code></pre>
</div>
<p>the <code>:</code> operator creates a sequence of numbers from the
left element to the right.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4</code></pre>
</div>
<p>We can ask for the same element multiple times:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   a   c 
5.4 5.4 7.1 </code></pre>
</div>
<p>If we ask for an index beyond the length of the vector, R will return
a missing value:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;NA&gt; 
  NA </code></pre>
</div>
<p>This is a vector of length one containing an <code>NA</code>, whose
name is also <code>NA</code>.</p>
<p>If we ask for the 0th element, we get an empty vector:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>named numeric(0)</code></pre>
</div>
<div id="vector-numbering-in-r-starts-at-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="vector-numbering-in-r-starts-at-1" class="callout-inner">
<h3 class="callout-title">Vector numbering in R starts at 1<a class="anchor" aria-label="anchor" href="#vector-numbering-in-r-starts-at-1"></a>
</h3>
<div class="callout-content">
<p>In many programming languages (C and Python, for example), the first
element of a vector has an index of 0. In R, the first element is 1.</p>
</div>
</div>
</div>
</section><section id="skipping-and-removing-elements"><h2 class="section-heading">Skipping and removing elements<a class="anchor" aria-label="anchor" href="#skipping-and-removing-elements"></a>
</h2>
<hr class="half-width">
<p>If we use a negative number as the index of a vector, R will return
every element <em>except</em> for the one specified:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c   d   e 
5.4 7.1 4.8 7.5 </code></pre>
</div>
<p>We can skip multiple elements:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span>  <span class="co"># or x[-c(1,5)]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d 
6.2 7.1 4.8 </code></pre>
</div>
<div id="tip-order-of-operations" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tip-order-of-operations" class="callout-inner">
<h3 class="callout-title">Tip: Order of operations<a class="anchor" aria-label="anchor" href="#tip-order-of-operations"></a>
</h3>
<div class="callout-content">
<p>A common trip up for novices occurs when trying to skip slices of a
vector. It’s natural to to try to negate a sequence like so:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre>
</div>
<p>This gives a somewhat cryptic error:</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in x[-1:3]: only 0's may be mixed with negative subscripts</code></pre>
</div>
<p>But remember the order of operations. <code>:</code> is really a
function. It takes its first argument as -1, and its second as 3, so
generates the sequence of numbers: <code>c(-1, 0, 1, 2, 3)</code>.</p>
<p>The correct solution is to wrap that function call in brackets, so
that the <code>-</code> operator applies to the result:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  d   e 
4.8 7.5 </code></pre>
</div>
</div>
</div>
</div>
<p>To remove elements from a vector, we need to assign the result back
into the variable:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">x</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   e 
5.4 6.2 7.1 7.5 </code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Given the following code:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e 
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>Come up with at least 3 different commands that will produce the
following output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d 
6.2 7.1 4.8 </code></pre>
</div>
<p>After you find 3 different commands, compare notes with your
neighbour. Did you have different strategies?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d 
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d 
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d 
6.2 7.1 4.8 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d 
6.2 7.1 4.8 </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="subsetting-by-name"><h2 class="section-heading">Subsetting by name<a class="anchor" aria-label="anchor" href="#subsetting-by-name"></a>
</h2>
<hr class="half-width">
<p>We can extract elements by using their name, instead of extracting by
index:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>a <span class="op">=</span> <span class="fl">5.4</span>, b <span class="op">=</span> <span class="fl">6.2</span>, c <span class="op">=</span> <span class="fl">7.1</span>, d <span class="op">=</span> <span class="fl">4.8</span>, e <span class="op">=</span> <span class="fl">7.5</span><span class="op">)</span> <span class="co"># we can name a vector 'on the fly'</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c 
5.4 7.1 </code></pre>
</div>
<p>This is usually a much more reliable way to subset objects: the
position of various elements can often change when chaining together
subsetting operations, but the names will always remain the same!</p>
</section><section id="subsetting-through-other-logical-operations"><h2 class="section-heading">Subsetting through other logical operations<a class="anchor" aria-label="anchor" href="#subsetting-through-other-logical-operations"></a>
</h2>
<hr class="half-width">
<p>We can also use any logical vector to subset. Since comparison
operators (e.g. <code>&gt;</code>, <code>&lt;</code>, <code>==</code>)
evaluate to logical vectors, we can also use them to succinctly subset
vectors: the following statement gives the same result as the previous
one.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">7</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  c   e 
7.1 7.5 </code></pre>
</div>
<p>Breaking it down, this statement first evaluates <code>x&gt;7</code>,
generating a logical vector
<code>c(FALSE, FALSE, TRUE, FALSE, TRUE)</code>, and then selects the
elements of <code>x</code> corresponding to the <code>TRUE</code>
values.</p>
<p>We can use <code>==</code> to mimic the previous method of indexing
by name (remember you have to use <code>==</code> rather than
<code>=</code> for comparisons):</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>  <span class="va">a</span> </span>
<span><span class="fl">5.4</span> </span></code></pre>
</div>
<p>We can also evaluate multiple logical criteria. For example, if we
want all values of x that are greater than 5 <em>and</em> less than 7;
we can use <code>&amp;</code> to denote “and”:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">7</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b 
5.4 6.2 </code></pre>
</div>
<p>Or, maybe we want the values less than 5 <em>or</em> more than 7; we
can use ‘|’ to denote “or”:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">5</span> <span class="op">|</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">7</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  c   d   e 
7.1 4.8 7.5 </code></pre>
</div>
<p>Finally, we can evaluate whether variables are present in another
vector by using the <code>%in%</code> command. For example, if we wanted
to grab all values of x with the names “a”, “c”, and “d” we could do
this:</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c   d 
5.4 7.1 4.8 </code></pre>
</div>
<p>which is just a simpler way of writing it like this:</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"a"</span> <span class="op">|</span> <span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"c"</span> <span class="op">|</span> <span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"d"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   c   d 
5.4 7.1 4.8 </code></pre>
</div>
<p>We also might want to grab the values that are <em>not</em> equal to
something. For this we can pair the <code>!</code> symbol with the
<code>=</code> (equal to), <code>&gt;</code> (greater than),
<code>&lt;</code> (less than), <code>&gt;=</code> (greater than or equal
to), <code>&lt;=</code> (less than or equal to) symbols to say we want
the <em>opposite</em> answer. For example, this will return all values
in <code>x</code> that do <em>not</em> have the name <code>a</code>:</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"a"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  b   c   d   e 
6.2 7.1 4.8 7.5 </code></pre>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Given the following code:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">6.2</span>, <span class="fl">7.1</span>, <span class="fl">4.8</span>, <span class="fl">7.5</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   c   d   e 
5.4 6.2 7.1 4.8 7.5 </code></pre>
</div>
<p>Write a subsetting command to return the values in x that are greater
than 4 and less than 7.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_subset</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">&lt;</span><span class="fl">7</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">&gt;</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">x_subset</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  a   b   d 
5.4 6.2 4.8 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="handling-special-values" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="handling-special-values" class="callout-inner">
<h3 class="callout-title">Handling special values<a class="anchor" aria-label="anchor" href="#handling-special-values"></a>
</h3>
<div class="callout-content">
<p>At some point you will encounter functions in R that cannot handle
missing, infinite, or undefined data.</p>
<p>There are a number of special functions you can use to filter out
this data:</p>
<ul>
<li>
<code>is.na</code> will return all positions in a vector, matrix, or
data frame containing <code>NA</code> (or <code>NaN</code>)</li>
<li>likewise, <code>is.nan</code>, and <code>is.infinite</code> will do
the same for <code>NaN</code> and <code>Inf</code>.</li>
<li>
<code>is.finite</code> will return all positions in a vector,
matrix, or data.frame that do not contain <code>NA</code>,
<code>NaN</code> or <code>Inf</code>.</li>
<li>
<code>na.omit</code> will filter out all missing values from a
vector</li>
</ul>
</div>
</div>
</div>
</section><section id="data-frames"><h2 class="section-heading">Data frames<a class="anchor" aria-label="anchor" href="#data-frames"></a>
</h2>
<hr class="half-width">
<p>Remember the data frames are lists underneath the hood, so similar
rules apply. However they are also two dimensional objects:</p>
<p><code>[]</code> with one argument will act the same way as for lists,
where each list element corresponds to a column. The resulting object
will be a data frame:</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read in gapminder data if you don't have it already</span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       pop
1  8425333
2  9240934
3 10267083
4 11537966
5 13079460
6 14880372</code></pre>
</div>
<p>Similarly, <code>[[]]</code> will act to extract the <em>values</em>
from a single column:</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[[</span><span class="st">"lifeExp"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 28.801 30.332 31.997 34.020 36.088 38.438</code></pre>
</div>
<p>And <code>$</code> provides a convenient shorthand to extract columns
by name:</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1952 1957 1962 1967 1972 1977</code></pre>
</div>
<p>To select specific rows and/or columns, you can provide two arguments
to <code>[]</code>. Remember that the way to index data frames is always
<code>object[row(s), column(s)]</code>.</p>
<div class="codewrapper sourceCode" id="cb66">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007</code></pre>
</div>
<p>If we subset a single row, the result will be a data frame (because
the elements are mixed types):</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap
3 Afghanistan 1962 10267083      Asia  31.997  853.1007</code></pre>
</div>
<p>But for a single column the result will be a vector (this can be
changed with the third argument, <code>drop = FALSE</code>).</p>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge 3<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<p>Fix each of the following common data frame subsetting errors:</p>
<ol style="list-style-type: decimal">
<li>Extract observations collected for the year 1957</li>
</ol>
<div class="codewrapper sourceCode" id="cb70">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a>gapminder[gapminder<span class="sc">$</span>year <span class="ot">=</span> <span class="dv">1957</span>, ]</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Extract all columns except 1 through to 4</li>
</ol>
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Extract the rows where the life expectancy is longer the 80
years</li>
</ol>
<div class="codewrapper sourceCode" id="cb72">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">80</span><span class="op">]</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Extract the first row, and the fourth and fifth columns
(<code>lifeExp</code> and <code>gdpPercap</code>).</li>
</ol>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">]</span></span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Advanced: extract rows that contain information for the years 2002
and 2007</li>
</ol>
<div class="codewrapper sourceCode" id="cb74">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span> <span class="op">|</span> <span class="fl">2007</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Fix each of the following common data frame subsetting errors:</p>
<ol style="list-style-type: decimal">
<li>Extract observations collected for the year 1957</li>
</ol>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$year = 1957, ]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1957</span>, <span class="op">]</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Extract all columns except 1 through to 4</li>
</ol>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[, -1:4]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span>,<span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Extract the rows where the life expectancy is longer the 80
years</li>
</ol>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$lifeExp &gt; 80]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">80</span>,<span class="op">]</span></span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Extract the first row, and the fourth and fifth columns
(<code>lifeExp</code> and <code>gdpPercap</code>).</li>
</ol>
<div class="codewrapper sourceCode" id="cb78">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[1, 4, 5]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="fl">1</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Advanced: extract rows that contain information for the years 2002
and 2007</li>
</ol>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># gapminder[gapminder$year == 2002 | 2007,]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span> <span class="op">|</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>,<span class="op">]</span></span>
<span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2002</span>, <span class="fl">2007</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># another, more advanced way </span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge 4<a class="anchor" aria-label="anchor" href="#challenge-4"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Why does <code>gapminder[1:20]</code> return an error? How does
it differ from <code>gapminder[1:20, ]</code>?</p></li>
<li><p>Create a new <code>data.frame</code> called
<code>gapminder_small</code> that only contains rows 1 through 9 and 19
through 23. You can do this in one or two steps.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li><p><code>gapminder</code> is a data.frame so it needs to be
subsetted on two dimensions. <code>gapminder[1:20, ]</code> subsets the
data to give the first 20 rows and all columns.</p></li>
<li>
</li>
</ol>
<div class="codewrapper sourceCode" id="cb80">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_small</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">19</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span>,<span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Indexing in R starts at 1, not 0.</li>
<li>Access individual values by location using <code>[]</code>.</li>
<li>Access slices of data using <code>[low:high]</code>.</li>
<li>Access arbitrary sets of data using <code>[c(...)]</code>.</li>
<li>Use logical operations and logical vectors to access subsets of
data.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-06-dplyr"><p>Content from <a href="06-dplyr.html">Data frame Manipulation with dplyr</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/06-dplyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I manipulate dataframes without repeating myself?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to use the six main dataframe manipulation ‘verbs’ with
pipes in <code>dplyr</code>.</li>
<li>To understand how <code>group_by()</code> and
<code>summarize()</code> can be combined to summarize datasets.</li>
<li>Be able to analyze a subset of data using logical filtering.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Manipulation of dataframes means many things to many researchers, we
often select certain observations (rows) or variables (columns), we
often group the data by a certain variable(s), or we even calculate
summary statistics. We can do these operations using the normal base R
operations:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Africa"</span>, <span class="st">"gdpPercap"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2193.755</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span>, <span class="st">"gdpPercap"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7136.11</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">gapminder</span><span class="op">[</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span>, <span class="st">"gdpPercap"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 7902.15</code></pre>
</div>
<p>But this isn’t very efficient, and can become tedious quickly because
there is a fair bit of repetition. Repeating yourself will cost you
time, both now and later, and potentially introduce some nasty bugs.</p>
<section id="the-dplyr-package"><h2 class="section-heading">The <code>dplyr</code> package<a class="anchor" aria-label="anchor" href="#the-dplyr-package"></a>
</h2>
<hr class="half-width">
<p>Luckily, the <a href="https://dplyr.tidyverse.org" class="external-link"><code>dplyr</code></a> package
provides a number of very useful functions for manipulating dataframes
in a way that will reduce the above repetition, reduce the probability
of making errors, and probably even save you some typing. As an added
bonus, you might even find the <code>dplyr</code> grammar easier to
read.</p>
<p>Here we’re going to cover 6 of the most commonly used functions as
well as using pipes (<code>%&gt;%</code>) to combine them.</p>
<ol style="list-style-type: decimal">
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li>
<code>count()</code> and <code>n()</code>
</li>
<li><code>mutate()</code></li>
</ol>
<p>If you have have not installed this package earlier, please do
so:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'dplyr'</span><span class="op">)</span></span></code></pre>
</div>
<p>Now let’s load the package:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="using-select"><h2 class="section-heading">Using <code>select()</code><a class="anchor" aria-label="anchor" href="#using-select"></a>
</h2>
<hr class="half-width">
<p>If, for example, we wanted to move forward with only a few of the
variables in our dataframe we could use the <code>select()</code>
function. This will keep only the variables you select.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/13-dplyr-fig1.png" alt="Illustration of selecting two columns from a dataframe" class="figure mx-auto d-block"></figure><p>If we open up <code>year_country_gdp</code> we’ll see that it only
contains the year, country and gdpPercap. Above we used ‘normal’
grammar, but the strengths of <code>dplyr</code> lie in combining
several functions using pipes. Since the pipes grammar is unlike
anything we’ve seen in R before, let’s repeat what we’ve done above
using pipes.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">year</span>,<span class="va">country</span>,<span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<p>To help you understand why we wrote that in that way, let’s walk
through it step by step. First we summon the <code>gapminder</code> data
frame and pass it on, using the pipe symbol <code>%&gt;%</code>, to the
next step, which is the <code>select()</code> function. In this case we
don’t specify which data object we use in the <code>select()</code>
function since in gets that from the previous pipe. <strong>Fun
Fact</strong>: You may have encountered pipes before in the shell. In R,
a pipe symbol is <code>%&gt;%</code> while in the shell it is
<code>|</code> but the concept is the same!</p>
</section><section id="using-filter"><h2 class="section-heading">Using <code>filter()</code><a class="anchor" aria-label="anchor" href="#using-filter"></a>
</h2>
<hr class="half-width">
<p>If we now wanted to move forward with the above, but only with
European countries, we can combine <code>select</code> and
<code>filter</code></p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_gdp_euro</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Write a single command (which can span multiple lines and includes
pipes) that will produce a dataframe that has the African values for
<code>lifeExp</code>, <code>country</code> and <code>year</code>, but
not for other Continents. How many rows does your dataframe have and
why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_country_lifeExp_Africa</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>                           <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span><span class="op">==</span><span class="st">"Africa"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                           <span class="fu">select</span><span class="op">(</span><span class="va">year</span>,<span class="va">country</span>,<span class="va">lifeExp</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>As with last time, first we pass the gapminder dataframe to the
<code>filter()</code> function, then we pass the filtered version of the
gapminder data frame to the <code>select()</code> function.
<strong>Note:</strong> The order of operations is very important in this
case. If we used ‘select’ first, filter would not be able to find the
variable continent since we would have removed it in the previous
step.</p>
</section><section id="using-group_by-and-summarize"><h2 class="section-heading">Using <code>group_by()</code> and <code>summarize()</code><a class="anchor" aria-label="anchor" href="#using-group_by-and-summarize"></a>
</h2>
<hr class="half-width">
<p>Now, we were supposed to be reducing the error prone repetitiveness
of what can be done with base R, but up to now we haven’t done that
since we would have to repeat the above for each continent. Instead of
<code>filter()</code>, which will only pass observations that meet your
criteria (in the above: <code>continent=="Europe"</code>), we can use
<code>group_by()</code>, which will essentially use every unique
criteria that you could have used in filter.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">str</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gropd_df [1,704 × 6] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ country  : chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr [1:1704] "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
 - attr(*, "groups")= tibble [5 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ continent: chr [1:5] "Africa" "Americas" "Asia" "Europe" ...
  ..$ .rows    : list&lt;int&gt; [1:5] 
  .. ..$ : int [1:624] 25 26 27 28 29 30 31 32 33 34 ...
  .. ..$ : int [1:300] 49 50 51 52 53 54 55 56 57 58 ...
  .. ..$ : int [1:396] 1 2 3 4 5 6 7 8 9 10 ...
  .. ..$ : int [1:360] 13 14 15 16 17 18 19 20 21 22 ...
  .. ..$ : int [1:24] 61 62 63 64 65 66 67 68 69 70 ...
  .. ..@ ptype: int(0) 
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
<p>You will notice that the structure of the dataframe where we used
<code>group_by()</code> (<code>grouped_df</code>) is not the same as the
original <code>gapminder</code> (<code>data.frame</code>). A
<code>grouped_df</code> can be thought of as a <code>list</code> where
each item in the <code>list</code>is a <code>data.frame</code> which
contains only the rows that correspond to the a particular value
<code>continent</code> (at least in the example above).</p>
<figure><img src="fig/13-dplyr-fig2.png" alt="Illustration of multiple dataframes created by piping a dataframe to group_by" class="figure mx-auto d-block"></figure></section><section id="using-summarize"><h2 class="section-heading">Using <code>summarize()</code><a class="anchor" aria-label="anchor" href="#using-summarize"></a>
</h2>
<hr class="half-width">
<p>The above was a bit on the uneventful side but
<code>group_by()</code> is much more exciting in conjunction with
<code>summarize()</code>. This will allow us to create new variable(s)
by using functions that repeat for each of the continent-specific data
frames. That is to say, using the <code>group_by()</code> function, we
split our original dataframe into multiple pieces, then we can run
functions (e.g. <code>mean()</code> or <code>sd()</code>) within
<code>summarize()</code>. To end our <code>group_by()</code>, we need to
close off the pipe by using <code>ungroup()</code>.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_bycontinents</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gdp_bycontinents</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 2
  continent mean_gdpPercap
  &lt;chr&gt;              &lt;dbl&gt;
1 Africa             2194.
2 Americas           7136.
3 Asia               7902.
4 Europe            14469.
5 Oceania           18622.</code></pre>
</div>
<figure><img src="fig/13-dplyr-fig3.png" alt="illustration of creating a summary dataframe from grouped data" class="figure mx-auto d-block"></figure><p>That allowed us to calculate the mean gdpPercap for each continent,
but it gets even better.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Calculate the average life expectancy per country. Which has the
longest average life expectancy and which has the shortest average life
expectancy?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>mean_lifeExp<span class="op">=</span><span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">mean_lifeExp</span> <span class="op">==</span> <span class="fu">min</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span> <span class="op">|</span> <span class="va">mean_lifeExp</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  country      mean_lifeExp
  &lt;chr&gt;               &lt;dbl&gt;
1 Iceland              76.5
2 Sierra Leone         36.8</code></pre>
</div>
<p>Another way to do this is to use the <code>dplyr</code> function
<code>arrange()</code>, which arranges the rows in a data frame
according to the order of one or more variables from the data frame. It
has similar syntax to other functions from the <code>dplyr</code>
package. You can use <code>desc()</code> inside <code>arrange()</code>
to sort in descending order.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country      mean_lifeExp
  &lt;chr&gt;               &lt;dbl&gt;
1 Sierra Leone         36.8</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeExp_bycountry</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  country mean_lifeExp
  &lt;chr&gt;          &lt;dbl&gt;
1 Iceland         76.5</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The function <code>group_by()</code> allows us to group by multiple
variables. Let’s group by <code>year</code> and
<code>continent</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>That is already quite powerful, but it gets even better! You’re not
limited to defining 1 new variable in <code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_bycontinents_byyear</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span>,<span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_gdpPercap <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>            sd_gdpPercap <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,</span>
<span>            mean_pop <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>            sd_pop <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="count-and-n"><h2 class="section-heading">
<code>count()</code> and <code>n()</code><a class="anchor" aria-label="anchor" href="#count-and-n"></a>
</h2>
<hr class="half-width">
<p>A very common operation is to count the number of observations for
each group. The <code>dplyr</code> package comes with two related
functions that help with this.</p>
<p>For instance, if we wanted to check the number of countries included
in the dataset for the year 2002, we can use the <code>count()</code>
function. It takes the name of one or more columns that contain the
groups we are interested in, and we can optionally sort the results in
descending order by adding <code>sort=TRUE</code>:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">continent</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  continent  n
1    Africa 52
2      Asia 33
3    Europe 30
4  Americas 25
5   Oceania  2</code></pre>
</div>
<p>If we need to use the number of observations in calculations, the
<code>n()</code> function is useful. For instance, if we wanted to get
the standard error of the life expectancy per continent:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>sd_le <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="co"># standard deviation</span></span>
<span>            n_le <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="co"># number of observations</span></span>
<span>            se_le <span class="op">=</span> <span class="va">sd_le</span><span class="op">/</span><span class="fu">sqrt</span><span class="op">(</span><span class="va">n_le</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># standard error</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 4
  continent sd_le  n_le se_le
  &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
1 Africa     9.15   624 0.366
2 Americas   9.35   300 0.540
3 Asia      11.9    396 0.596
4 Europe     5.43   360 0.286
5 Oceania    3.80    24 0.775</code></pre>
</div>
<p>In the above example, we chained together several summary operations
to simplify our calculation of standard error. We can also chain
operations to calculate the <code>minimum</code>, <code>maximum</code>,
<code>mean</code> and <code>se</code> of each continent’s per-country
life-expectancy. This time, we will calculate the <code>se</code> in
just one line:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span></span>
<span>      mean_le <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      min_le <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>      max_le <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 4
  continent mean_le min_le max_le
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Africa       48.9   23.6   76.4
2 Americas     64.7   37.6   80.7
3 Asia         60.1   28.8   82.6
4 Europe       71.9   43.6   81.8
5 Oceania      74.3   69.1   81.2</code></pre>
</div>
</section><section id="using-mutate"><h2 class="section-heading">Using <code>mutate()</code><a class="anchor" aria-label="anchor" href="#using-mutate"></a>
</h2>
<hr class="half-width">
<p>We can also create new variables prior to (or even after) summarizing
information using <code>mutate()</code>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_pop_billion</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>gdp_billion <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">*</span><span class="va">pop</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">gdp_pop_billion</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      country year      pop continent lifeExp gdpPercap gdp_billion
1 Afghanistan 1952  8425333      Asia  28.801  779.4453    6.567086
2 Afghanistan 1957  9240934      Asia  30.332  820.8530    7.585449
3 Afghanistan 1962 10267083      Asia  31.997  853.1007    8.758856
4 Afghanistan 1967 11537966      Asia  34.020  836.1971    9.648014
5 Afghanistan 1972 13079460      Asia  36.088  739.9811    9.678553
6 Afghanistan 1977 14880372      Asia  38.438  786.1134   11.697659</code></pre>
</div>
</section><section id="other-great-resources"><h2 class="section-heading">Other great resources<a class="anchor" aria-label="anchor" href="#other-great-resources"></a>
</h2>
<hr class="half-width">
<ul>
<li><a href="https://r4ds.had.co.nz/" class="external-link">R for Data Science</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling Cheat sheet</a></li>
<li><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html" class="external-link">Introduction
to dplyr</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/" class="external-link">Data
wrangling with R and RStudio</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>dplyr</code> package to manipulate dataframes.</li>
<li>Use <code>select()</code> to choose variables from a dataframe.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work
with subsets of data.</li>
<li>Use <code>count()</code> and <code>n()</code> to obtain the number
of observations in columns.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-07-plot-ggplot2"><p>Content from <a href="07-plot-ggplot2.html">Introduction to Visualization</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/07-plot-ggplot2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the basics of creating graphics in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to use ggplot2 to generate histograms and bar plots.</li>
<li>To apply geometry and aesthetic layers to a ggplot plot.</li>
<li>To manipulate the aesthetics of a plot using different colors and
position parameters.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Plotting our data is one of the best ways to quickly explore it and
the various relationships between variables. There are three main
plotting systems in R, the <a href="https://www.statmethods.net/graphs/" class="external-link">base plotting system</a>, the
<a href="https://www.statmethods.net/advgraphs/trellis.html" class="external-link">lattice</a>
package, and the <a href="https://www.statmethods.net/advgraphs/ggplot2.html" class="external-link">ggplot2</a>
package. In this lesson we’ll be learning about the ggplot2 package,
because it is the most effective for creating publication quality
graphics. In this episode, we will introduce the key features of a
ggplot and make a few example plots. We will expand on these concepts
and see how they apply to geospatial data types when we start working
with geospatial data in the <a href="https://datacarpentry.org/r-raster-vector-geospatial/" class="external-link">R for
Raster and Vector Data</a> lesson.</p>
<p><code>ggplot2</code> is built on the grammar of graphics, the idea
that any plot can be expressed from the same set of components: a
<strong>data</strong> set, a <strong>coordinate system</strong>, and a
set of <strong>geoms</strong>--the visual representation of data points.
The key to understanding <code>ggplot2</code> is thinking about a figure
in layers. This idea may be familiar to you if you have used image
editing programs like Photoshop, Illustrator, or Inkscape. In this
episode we will focus on two geoms</p>
<ul>
<li>histograms</li>
<li>bar plots</li>
</ul>
<p>Let’s start by loading in the appropriate packages and data. Remember
that we will have to load libraries and data at the start of each R
script.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>For our first example, we will be plotting the distribution of life
expectancy in our dataset. The first thing we do is call the
<code>ggplot</code> function. This function lets R know that we’re
creating a new plot, and any of the arguments we give the
<code>ggplot()</code> function are the global options for the plot: they
apply to all layers on the plot.</p>
<p>We will pass in two arguments to <code>ggplot</code>. First, we tell
<code>ggplot</code> what data we want to show on our figure, in this
example we use the gapminder data we read in earlier. For the second
argument we pass in the <code>mapping = aes()</code> function, which
tells <code>ggplot</code> how variables in the data map to aesthetic
properties of the figure. Here we will tell <code>ggplot</code> we want
to plot the “lifeExp” column of the gapminder data frame on the x-axis.
We don’t need to specify a y-axis for histograms.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/07-plot-ggplot2-rendered-lifeExp-vs-gdpPercap-scatter-1.png" alt="Histogram of life expectancy by country showing bimodal distribution with modes at 45 and 75" class="figure mx-auto d-block"><figcaption>
Histogram of life expectancy by country showing bimodal distribution
with modes at 45 and 75
</figcaption></figure><p>By itself, the call to <code>ggplot</code> isn’t enough to draw a
figure:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/07-plot-ggplot2-rendered-blank-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We need to tell <code>ggplot</code> how we want to visually represent
the data, which we do by adding a geom layer. In our example, we used
<code>geom_histogram()</code>, which tells <code>ggplot</code> we want
to visually represent the distribution of one variable (in our case
“lifeExp”):</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure style="text-align: center"><img src="fig/07-plot-ggplot2-rendered-lifeExp-vs-gdpPercap-scatter2-1.png" alt="Histogram of life expectancy by country showing bimodal distribution with modes at 45 and 75" class="figure mx-auto d-block"><figcaption>
Histogram of life expectancy by country showing bimodal distribution
with modes at 45 and 75
</figcaption></figure><div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Modify the example so that the figure shows the distribution of gdp
per capita, rather than life expectancy:</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span> <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/07-plot-ggplot2-rendered-ch1-sol-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>The histogram is a useful tool for visualizing the distribution of a
single categorical variable. What if we want to compare the gdp per
capita of the countries in our dataset? We can use a bar (or column)
plot. To simplify our plot, let’s look at data only from the most recent
year and only from countries in the Americas.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_small</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span> <span class="op">&amp;</span> <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span></span></code></pre>
</div>
<p>This time, we will use the <code>geom_col()</code> function as our
geometry. We will plot countries on the x-axis (listed in alphabetic
order by default) and gdp per capita on the y-axis.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder_small</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/07-plot-ggplot2-rendered-hist-subset-gapminder-1.png" alt="Barplot of GDP per capita. Country names on x-axis overlap and are not readable" class="figure mx-auto d-block"><figcaption>
Barplot of GDP per capita. Country names on x-axis overlap and are not
readable
</figcaption></figure><p>With this many bars plotted, it’s impossible to read all of the
x-axis labels. A quick fix to this is the add the
<code>coord_flip()</code> function to the end of our plot code.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder_small</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/07-plot-ggplot2-rendered-hist-subset-gapminder-flipped-1.png" alt="Barplot showing GDP per capita. Country names on the y-axis are readable" class="figure mx-auto d-block"><figcaption>
Barplot showing GDP per capita. Country names on the y-axis are readable
</figcaption></figure><p>There are more sophisticated ways of modifying axis labels. We will
be learning some of those methods later in this workshop.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>In the previous examples and challenge we’ve used the
<code>aes</code> function to tell the <code>geom_histogram()</code> and
<code>geom_col()</code> functions which columns of the data set to plot.
Another aesthetic property we can modify is the color. Create a new bar
(column) plot showing the gdp per capita of all countries in the
Americas for the years 1952 and 2007, color coded by year.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>First we create a new object with our filtered data:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_small_2</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>                        <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span>,</span>
<span>                               <span class="va">year</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">2007</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Then we plot that data using the <code>geom_col()</code> geom
function. We color bars using the <code>fill</code> parameter within the
<code>aes()</code> function. Since there are multiple bars for each
country, we use the <code>position</code> parameter to “dodge” them so
they appear side-by-side. The default behavior for <code>postion</code>
in <code>geom_col()</code> is “stack”.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder_small_2</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, </span>
<span>       fill <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_col</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/07-plot-ggplot2-rendered-gpd-per-cap-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>The examples given here are just the start of creating complex and
beautiful graphics with R. In a later lesson we will go into much more
depth, including:</p>
<ul>
<li>plotting geospatial specific data types</li>
<li>adjusting the color scheme of our plots</li>
<li>setting and formatting plot titles, subtitles, and axis labels</li>
<li>creating multi-panel plots</li>
<li>creating point (scatter) and line plots</li>
<li>layering datasets to create multi-layered plots</li>
<li>creating and customizing a plot legend</li>
<li>and much more!</li>
</ul>
<p>The examples we’ve worked through in this episode should give you the
building blocks for working with the more complex graphic types and
customizations we will be working with in that lesson.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>ggplot2</code> to create plots.</li>
<li>Think about graphics in layers: aesthetics, geometry, etc.</li>
</ul>
</div>
</div>
</div></section><section id="aio-08-writing-data"><p>Content from <a href="08-writing-data.html">Writing Data</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/08-writing-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I save plots and data created in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To be able to write out plots and data from R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>First, let’s load in all relevant libraries and data to be used in
this lesson:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/gapminder_data.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We also need to create a <code>cleaned-data</code> folder within the
<code>data</code> folder and a <code>figures</code> folder within the
main project folder. We can do this manually or using code:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data/cleaned-data"</span><span class="op">)</span></span>
<span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"figures"</span><span class="op">)</span></span></code></pre>
</div>
<section id="saving-plots"><h2 class="section-heading">Saving plots<a class="anchor" aria-label="anchor" href="#saving-plots"></a>
</h2>
<hr class="half-width">
<p>You can save a plot from within RStudio using the ‘Export’ button in
the ‘Plot’ window. This will give you the option of saving as a .pdf or
as .png, .jpg or other image formats.</p>
<p>Sometimes you will want to save plots without creating them in the
‘Plot’ window first. Perhaps you want to make a pdf document, for
example. Or perhaps you’re looping through multiple subsets of a file,
plotting data from each subset, and you want to save each plot. In this
case you can use flexible approach. The <code>ggsave</code> function
saves the latest plot by default. You can control the size and
resolution using the arguments to this function.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"figures/Distribution-of-gdpPercap.pdf"</span>, width<span class="op">=</span><span class="fl">12</span>, height<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<p>Open up this document and have a look.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Create and save a new plot showing the side-by-side bar plot of gdp
per capita in countries in the Americas in the years 1952 and 2007.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_small</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder_small</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">country</span>, y <span class="op">=</span> <span class="va">gdpPercap</span>, fill <span class="op">=</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that ggsave saves by default the latest plot.</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"figures/Distribution-of-gdpPercap.pdf"</span>, width <span class="op">=</span> <span class="fl">12</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>To produce documents in different formats, change the file extension
for <code>jpeg</code>, <code>png</code>, <code>tiff</code>, or
<code>bmp</code>.</p>
</section><section id="writing-data"><h2 class="section-heading">Writing data<a class="anchor" aria-label="anchor" href="#writing-data"></a>
</h2>
<hr class="half-width">
<p>At some point, you’ll also want to write out data from R.</p>
<p>We can use the <code>write.csv</code> function for this, which is
very similar to <code>read.csv</code> from before.</p>
<p>Let’s create a data-cleaning script, for this analysis, we only want
to focus on the gapminder data for Australia:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aust_subset</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Australia"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write.csv</span><span class="op">(</span><span class="va">aust_subset</span>,</span>
<span>  file<span class="op">=</span><span class="st">"data/cleaned-data/gapminder-aus.csv"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s open the file to make sure it contains the data we expect.
Navigate to your <code>cleaned-data</code> directory and double-click
the file name. It will open using your computer’s default for opening
files with a <code>.csv</code> extension. To open in a specific
application, right click and select the application. Using a spreadsheet
program (like Excel) to open this file shows us that we do have properly
formatted data including only the data points from Australia. However,
there are row numbers associated with the data that are not useful to us
(they refer to the row numbers from the gapminder data frame).</p>
<p>Let’s look at the help file to work out how to change this
behaviour.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">write.csv</span></span></code></pre>
</div>
<p>By default R will write out the row and column names when writing
data to a file. To over write this behavior, we can do the
following:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write.csv</span><span class="op">(</span></span>
<span>  <span class="va">aust_subset</span>,</span>
<span>  file<span class="op">=</span><span class="st">"data/cleaned-data/gapminder-aus.csv"</span>,</span>
<span>  row.names<span class="op">=</span><span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Subset the gapminder data to include only data points collected since
1990. Write out the new subset to a file in the
<code>cleaned-data/</code> directory.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_after_1990</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1990</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write.csv</span><span class="op">(</span><span class="va">gapminder_after_1990</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"cleaned-data/gapminder-after-1990.csv"</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Save plots using <code>ggsave()</code>.</li>
<li>Use <code>write.csv</code> to save tabular data.</li>
</ul>
</div>
</div>
</div>

<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-09-raster-structure"><p>Content from <a href="09-raster-structure.html">Intro to Raster Data</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/09-raster-structure.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a raster dataset?</li>
<li>How do I work with and plot raster data in R?</li>
<li>How can I handle missing or bad data values for a raster?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the fundamental attributes of a raster dataset.</li>
<li>Explore raster attributes and metadata using R.</li>
<li>Import rasters into R using the <code>terra</code> package.</li>
<li>Plot a raster file in R using the <code>ggplot2</code> package.</li>
<li>Describe the difference between single- and multi-band rasters.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In this episode, we will introduce the fundamental principles,
packages and metadata/raster attributes that are needed to work with
raster data in R. We will discuss some of the core metadata elements
that we need to understand to work with rasters in R, including CRS and
resolution. We will also explore missing and bad data values as stored
in a raster and how R handles these elements.</p>
<p>We will continue to work with the <code>dplyr</code> and
<code>ggplot2</code> packages. We will use one additional package in
this episode to work with raster data - the <code>terra</code> package.
Make sure that you have all packages loaded.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span></code></pre>
</div>
<p>In this episode, we’ll be working with raster data collected from the
Harvard Forest site. These data were collected using remote sensing
(LiDAR) and include estimates of a canopy height model, digital
elevation model, and digital surface model of the field site. Today we
will be focusing on the digital surface model.</p>
<section id="view-raster-file-attributes"><h2 class="section-heading">View Raster File Attributes<a class="anchor" aria-label="anchor" href="#view-raster-file-attributes"></a>
</h2>
<hr class="half-width">
<p>We will be working with a series of GeoTIFF files in this lesson. The
GeoTIFF format contains a set of embedded tags with metadata about the
raster data. We can use the function <code>describe()</code> in the
<code>terra</code> package to get information about our raster data
before we read that data into R. It is ideal to do this before importing
your data.</p>

<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                                                                                                                                                                          
 [2] "Files: data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif"                                                                                                                                                                                                          
 [3] "Size is 1697, 1367"                                                                                                                                                                                                                                                             
 [4] "Coordinate System is:"                                                                                                                                                                                                                                                          
 [5] "PROJCRS[\"WGS 84 / UTM zone 18N\","                                                                                                                                                                                                                                             
 [6] "    BASEGEOGCRS[\"WGS 84\","                                                                                                                                                                                                                                                    
 [7] "        DATUM[\"World Geodetic System 1984\","                                                                                                                                                                                                                                  
 [8] "            ELLIPSOID[\"WGS 84\",6378137,298.257223563,"                                                                                                                                                                                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                                                                                                                                                                                     
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                                                                                                                                                                                
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                                                                                                                                                                         
[12] "        ID[\"EPSG\",4326]],"                                                                                                                                                                                                                                                    
[13] "    CONVERSION[\"UTM zone 18N\","                                                                                                                                                                                                                                               
[14] "        METHOD[\"Transverse Mercator\","                                                                                                                                                                                                                                        
[15] "            ID[\"EPSG\",9807]],"                                                                                                                                                                                                                                                
[16] "        PARAMETER[\"Latitude of natural origin\",0,"                                                                                                                                                                                                                            
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                                                                                                                                                                          
[18] "            ID[\"EPSG\",8801]],"                                                                                                                                                                                                                                                
[19] "        PARAMETER[\"Longitude of natural origin\",-75,"                                                                                                                                                                                                                         
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                                                                                                                                                                          
[21] "            ID[\"EPSG\",8802]],"                                                                                                                                                                                                                                                
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9996,"                                                                                                                                                                                                                   
[23] "            SCALEUNIT[\"unity\",1],"                                                                                                                                                                                                                                            
[24] "            ID[\"EPSG\",8805]],"                                                                                                                                                                                                                                                
[25] "        PARAMETER[\"False easting\",500000,"                                                                                                                                                                                                                                    
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                                                                                                                                                                           
[27] "            ID[\"EPSG\",8806]],"                                                                                                                                                                                                                                                
[28] "        PARAMETER[\"False northing\",0,"                                                                                                                                                                                                                                        
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                                                                                                                                                                           
[30] "            ID[\"EPSG\",8807]]],"                                                                                                                                                                                                                                               
[31] "    CS[Cartesian,2],"                                                                                                                                                                                                                                                           
[32] "        AXIS[\"(E)\",east,"                                                                                                                                                                                                                                                     
[33] "            ORDER[1],"                                                                                                                                                                                                                                                          
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                                                                                                                                                                          
[35] "        AXIS[\"(N)\",north,"                                                                                                                                                                                                                                                    
[36] "            ORDER[2],"                                                                                                                                                                                                                                                          
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                                                                                                                                                                          
[38] "    USAGE["                                                                                                                                                                                                                                                                     
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                                                                                                                                                                                   
[40] "        AREA[\"Between 78°W and 72°W, northern hemisphere between equator and 84°N, onshore and offshore. Bahamas. Canada - Nunavut; Ontario; Quebec. Colombia. Cuba. Ecuador. Greenland. Haiti. Jamaica. Panama. Turks and Caicos Islands. United States (USA). Venezuela.\"],"
[41] "        BBOX[0,-78,84,-72]],"                                                                                                                                                                                                                                                   
[42] "    ID[\"EPSG\",32618]]"                                                                                                                                                                                                                                                        
[43] "Data axis to CRS axis mapping: 1,2"                                                                                                                                                                                                                                             
[44] "Origin = (731453.000000000000000,4713838.000000000000000)"                                                                                                                                                                                                                      
[45] "Pixel Size = (1.000000000000000,-1.000000000000000)"                                                                                                                                                                                                                            
[46] "Metadata:"                                                                                                                                                                                                                                                                      
[47] "  AREA_OR_POINT=Area"                                                                                                                                                                                                                                                           
[48] "Image Structure Metadata:"                                                                                                                                                                                                                                                      
[49] "  COMPRESSION=LZW"                                                                                                                                                                                                                                                              
[50] "  INTERLEAVE=BAND"                                                                                                                                                                                                                                                              
[51] "Corner Coordinates:"                                                                                                                                                                                                                                                            
[52] "Upper Left  (  731453.000, 4713838.000) ( 72d10'52.71\"W, 42d32'32.18\"N)"                                                                                                                                                                                                      
[53] "Lower Left  (  731453.000, 4712471.000) ( 72d10'54.71\"W, 42d31'47.92\"N)"                                                                                                                                                                                                      
[54] "Upper Right (  733150.000, 4713838.000) ( 72d 9'38.40\"W, 42d32'30.35\"N)"                                                                                                                                                                                                      
[55] "Lower Right (  733150.000, 4712471.000) ( 72d 9'40.41\"W, 42d31'46.08\"N)"                                                                                                                                                                                                      
[56] "Center      (  732301.500, 4713154.500) ( 72d10'16.56\"W, 42d32' 9.13\"N)"                                                                                                                                                                                                      
[57] "Band 1 Block=1697x1 Type=Float64, ColorInterp=Gray"                                                                                                                                                                                                                             
[58] "  Min=305.070 Max=416.070 "                                                                                                                                                                                                                                                     
[59] "  Minimum=305.070, Maximum=416.070, Mean=359.853, StdDev=17.832"                                                                                                                                                                                                                
[60] "  NoData Value=-9999"                                                                                                                                                                                                                                                           
[61] "  Metadata:"                                                                                                                                                                                                                                                                    
[62] "    STATISTICS_MAXIMUM=416.06997680664"                                                                                                                                                                                                                                         
[63] "    STATISTICS_MEAN=359.85311802914"                                                                                                                                                                                                                                            
[64] "    STATISTICS_MINIMUM=305.07000732422"                                                                                                                                                                                                                                         
[65] "    STATISTICS_STDDEV=17.83169335933"                                                                                                                                                                                                                                           </code></pre>
</div>
<p>If you wish to store this information in R, you can do the
following:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HARV_dsmCrop_info</span> <span class="op">&lt;-</span> <span class="fu">capture.output</span><span class="op">(</span></span>
<span>  <span class="fu">describe</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Each line of text that was printed to the console is now stored as an
element of the character vector <code>HARV_dsmCrop_info</code>. We will
be exploring this data throughout this episode. By the end of this
episode, you will be able to explain and understand the output
above.</p>
</section><section id="open-a-raster-in-r"><h2 class="section-heading">Open a Raster in R<a class="anchor" aria-label="anchor" href="#open-a-raster-in-r"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve previewed the metadata for our GeoTIFF, let’s import
this raster dataset into R and explore its metadata more closely. We can
use the <code>rast()</code> function in the <code>terra</code> package
to open a raster in R.</p>
<div id="data-tip---object-names" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---object-names" class="callout-inner">
<h3 class="callout-title">Data Tip - Object names<a class="anchor" aria-label="anchor" href="#data-tip---object-names"></a>
</h3>
<div class="callout-content">
<p>To improve code readability, file and object names should be used
that make it clear what is in the file. The data for this episode were
collected from Harvard Forest so we’ll use a naming convention of
<code>datatype_HARV</code>.</p>
</div>
</div>
</div>
<p>First we will load our raster file into R and view the data
structure.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_HARV</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 1367, 1697, 1  (nrow, ncol, nlyr)
resolution  : 1, 1  (x, y)
extent      : 731453, 733150, 4712471, 4713838  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 18N (EPSG:32618) 
source      : HARV_dsmCrop.tif 
name        : HARV_dsmCrop 
min value   :       305.07 
max value   :       416.07 </code></pre>
</div>
<p>The information above includes a report of min and max values, but no
other data range statistics. Similar to other R data structures like
vectors and data frame columns, descriptive statistics for raster data
can be retrieved like</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: [summary] used a sample</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  HARV_dsmCrop  
 Min.   :305.6  
 1st Qu.:345.6  
 Median :359.6  
 Mean   :359.8  
 3rd Qu.:374.3  
 Max.   :414.7  </code></pre>
</div>
<p>but note the warning - unless you force R to calculate these
statistics using every cell in the raster, it will take a random sample
of 100,000 cells and calculate from that instead. To force calculation
all the values, you can use the function <code>values</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  HARV_dsmCrop  
 Min.   :305.1  
 1st Qu.:345.6  
 Median :359.7  
 Mean   :359.9  
 3rd Qu.:374.3  
 Max.   :416.1  </code></pre>
</div>
<p>We can visualise this data in R either using the <code>terra</code>
<code>plot()</code> function, or by using <code>ggplot2</code>. To
visualise the data using <code>terra</code>, we run this line of
code:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/09-raster-structure-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To visualise this data in R using <code>ggplot2</code>, we need to
convert it to a dataframe. We learned about dataframes in the Exploring
Data Frames lesson. The <code>terra</code> package has an built-in
function for conversion to a plotable dataframe. Setting
<code>xy = TRUE</code> maintains the spatial locations of the data, so
that we can plot the data as a map.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now when we view the structure of our data, we will see a standard
dataframe format.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">DSM_HARV_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	2319799 obs. of  3 variables:
 $ x           : num  731454 731454 731456 731456 731458 ...
 $ y           : num  4713838 4713838 4713838 4713838 4713838 ...
 $ HARV_dsmCrop: num  409 408 407 407 409 ...</code></pre>
</div>
<p>We can use <code>ggplot()</code> to plot this data. We will set the
color scale to <code>scale_fill_viridis_c</code> which is a
color-blindness friendly color scale. We will also use the
<code>coord_quickmap()</code> function to use an approximate Mercator
projection for our plots. This approximation is suitable for small areas
that are not too close to the poles. Other coordinate systems are
available in ggplot2 if needed, you can learn about them at their help
page <code>?coord_map</code>.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span> , </span>
<span>                mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_dsmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/09-raster-structure-rendered-ggplot-raster-1.png" alt="Raster plot with ggplot2 using the viridis color scale" class="figure mx-auto d-block"><figcaption>
Raster plot with ggplot2 using the viridis color scale
</figcaption></figure><div id="plotting-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="plotting-tip" class="callout-inner">
<h3 class="callout-title">Plotting Tip<a class="anchor" aria-label="anchor" href="#plotting-tip"></a>
</h3>
<div class="callout-content">
<p>More information about the Viridis palette used above at <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html" class="external-link">R
Viridis package documentation</a>.</p>
</div>
</div>
</div>
<p>This map shows the elevation of our study site in Harvard Forest.
From the legend, we can see that the maximum elevation is ~400, but we
can’t tell whether this is 400 feet or 400 meters because the legend
doesn’t show us the units. We can look at the metadata of our object to
see what the units are. Much of the metadata that we’re interested in is
part of the CRS.</p>
<p>Now we will see how features of the CRS appear in our data file and
what meanings they have.</p>
<div class="section level3">
<h3 id="view-raster-coordinate-reference-system-crs-in-r">View Raster Coordinate Reference System (CRS) in R<a class="anchor" aria-label="anchor" href="#view-raster-coordinate-reference-system-crs-in-r"></a>
</h3>
<p>We can view the CRS string associated with our R object using
the<code>crs()</code> function.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DSM_HARV</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs"</code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>What units are our data in?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><code>+units=m</code> tells us that our data is in meters.</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="understanding-crs-in-proj4-format"><h2 class="section-heading">Understanding CRS in Proj4 Format<a class="anchor" aria-label="anchor" href="#understanding-crs-in-proj4-format"></a>
</h2>
<hr class="half-width">
<p>The CRS for our data is given to us by R in <code>proj4</code>
format. Let’s break down the pieces of <code>proj4</code> string. The
string contains all of the individual CRS elements that R or another GIS
might need. Each element is specified with a <code>+</code> sign,
similar to how a <code>.csv</code> file is delimited or broken up by a
<code>,</code>. After each <code>+</code> we see the CRS element being
defined. For example projection (<code>proj=</code>) and datum
(<code>datum=</code>).</p>
<div class="section level3">
<h3 id="utm-proj4-string">UTM Proj4 String<a class="anchor" aria-label="anchor" href="#utm-proj4-string"></a>
</h3>
<p>A projection string (like the one of <code>DSM_HARV</code>) specifies
the UTM projection as follows:</p>
<p><code>+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0</code></p>
<ul>
<li>
<strong>proj=utm:</strong> the projection is UTM, UTM has several
zones.</li>
<li>
<strong>zone=18:</strong> the zone is 18</li>
<li>
<strong>datum=WGS84:</strong> the datum is WGS84 (the datum refers
to the 0,0 reference for the coordinate system used in the
projection)</li>
<li>
<strong>units=m:</strong> the units for the coordinates are in
meters</li>
<li>
<strong>ellps=WGS84:</strong> the ellipsoid (how the earth’s
roundness is calculated) for the data is WGS84</li>
</ul>
<p>Note that the zone is unique to the UTM projection. Not all CRSs will
have a zone. Image source: Chrismurf at English Wikipedia, via <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#/media/File:Utm-zones-USA.svg" class="external-link">Wikimedia
Commons</a> (CC-BY).</p>
<figure><img src="fig/Utm-zones-USA.svg" alt="UTM zones in the USA." class="figure mx-auto d-block"><div class="figcaption">The UTM zones across the continental United
States. From: <a href="https://upload.wikimedia.org/wikipedia/commons/8/8d/Utm-zones-USA.svg" class="external-link uri">https://upload.wikimedia.org/wikipedia/commons/8/8d/Utm-zones-USA.svg</a>
</div>
</figure>
</div>
</section><section id="calculate-raster-min-and-max-values"><h2 class="section-heading">Calculate Raster Min and Max Values<a class="anchor" aria-label="anchor" href="#calculate-raster-min-and-max-values"></a>
</h2>
<hr class="half-width">
<p>It is useful to know the minimum or maximum values of a raster
dataset. In this case, given we are working with elevation data, these
values represent the min/max elevation range at our site.</p>
<p>Raster statistics are often calculated and embedded in a GeoTIFF for
us. We can view these values:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">minmax</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    HARV_dsmCrop
min       305.07
max       416.07</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">min</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 305.07</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">max</span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 416.07</code></pre>
</div>
<div id="data-tip---set-min-and-max-values" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip---set-min-and-max-values" class="callout-inner">
<h3 class="callout-title">Data Tip - Set min and max values<a class="anchor" aria-label="anchor" href="#data-tip---set-min-and-max-values"></a>
</h3>
<div class="callout-content">
<p>If the minimum and maximum values haven’t already been calculated, we
can calculate them using the <code>setMinMax()</code> function.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV</span> <span class="op">&lt;-</span> <span class="fu">setMinMax</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>We can see that the elevation at our site ranges from 305.0700073m to
416.0699768m.</p>
</section><section id="raster-bands"><h2 class="section-heading">Raster Bands<a class="anchor" aria-label="anchor" href="#raster-bands"></a>
</h2>
<hr class="half-width">
<p>The Digital Surface Model object (<code>DSM_HARV</code>) that we’ve
been working with is a single band raster. This means that there is only
one dataset stored in the raster: surface elevation in meters for one
time period.</p>
<figure><img src="fig/dc-spatial-raster/single_multi_raster.png" alt="Multi-band raster image" class="figure mx-auto d-block"></figure><p>A raster dataset can contain one or more bands. We can use the
<code>rast()</code> function to import one single band from a single or
multi-band raster. We can view the number of bands in a raster using the
<code>nlyr()</code> function.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nlyr</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<p>However, raster data can also be multi-band, meaning that one raster
file contains data for more than one variable or time period for each
cell. By default the <code>rast()</code> function only imports the first
band in a raster regardless of whether it has one or more bands.</p>
</section><section id="dealing-with-missing-data"><h2 class="section-heading">Dealing with Missing Data<a class="anchor" aria-label="anchor" href="#dealing-with-missing-data"></a>
</h2>
<hr class="half-width">
<p>Raster data often has a <code>NoDataValue</code> associated with it.
This is a value assigned to pixels where data is missing or no data were
collected.</p>
<p>By default the shape of a raster is always rectangular. So if we have
a dataset that has a shape that isn’t rectangular, some pixels at the
edge of the raster will have <code>NoDataValue</code>s. This often
happens when the data were collected by an airplane which only flew over
some part of a defined region.</p>
<p>In the image below, the pixels that are black have
<code>NoDataValue</code>s. The camera did not collect data in these
areas.</p>
<figure><img src="fig/09-raster-structure-rendered-demonstrate-no-data-black-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In the next image, the black edges have been assigned
<code>NoDataValue</code>. R doesn’t render pixels that contain a
specified <code>NoDataValue</code>. R assigns missing data with the
<code>NoDataValue</code> as <code>NA</code>.</p>
<p>The difference here shows up as ragged edges on the plot, rather than
black spaces where there is no data.</p>
<figure><img src="fig/09-raster-structure-rendered-demonstrate-no-data-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If your raster already has <code>NA</code> values set correctly but
you aren’t sure where they are, you can deliberately plot them in a
particular colour. This can be useful when checking a dataset’s
coverage. For instance, sometimes data can be missing where a sensor
could not ‘see’ its target data, and you may wish to locate that missing
data and fill it in.</p>
<p>To highlight <code>NA</code> values in ggplot, alter the
<code>scale_fill_*()</code> layer to contain a colour instruction for
<code>NA</code> values, like
<code>scale_fill_viridis_c(na.value = 'deeppink')</code></p>
<figure><img src="fig/09-raster-structure-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The value that is conventionally used to take note of missing data
(the <code>NoDataValue</code> value) varies by the raster data type. For
floating-point rasters, the figure <code>-3.4e+38</code> is a common
default, and for integers, <code>-9999</code> is common. Some
disciplines have specific conventions that vary from these common
values.</p>
<p>In some cases, other <code>NA</code> values may be more appropriate.
An <code>NA</code> value should be a) outside the range of valid values,
and b) a value that fits the data type in use. For instance, if your
data ranges continuously from -20 to 100, 0 is not an acceptable
<code>NA</code> value! Or, for categories that number 1-15, 0 might be
fine for <code>NA</code>, but using -.000003 will force you to save the
GeoTIFF on disk as a floating point raster, resulting in a bigger
file.</p>
<p>If we are lucky, our GeoTIFF file has a tag that tells us what is the
<code>NoDataValue</code>. If we are less lucky, we can find that
information in the raster’s metadata. If a <code>NoDataValue</code> was
stored in the GeoTIFF tag, when R opens up the raster, it will assign
each instance of the value to <code>NA</code>. Values of <code>NA</code>
will be ignored by R as demonstrated above.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Use the output from the <code>describe()</code> and
<code>sources()</code> functions to find out what
<code>NoDataValue</code> is used for our <code>DSM_HARV</code> dataset.
We need to use <code>sources()</code> to give us the file path of the
<code>DSM_HARV</code> object; <code>describe()</code> only works for
file paths.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="fu">sources</span><span class="op">(</span><span class="va">DSM_HARV</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                                                                                                                                                                          
 [2] "Files: /Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif"                                                                                                                                
 [3] "Size is 1697, 1367"                                                                                                                                                                                                                                                             
 [4] "Coordinate System is:"                                                                                                                                                                                                                                                          
 [5] "PROJCRS[\"WGS 84 / UTM zone 18N\","                                                                                                                                                                                                                                             
 [6] "    BASEGEOGCRS[\"WGS 84\","                                                                                                                                                                                                                                                    
 [7] "        DATUM[\"World Geodetic System 1984\","                                                                                                                                                                                                                                  
 [8] "            ELLIPSOID[\"WGS 84\",6378137,298.257223563,"                                                                                                                                                                                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                                                                                                                                                                                     
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                                                                                                                                                                                
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                                                                                                                                                                         
[12] "        ID[\"EPSG\",4326]],"                                                                                                                                                                                                                                                    
[13] "    CONVERSION[\"UTM zone 18N\","                                                                                                                                                                                                                                               
[14] "        METHOD[\"Transverse Mercator\","                                                                                                                                                                                                                                        
[15] "            ID[\"EPSG\",9807]],"                                                                                                                                                                                                                                                
[16] "        PARAMETER[\"Latitude of natural origin\",0,"                                                                                                                                                                                                                            
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                                                                                                                                                                          
[18] "            ID[\"EPSG\",8801]],"                                                                                                                                                                                                                                                
[19] "        PARAMETER[\"Longitude of natural origin\",-75,"                                                                                                                                                                                                                         
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                                                                                                                                                                          
[21] "            ID[\"EPSG\",8802]],"                                                                                                                                                                                                                                                
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9996,"                                                                                                                                                                                                                   
[23] "            SCALEUNIT[\"unity\",1],"                                                                                                                                                                                                                                            
[24] "            ID[\"EPSG\",8805]],"                                                                                                                                                                                                                                                
[25] "        PARAMETER[\"False easting\",500000,"                                                                                                                                                                                                                                    
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                                                                                                                                                                           
[27] "            ID[\"EPSG\",8806]],"                                                                                                                                                                                                                                                
[28] "        PARAMETER[\"False northing\",0,"                                                                                                                                                                                                                                        
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                                                                                                                                                                           
[30] "            ID[\"EPSG\",8807]]],"                                                                                                                                                                                                                                               
[31] "    CS[Cartesian,2],"                                                                                                                                                                                                                                                           
[32] "        AXIS[\"(E)\",east,"                                                                                                                                                                                                                                                     
[33] "            ORDER[1],"                                                                                                                                                                                                                                                          
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                                                                                                                                                                          
[35] "        AXIS[\"(N)\",north,"                                                                                                                                                                                                                                                    
[36] "            ORDER[2],"                                                                                                                                                                                                                                                          
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                                                                                                                                                                          
[38] "    USAGE["                                                                                                                                                                                                                                                                     
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                                                                                                                                                                                   
[40] "        AREA[\"Between 78°W and 72°W, northern hemisphere between equator and 84°N, onshore and offshore. Bahamas. Canada - Nunavut; Ontario; Quebec. Colombia. Cuba. Ecuador. Greenland. Haiti. Jamaica. Panama. Turks and Caicos Islands. United States (USA). Venezuela.\"],"
[41] "        BBOX[0,-78,84,-72]],"                                                                                                                                                                                                                                                   
[42] "    ID[\"EPSG\",32618]]"                                                                                                                                                                                                                                                        
[43] "Data axis to CRS axis mapping: 1,2"                                                                                                                                                                                                                                             
[44] "Origin = (731453.000000000000000,4713838.000000000000000)"                                                                                                                                                                                                                      
[45] "Pixel Size = (1.000000000000000,-1.000000000000000)"                                                                                                                                                                                                                            
[46] "Metadata:"                                                                                                                                                                                                                                                                      
[47] "  AREA_OR_POINT=Area"                                                                                                                                                                                                                                                           
[48] "Image Structure Metadata:"                                                                                                                                                                                                                                                      
[49] "  COMPRESSION=LZW"                                                                                                                                                                                                                                                              
[50] "  INTERLEAVE=BAND"                                                                                                                                                                                                                                                              
[51] "Corner Coordinates:"                                                                                                                                                                                                                                                            
[52] "Upper Left  (  731453.000, 4713838.000) ( 72d10'52.71\"W, 42d32'32.18\"N)"                                                                                                                                                                                                      
[53] "Lower Left  (  731453.000, 4712471.000) ( 72d10'54.71\"W, 42d31'47.92\"N)"                                                                                                                                                                                                      
[54] "Upper Right (  733150.000, 4713838.000) ( 72d 9'38.40\"W, 42d32'30.35\"N)"                                                                                                                                                                                                      
[55] "Lower Right (  733150.000, 4712471.000) ( 72d 9'40.41\"W, 42d31'46.08\"N)"                                                                                                                                                                                                      
[56] "Center      (  732301.500, 4713154.500) ( 72d10'16.56\"W, 42d32' 9.13\"N)"                                                                                                                                                                                                      
[57] "Band 1 Block=1697x1 Type=Float64, ColorInterp=Gray"                                                                                                                                                                                                                             
[58] "  Min=305.070 Max=416.070 "                                                                                                                                                                                                                                                     
[59] "  Minimum=305.070, Maximum=416.070, Mean=359.853, StdDev=17.832"                                                                                                                                                                                                                
[60] "  NoData Value=-9999"                                                                                                                                                                                                                                                           
[61] "  Metadata:"                                                                                                                                                                                                                                                                    
[62] "    STATISTICS_MAXIMUM=416.06997680664"                                                                                                                                                                                                                                         
[63] "    STATISTICS_MEAN=359.85311802914"                                                                                                                                                                                                                                            
[64] "    STATISTICS_MINIMUM=305.07000732422"                                                                                                                                                                                                                                         
[65] "    STATISTICS_STDDEV=17.83169335933"                                                                                                                                                                                                                                           </code></pre>
</div>
<p><code>NoDataValue</code> are encoded as -9999.</p>
</div>
</div>
</div>
</div>
</section><section id="bad-data-values-in-rasters"><h2 class="section-heading">Bad Data Values in Rasters<a class="anchor" aria-label="anchor" href="#bad-data-values-in-rasters"></a>
</h2>
<hr class="half-width">
<p>Bad data values are different from <code>NoDataValue</code>s. Bad
data values are values that fall outside of the applicable range of a
dataset.</p>
<p>Examples of Bad Data Values:</p>
<ul>
<li>The normalized difference vegetation index (NDVI), which is a
measure of greenness, has a valid range of -1 to 1. Any value outside of
that range would be considered a “bad” or miscalculated value.</li>
<li>Reflectance data in an image will often range from 0-1 or 0-10,000
depending upon how the data are scaled. Thus a value greater than 1 or
greater than 10,000 is likely caused by an error in either data
collection or processing.</li>
</ul>
<div class="section level3">
<h3 id="find-bad-data-values">Find Bad Data Values<a class="anchor" aria-label="anchor" href="#find-bad-data-values"></a>
</h3>
<p>Sometimes a raster’s metadata will tell us the range of expected
values for a raster. Values outside of this range are suspect and we
need to consider that when we analyze the data. Sometimes, we need to
use some common sense and scientific insight as we examine the data -
just as we would for field data to identify questionable values.</p>
<p>Plotting data with appropriate highlighting can help reveal patterns
in bad values and may suggest a solution. Below, reclassification is
used to highlight elevation values over 400m with a contrasting
colour.</p>
<figure><img src="fig/09-raster-structure-rendered-demo-bad-data-highlighting-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</section><section id="create-a-histogram-of-raster-values"><h2 class="section-heading">Create A Histogram of Raster Values<a class="anchor" aria-label="anchor" href="#create-a-histogram-of-raster-values"></a>
</h2>
<hr class="half-width">
<p>We can explore the distribution of values contained within our raster
using the <code>geom_histogram()</code> function which produces a
histogram. Histograms are often useful in identifying outliers and bad
data values in our raster data.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">HARV_dsmCrop</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/09-raster-structure-rendered-view-raster-histogram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice that a warning message is thrown when R creates the
histogram.</p>
<p><code>stat_bin()</code> using <code>bins = 30</code>. Pick better
value with <code>binwidth</code>.</p>
<p>This warning is caused by a default setting in
<code>geom_histogram</code> enforcing that there are 30 bins for the
data. We can define the number of bins we want in the histogram by using
the <code>bins</code> value in the <code>geom_histogram()</code>
function.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span>, </span>
<span>                   mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">HARV_dsmCrop</span><span class="op">)</span>, </span>
<span>                   bins <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/09-raster-structure-rendered-view-raster-histogram2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that the shape of this histogram looks similar to the previous
one that was created using the default of 30 bins. The distribution of
elevation values for our <code>Digital Surface Model (DSM)</code> looks
reasonable. It is likely there are no bad data values in this particular
raster.</p>
<div id="challenge-3-explore-raster-metadata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3-explore-raster-metadata" class="callout-inner">
<h3 class="callout-title">Challenge 3: Explore Raster Metadata<a class="anchor" aria-label="anchor" href="#challenge-3-explore-raster-metadata"></a>
</h3>
<div class="callout-content">
<p>Use <code>describe()</code> to determine the following about the
<code>NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_DSMhill.tif</code>
file:</p>
<ol style="list-style-type: decimal">
<li>Does this file have the same CRS as <code>DSM_HARV</code>?</li>
<li>What is the <code>NoDataValue</code>?</li>
<li>What is resolution of the raster data?</li>
<li>How large would a 5x5 pixel area be on the Earth’s surface?</li>
<li>Is the file a multi- or single-band raster?</li>
</ol>
<p>Notice: this file is a hillshade. We will learn about hillshades in
the <a href="05-raster-multi-band-in-r/">Working with Multi-band Rasters
in R</a> episode.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">describe</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_DSMhill.tif"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Driver: GTiff/GeoTIFF"                                                                                                                                                                                                                                                          
 [2] "Files: data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_DSMhill.tif"                                                                                                                                                                                                          
 [3] "Size is 1697, 1367"                                                                                                                                                                                                                                                             
 [4] "Coordinate System is:"                                                                                                                                                                                                                                                          
 [5] "PROJCRS[\"WGS 84 / UTM zone 18N\","                                                                                                                                                                                                                                             
 [6] "    BASEGEOGCRS[\"WGS 84\","                                                                                                                                                                                                                                                    
 [7] "        DATUM[\"World Geodetic System 1984\","                                                                                                                                                                                                                                  
 [8] "            ELLIPSOID[\"WGS 84\",6378137,298.257223563,"                                                                                                                                                                                                                        
 [9] "                LENGTHUNIT[\"metre\",1]]],"                                                                                                                                                                                                                                     
[10] "        PRIMEM[\"Greenwich\",0,"                                                                                                                                                                                                                                                
[11] "            ANGLEUNIT[\"degree\",0.0174532925199433]],"                                                                                                                                                                                                                         
[12] "        ID[\"EPSG\",4326]],"                                                                                                                                                                                                                                                    
[13] "    CONVERSION[\"UTM zone 18N\","                                                                                                                                                                                                                                               
[14] "        METHOD[\"Transverse Mercator\","                                                                                                                                                                                                                                        
[15] "            ID[\"EPSG\",9807]],"                                                                                                                                                                                                                                                
[16] "        PARAMETER[\"Latitude of natural origin\",0,"                                                                                                                                                                                                                            
[17] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                                                                                                                                                                          
[18] "            ID[\"EPSG\",8801]],"                                                                                                                                                                                                                                                
[19] "        PARAMETER[\"Longitude of natural origin\",-75,"                                                                                                                                                                                                                         
[20] "            ANGLEUNIT[\"degree\",0.0174532925199433],"                                                                                                                                                                                                                          
[21] "            ID[\"EPSG\",8802]],"                                                                                                                                                                                                                                                
[22] "        PARAMETER[\"Scale factor at natural origin\",0.9996,"                                                                                                                                                                                                                   
[23] "            SCALEUNIT[\"unity\",1],"                                                                                                                                                                                                                                            
[24] "            ID[\"EPSG\",8805]],"                                                                                                                                                                                                                                                
[25] "        PARAMETER[\"False easting\",500000,"                                                                                                                                                                                                                                    
[26] "            LENGTHUNIT[\"metre\",1],"                                                                                                                                                                                                                                           
[27] "            ID[\"EPSG\",8806]],"                                                                                                                                                                                                                                                
[28] "        PARAMETER[\"False northing\",0,"                                                                                                                                                                                                                                        
[29] "            LENGTHUNIT[\"metre\",1],"                                                                                                                                                                                                                                           
[30] "            ID[\"EPSG\",8807]]],"                                                                                                                                                                                                                                               
[31] "    CS[Cartesian,2],"                                                                                                                                                                                                                                                           
[32] "        AXIS[\"(E)\",east,"                                                                                                                                                                                                                                                     
[33] "            ORDER[1],"                                                                                                                                                                                                                                                          
[34] "            LENGTHUNIT[\"metre\",1]],"                                                                                                                                                                                                                                          
[35] "        AXIS[\"(N)\",north,"                                                                                                                                                                                                                                                    
[36] "            ORDER[2],"                                                                                                                                                                                                                                                          
[37] "            LENGTHUNIT[\"metre\",1]],"                                                                                                                                                                                                                                          
[38] "    USAGE["                                                                                                                                                                                                                                                                     
[39] "        SCOPE[\"Engineering survey, topographic mapping.\"],"                                                                                                                                                                                                                   
[40] "        AREA[\"Between 78°W and 72°W, northern hemisphere between equator and 84°N, onshore and offshore. Bahamas. Canada - Nunavut; Ontario; Quebec. Colombia. Cuba. Ecuador. Greenland. Haiti. Jamaica. Panama. Turks and Caicos Islands. United States (USA). Venezuela.\"],"
[41] "        BBOX[0,-78,84,-72]],"                                                                                                                                                                                                                                                   
[42] "    ID[\"EPSG\",32618]]"                                                                                                                                                                                                                                                        
[43] "Data axis to CRS axis mapping: 1,2"                                                                                                                                                                                                                                             
[44] "Origin = (731453.000000000000000,4713838.000000000000000)"                                                                                                                                                                                                                      
[45] "Pixel Size = (1.000000000000000,-1.000000000000000)"                                                                                                                                                                                                                            
[46] "Metadata:"                                                                                                                                                                                                                                                                      
[47] "  AREA_OR_POINT=Area"                                                                                                                                                                                                                                                           
[48] "Image Structure Metadata:"                                                                                                                                                                                                                                                      
[49] "  COMPRESSION=LZW"                                                                                                                                                                                                                                                              
[50] "  INTERLEAVE=BAND"                                                                                                                                                                                                                                                              
[51] "Corner Coordinates:"                                                                                                                                                                                                                                                            
[52] "Upper Left  (  731453.000, 4713838.000) ( 72d10'52.71\"W, 42d32'32.18\"N)"                                                                                                                                                                                                      
[53] "Lower Left  (  731453.000, 4712471.000) ( 72d10'54.71\"W, 42d31'47.92\"N)"                                                                                                                                                                                                      
[54] "Upper Right (  733150.000, 4713838.000) ( 72d 9'38.40\"W, 42d32'30.35\"N)"                                                                                                                                                                                                      
[55] "Lower Right (  733150.000, 4712471.000) ( 72d 9'40.41\"W, 42d31'46.08\"N)"                                                                                                                                                                                                      
[56] "Center      (  732301.500, 4713154.500) ( 72d10'16.56\"W, 42d32' 9.13\"N)"                                                                                                                                                                                                      
[57] "Band 1 Block=1697x1 Type=Float64, ColorInterp=Gray"                                                                                                                                                                                                                             
[58] "  Min=-0.714 Max=1.000 "                                                                                                                                                                                                                                                        
[59] "  Minimum=-0.714, Maximum=1.000, Mean=0.313, StdDev=0.481"                                                                                                                                                                                                                      
[60] "  NoData Value=-9999"                                                                                                                                                                                                                                                           
[61] "  Metadata:"                                                                                                                                                                                                                                                                    
[62] "    STATISTICS_MAXIMUM=0.99999973665016"                                                                                                                                                                                                                                        
[63] "    STATISTICS_MEAN=0.31255246777216"                                                                                                                                                                                                                                           
[64] "    STATISTICS_MINIMUM=-0.71362979358008"                                                                                                                                                                                                                                       
[65] "    STATISTICS_STDDEV=0.48129385401108"                                                                                                                                                                                                                                         </code></pre>
</div>
<ol style="list-style-type: decimal">
<li>If this file has the same CRS as DSM_HARV? Yes: UTM Zone 18, WGS84,
meters.</li>
<li>What format <code>NoDataValues</code> take? -9999</li>
<li>The resolution of the raster data? 1x1</li>
<li>How large a 5x5 pixel area would be? 5mx5m How? We are given
resolution of 1x1 and units in meters, therefore resolution of 5x5 means
5x5m.</li>
<li>Is the file a multi- or single-band raster? Single.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="more-resources" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-resources" class="callout-inner">
<h3 class="callout-title">More Resources<a class="anchor" aria-label="anchor" href="#more-resources"></a>
</h3>
<div class="callout-content">
<ul>
<li><a href="https://cran.r-project.org/package=terra" class="external-link">Read more about
the <code>terra</code> package in R.</a></li>
<li>We use the <code>ggplot2</code> package for plotting in this
workshop, but the <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html" class="external-link"><code>tmap</code></a>
package actually makes plotting rasters even easier. <code>tmap</code>
is especially useful if you plan to plot rasters and vectors in the same
plot.</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The GeoTIFF file format includes metadata about the raster
data.</li>
<li>To plot raster data with the <code>ggplot2</code> package, we need
to convert it to a dataframe.</li>
<li>R stores CRS information in the Proj4 format.</li>
<li>Be careful when dealing with missing or bad data values.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-10-raster-plot"><p>Content from <a href="10-raster-plot.html">Plot Raster Data</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/10-raster-plot.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create categorized or customized maps of raster data?</li>
<li>How can I customize the color scheme of a raster image?</li>
<li>How can I layer raster data in a single image?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Build customized plots for a single band raster using the
<code>ggplot2</code> package.</li>
<li>Layer a raster dataset on top of a hillshade to create an elegant
basemap.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="plot-raster-data-in-r"><h2 class="section-heading">Plot Raster Data in R<a class="anchor" aria-label="anchor" href="#plot-raster-data-in-r"></a>
</h2>
<hr class="half-width">
<p>This episode covers how to plot a raster in R using the
<code>ggplot2</code> package with customized coloring schemes. It also
covers how to layer a raster on top of a hillshade to produce an
eloquent map. We will continue working with the Digital Surface Model
(DSM) raster for the NEON Harvard Forest Field Site.</p>
<p>First, let’s load in the libraries and data we will need for this
lesson:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DSM data for Harvard Forest</span></span>
<span><span class="va">DSM_HARV</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="plotting-data-using-breaks"><h2 class="section-heading">Plotting Data Using Breaks<a class="anchor" aria-label="anchor" href="#plotting-data-using-breaks"></a>
</h2>
<hr class="half-width">
<p>In the previous episode, we viewed our data using a continuous color
ramp. For clarity and visibility of the plot, we may prefer to view the
data “symbolized” or colored according to ranges of values. This is
comparable to a “classified” map. To do this, we need to tell
<code>ggplot</code> how many groups to break our data into, and where
those breaks should be. To make these decisions, it is useful to first
explore the distribution of the data using a bar plot. To begin with, we
will use <code>dplyr</code>’s <code>mutate()</code> function combined
with <code>cut()</code> to split the data into 3 bins.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV_df</span> <span class="op">&lt;-</span> <span class="va">DSM_HARV_df</span> <span class="op">%&gt;%</span></span>
<span>                <span class="fu">mutate</span><span class="op">(</span>fct_elevation <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">HARV_dsmCrop</span>, breaks <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">fct_elevation</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-histogram-breaks-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we want to know the cutoff values for the groups, we can ask for
the unique values of <code>fct_elevation</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">DSM_HARV_df</span><span class="op">$</span><span class="va">fct_elevation</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] (379,416] (342,379] (305,342]
Levels: (305,342] (342,379] (379,416]</code></pre>
</div>
<p>Notice that the <code>cut()</code> function shows closed intervals on
the right (<code>]</code>), and open intervals on the left
(<code>(</code>). In our example, (305, 342] means that values greater
than 305 (but not 305 itself) and values less than or equal to 342 are
included in the interval.</p>
<p>And we can get the count of values in each group using
<code>dplyr</code>’s <code>group_by()</code> and <code>count()</code>
functions:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">fct_elevation</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  fct_elevation       n
  &lt;fct&gt;           &lt;int&gt;
1 (305,342]      418891
2 (342,379]     1530073
3 (379,416]      370835</code></pre>
</div>
<p>We might prefer to customize the cutoff values for these groups. Lets
round the cutoff values so that we have groups for the ranges of 301–350
m, 351–400 m, and 401–450 m. To implement this we will give
<code>mutate()</code> a numeric vector of break points instead of the
number of breaks we want.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_bins</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">300</span>, <span class="fl">350</span>, <span class="fl">400</span>, <span class="fl">450</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_HARV_df</span> <span class="op">&lt;-</span> <span class="va">DSM_HARV_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fct_elevation_2 <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">HARV_dsmCrop</span>, breaks <span class="op">=</span> <span class="va">custom_bins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">DSM_HARV_df</span><span class="op">$</span><span class="va">fct_elevation_2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] (400,450] (350,400] (300,350]
Levels: (300,350] (350,400] (400,450]</code></pre>
</div>
<p>And now we can plot our bar plot again, using the new groups:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">fct_elevation_2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-histogram-custom-breaks-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>And we can get the count of values in each group in the same way we
did before:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">fct_elevation_2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  fct_elevation_2       n
  &lt;fct&gt;             &lt;int&gt;
1 (300,350]        741815
2 (350,400]       1567316
3 (400,450]         10668</code></pre>
</div>
<p>We can use those groups to plot our raster data, with each group
being a different color:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span> , </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-raster-with-breaks-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The plot above uses the default colors inside <code>ggplot</code> for
raster objects. We can specify our own colors to make the plot look a
little nicer. R has a built in set of colors for plotting terrain, which
are built in to the <code>terrain.colors()</code> function. Since we
have three bins, we want to create a 3-color palette:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "#00A600" "#ECB176" "#F2F2F2"</code></pre>
</div>
<p>The <code>terrain.colors()</code> function returns <em>hex
colors</em> - each of these character strings represents a color. To use
these in our map, we pass them across using the
<code>scale_fill_manual()</code> function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span> , </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-ggplot-breaks-customcolors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="more-plot-formatting">More Plot Formatting<a class="anchor" aria-label="anchor" href="#more-plot-formatting"></a>
</h3>
<p>If we need to create multiple plots using the same color palette, we
can create an R object (<code>my_col</code>) for the set of colors that
we want to use. We can then quickly change the palette across all plots
by modifying the <code>my_col</code> object, rather than each individual
plot.</p>
<p>We can label the x- and y-axes of our plot too using the
<code>labs()</code> function. We can also give the legend a more
meaningful title by passing either a value to the <code>name</code>
argument of the <code>scale_fill_manual()</code> function or by
specifying it within the <code>labs()</code> function as
<code>fill = "name here"</code>.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span> , </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"latitude"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-add-ggplot-labels-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Or we can also turn off the labels of both axes by passing a NULL
value to the <code>labs()</code> function for the x and y values.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span> , </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-turn-off-axes-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1-plot-using-custom-breaks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-plot-using-custom-breaks" class="callout-inner">
<h3 class="callout-title">Challenge 1: Plot Using Custom Breaks<a class="anchor" aria-label="anchor" href="#challenge-1-plot-using-custom-breaks"></a>
</h3>
<div class="callout-content">
<p>Create a plot of the Harvard Forest Digital Surface Model (DSM) that
has:</p>
<ol style="list-style-type: decimal">
<li>Six classified ranges of values (break points) that are evenly
divided among the range of pixel values.</li>
<li>Axis labels.</li>
<li>A plot title. (You can specify this in the <code>labs()</code>
function as well, using <code>title = "Title here"</code>)</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_HARV_df</span> <span class="op">&lt;-</span> <span class="va">DSM_HARV_df</span>  <span class="op">%&gt;%</span></span>
<span>               <span class="fu">mutate</span><span class="op">(</span>fct_elevation_6 <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">HARV_dsmCrop</span>, breaks <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span> <span class="va">my_col</span> <span class="op">&lt;-</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span>, </span>
<span>                mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">fct_elevation_6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_col</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"UTM Easting Coordinate (m)"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"UTM Northing Coordinate (m)"</span>, </span>
<span>         fill <span class="op">=</span> <span class="st">"Elevation"</span>, </span>
<span>         title <span class="op">=</span> <span class="st">"Classified Elevation Map - NEON Harvard Forest Field Site"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-challenge-code-plotting-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</div>
</section><section id="layering-rasters"><h2 class="section-heading">Layering Rasters<a class="anchor" aria-label="anchor" href="#layering-rasters"></a>
</h2>
<hr class="half-width">
<p>We can layer a raster on top of a hillshade raster for the same area,
and use a transparency factor to create a 3-dimensional shaded effect. A
hillshade is a raster that maps the shadows and texture that you would
see from above when viewing terrain. We will add a custom color, making
the plot grey.</p>
<p>First we need to read in our DSM hillshade data and view the
structure:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_hill_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_DSMhill.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_hill_HARV</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 1367, 1697, 1  (nrow, ncol, nlyr)
resolution  : 1, 1  (x, y)
extent      : 731453, 733150, 4712471, 4713838  (xmin, xmax, ymin, ymax)
coord. ref. : WGS 84 / UTM zone 18N (EPSG:32618) 
source      : HARV_DSMhill.tif 
name        : HARV_DSMhill 
min value   :   -0.7136298 
max value   :    0.9999997 </code></pre>
</div>
<p>Next we convert it to a dataframe, so that we can plot it using
<code>ggplot2</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DSM_hill_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_hill_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">DSM_hill_HARV_df</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	2313675 obs. of  3 variables:
 $ x           : num  731454 731456 731456 731458 731458 ...
 $ y           : num  4713836 4713836 4713836 4713836 4713836 ...
 $ HARV_DSMhill: num  -0.15567 0.00743 0.86989 0.9791 0.96283 ...</code></pre>
</div>
<p>Now we can plot the hillshade data. Note that the <code>alpha</code>
object translates to transparency, where a value of 0 indicates fully
transparent and a value of 1 indicates fully opaque. We can force R to
not show the legend for a particular scale if we use
<code>guide = "none"</code>:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_hill_HARV_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">HARV_DSMhill</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_alpha</span><span class="op">(</span>range <span class="op">=</span>  <span class="fu">c</span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.65</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-raster-hillshade-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="data-tips" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tips" class="callout-inner">
<h3 class="callout-title">Data Tips<a class="anchor" aria-label="anchor" href="#data-tips"></a>
</h3>
<div class="callout-content">
<p>Turn off, or hide, the legend on a plot by adding
<code>guide = "none"</code> to a <code>scale_something()</code> function
or by setting <code>theme(legend.position = "none")</code>.</p>
</div>
</div>
</div>
<p>We can layer another raster on top of our hillshade by adding another
call to the <code>geom_raster()</code> function. Let’s overlay
<code>DSM_HARV</code> on top of the <code>hill_HARV</code>. We can also
add a title to our plot within the <code>labs()</code> function using
<code>labs(title = "Plot title")</code> or we can use
<code>ggtitle("Plot title")</code>.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_HARV_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_dsmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_hill_HARV_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">HARV_DSMhill</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_alpha</span><span class="op">(</span>range <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.65</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Elevation with hillshade"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-overlay-hillshade-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-2-create-dtm-dsm-for-sjer" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-create-dtm-dsm-for-sjer" class="callout-inner">
<h3 class="callout-title">Challenge 2: Create DTM &amp; DSM for
SJER<a class="anchor" aria-label="anchor" href="#challenge-2-create-dtm-dsm-for-sjer"></a>
</h3>
<div class="callout-content">
<p>Use the files in the
<code>data/NEON-DS-Airborne-Remote-Sensing/SJER/</code> directory to
create a Digital Terrain Model map and Digital Surface Model map of the
San Joaquin Experimental Range field site.</p>
<p>Make sure to:</p>
<ul>
<li>include hillshade in the maps,</li>
<li>label axes on the DSM map and exclude them from the DTM map,</li>
<li>include a title for each map,</li>
<li>experiment with various alpha values and color palettes to represent
the data.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CREATE DSM MAPS</span></span>
<span></span>
<span><span class="co"># import DSM data</span></span>
<span><span class="va">DSM_SJER</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/SJER/DSM/SJER_dsmCrop.tif"</span><span class="op">)</span></span>
<span><span class="co"># convert to a df for plotting</span></span>
<span><span class="va">DSM_SJER_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_SJER</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># import DSM hillshade</span></span>
<span><span class="va">DSM_hill_SJER</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/SJER/DSM/SJER_dsmHill.tif"</span><span class="op">)</span></span>
<span><span class="co"># convert to a df for plotting</span></span>
<span><span class="va">DSM_hill_SJER_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_hill_SJER</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_SJER_df</span> , </span>
<span>                mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                              fill <span class="op">=</span> <span class="va">SJER_dsmCrop</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_hill_SJER_df</span>, </span>
<span>                mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, alpha <span class="op">=</span> <span class="va">SJER_dsmHill</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_alpha</span><span class="op">(</span>range <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.7</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"UTM Easting Coordinate (m)"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"UTM Northing Coordinate (m)"</span>, </span>
<span>         title <span class="op">=</span> <span class="st">"DSM with Hillshade"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-challenge-hillshade-layering-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CREATE DTM MAP</span></span>
<span><span class="co"># import DTM</span></span>
<span><span class="va">DTM_SJER</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/SJER/DTM/SJER_dtmCrop.tif"</span><span class="op">)</span></span>
<span><span class="va">DTM_SJER_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_SJER</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DTM Hillshade</span></span>
<span><span class="va">DTM_hill_SJER</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/SJER/DTM/SJER_dtmHill.tif"</span><span class="op">)</span></span>
<span><span class="va">DTM_hill_SJER_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_SJER</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_SJER_df</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                              fill <span class="op">=</span> <span class="va">SJER_dtmCrop</span><span class="op">)</span>,</span>
<span>                              alpha <span class="op">=</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_SJER_df</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                              alpha <span class="op">=</span> <span class="va">SJER_dtmHill</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_alpha</span><span class="op">(</span>range <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.7</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>         y <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>         title <span class="op">=</span> <span class="st">"DTM with Hillshade"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/10-raster-plot-rendered-challenge-hillshade-layering-2.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Continuous data ranges can be grouped into categories using
<code>mutate()</code> and <code>cut()</code>.</li>
<li>Use built-in <code>terrain.colors()</code> or set your preferred
color scheme manually.</li>
<li>Layer rasters on top of one another by using the <code>alpha</code>
aesthetic.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-11-raster-reproject-in-r"><p>Content from <a href="11-raster-reproject-in-r.html">Reproject Raster Data</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/11-raster-reproject-in-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I work with raster data sets that are in different
projections?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Reproject a raster in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Sometimes we encounter raster datasets that do not “line up” when
plotted or analyzed. Rasters that don’t line up are most often in
different Coordinate Reference Systems (CRS). This episode explains how
to deal with rasters in different, known CRSs. It will walk though
reprojecting rasters in R using the <code>project()</code> function in
the <code>terra</code> package.</p>
<p>Let’s load the packages we’ll need for this lesson:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span></code></pre>
</div>
<section id="raster-projection-in-r"><h2 class="section-heading">Raster Projection in R<a class="anchor" aria-label="anchor" href="#raster-projection-in-r"></a>
</h2>
<hr class="half-width">
<p>In the previous episode, we learned how to layer a raster file on top
of a hillshade for a nice looking basemap. In that episode, all of our
data were in the same CRS. What happens when things don’t line up?</p>
<p>For this episode, we will be working with the Harvard Forest Digital
Terrain Model data. This differs from the surface model data we’ve been
working with so far in that the digital surface model (DSM) includes the
tops of trees, while the digital terrain model (DTM) shows the ground
level.</p>
<p>Here, we will create a map of the Harvard Forest Digital Terrain
Model (<code>DTM_HARV</code>) draped or layered on top of the hillshade
(<code>DTM_hill_HARV</code>). The hillshade layer maps the terrain using
light and shadow to create a 3D-looking image, based on a hypothetical
illumination of the ground level.</p>
<figure><img src="fig/dc-spatial-raster/lidarTree-height.png" alt="Source: National Ecological Observatory Network (NEON)." class="figure mx-auto d-block"></figure><p>First, we need to import the DTM and DTM hillshade data.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_HARV</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DTM/HARV_dtmCrop.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DTM_hill_HARV</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/DTM/HARV_DTMhill_WGS84.tif"</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, we will convert each of these datasets to a dataframe for
plotting with <code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DTM_hill_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can create a map of the DTM layered over the hillshade. Note
that we use <code>scale_fill_gradientn()</code> here to specify our
color scale. This allows for us to easily create a color ramp for the
data we want to display.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_HARV_df</span> , </span>
<span>                 mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">HARV_dtmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_HARV_df</span>, </span>
<span>                 mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                   alpha <span class="op">=</span> <span class="va">HARV_DTMhill_WGS84</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-raster-reproject-in-r-rendered-plot-empty-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Our results are curious - neither the Digital Terrain Model
(<code>DTM_HARV_df</code>) nor the DTM Hillshade
(<code>DTM_hill_HARV_df</code>) plotted. Let’s try to plot the DTM on
its own to make sure there are data there.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_HARV_df</span>,</span>
<span>      mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_dtmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-raster-reproject-in-r-rendered-plot-DTM-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Our DTM seems to contain data and plots just fine.</p>
<p>Next we plot the DTM Hillshade on its own to see whether everything
is OK.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_HARV_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                            alpha <span class="op">=</span> <span class="va">HARV_DTMhill_WGS84</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-raster-reproject-in-r-rendered-plot-DTM-hill-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we look at the axes, we can see that the projections of the two
rasters are different. When this is the case, <code>ggplot</code> won’t
render the image. It won’t even throw an error message to tell you
something has gone wrong. We can look at Coordinate Reference Systems
(CRSs) of the DTM and the hillshade data to see how they differ.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_HARV</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">crs</span><span class="op">(</span><span class="va">DTM_hill_HARV</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=longlat +datum=WGS84 +no_defs"</code></pre>
</div>
<p><code>DTM_HARV</code> is in the UTM projection, with units of meters.
<code>DTM_hill_HARV</code> is in <code>Geographic WGS84</code> - which
is represented by latitude and longitude values.</p>
<p>Because the two rasters are in different CRSs, they don’t line up
when plotted in R. We need to reproject (or change the projection of)
<code>DTM_hill_HARV</code> into the UTM CRS. Alternatively, we could
reproject <code>DTM_HARV</code> into WGS84.</p>
</section><section id="reproject-rasters"><h2 class="section-heading">Reproject Rasters<a class="anchor" aria-label="anchor" href="#reproject-rasters"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>project()</code> function to reproject a raster
into a new CRS. Keep in mind that reprojection only works when you first
have a defined CRS for the raster object that you want to reproject. It
cannot be used if no CRS is defined. Lucky for us, the
<code>DTM_hill_HARV</code> has a defined CRS.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>When we reproject a raster, we move it from one “grid” to another.
Thus, we are modifying the data! Keep this in mind as we work with
raster data.</p>
</div>
</div>
</div>
<p>To use the <code>project()</code> function, we need to define two
things:</p>
<ol style="list-style-type: decimal">
<li>the object we want to reproject and</li>
<li>the CRS that we want to reproject it to.</li>
</ol>
<p>The syntax is <code>project(x = RasterObject, y = crs)</code></p>
<p>We want the CRS of our hillshade to match the <code>DTM_HARV</code>
raster. One option would be to just use the CRS of <code>DTM_HARV</code>
in the <code>project()</code> function, but this will cause other issues
later down the line because the resolutions of <code>DTM_HARV</code> and
<code>DTM_hill_HARV</code> are different. That’s okay, because we can
specify the resolution of the output file in the <code>project()</code>
function using <code>res</code>.</p>
<p>That’s a little complicated for our needs though. In our case, the
most effective way to reproject the dataset is to use the
<code>DTM_HARV</code> layer as a template for the reprojection. We can
specify that by using the syntax
<code>project(x = RasterObject, y = TemplateRasterObject)</code>.</p>
<p>Note that we are using the <code>project()</code> function on the
raster object, not the <code>data.frame()</code> we use for plotting
with <code>ggplot</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_UTMZ18N_HARV</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DTM_hill_HARV</span>,</span>
<span>                                 y <span class="op">=</span> <span class="va">DTM_HARV</span><span class="op">)</span></span></code></pre>
</div>
<p>For plotting with <code>ggplot()</code>, we will need to create a
dataframe from our newly reprojected raster.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DTM_hill_HARV_2_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DTM_hill_UTMZ18N_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now create a plot of this data.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_HARV_df</span> , </span>
<span>                 mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                               fill <span class="op">=</span> <span class="va">HARV_dtmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTM_hill_HARV_2_df</span>, </span>
<span>                 mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                               alpha <span class="op">=</span> <span class="va">HARV_DTMhill_WGS84</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-raster-reproject-in-r-rendered-plot-projected-raster-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We have now successfully draped the Digital Terrain Model on top of
our hillshade to produce a nice looking, textured map!</p>
<div id="challenge-1-reproject-then-plot-a-digital-terrain-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-reproject-then-plot-a-digital-terrain-model" class="callout-inner">
<h3 class="callout-title">Challenge 1: Reproject, then Plot a Digital
Terrain Model<a class="anchor" aria-label="anchor" href="#challenge-1-reproject-then-plot-a-digital-terrain-model"></a>
</h3>
<div class="callout-content">
<p>Create a map of the <a href="https://www.neonscience.org/field-sites/field-sites-map/SJER" class="external-link">San
Joaquin Experimental Range</a> field site using the
<code>SJER_DSMhill_WGS84.tif</code> and <code>SJER_dsmCrop.tif</code>
files.</p>
<p>Reproject the data as necessary to make things line up!</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import DSM</span></span>
<span><span class="va">DSM_SJER</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/SJER/DSM/SJER_dsmCrop.tif"</span><span class="op">)</span></span>
<span><span class="co"># import DSM hillshade</span></span>
<span><span class="va">DSM_hill_SJER_WGS</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/SJER/DSM/SJER_DSMhill_WGS84.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reproject raster</span></span>
<span><span class="va">DSM_hill_UTMZ18N_SJER</span> <span class="op">&lt;-</span> <span class="fu">project</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DSM_hill_SJER_WGS</span>,</span>
<span>                                 y <span class="op">=</span> <span class="va">DSM_SJER</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to data.frames</span></span>
<span><span class="va">DSM_SJER_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_SJER</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DSM_hill_SJER_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">DSM_hill_UTMZ18N_SJER</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_hill_SJER_df</span>, </span>
<span>                 mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                               alpha <span class="op">=</span> <span class="va">SJER_DSMhill_WGS84</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">DSM_SJER_df</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                           fill <span class="op">=</span> <span class="va">SJER_dsmCrop</span>,</span>
<span>                           alpha<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">scale_fill_gradientn</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elevation"</span>, colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">coord_quickmap</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/11-raster-reproject-in-r-rendered-challenge-code-reprojection-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>In order to plot two raster data sets together, they must be in the
same CRS.</li>
<li>Use the <code>project()</code> function to convert between
CRSs.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-12-vector-open-shapefile-in-r"><p>Content from <a href="12-vector-open-shapefile-in-r.html">Open and Plot Vector Layers</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/12-vector-open-shapefile-in-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I distinguish between and visualize point, line and polygon
vector data?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Know the difference between point, line, and polygon vector
elements.</li>
<li>Load point, line, and polygon vector layers into R.</li>
<li>Access the attributes of a spatial object in R.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Starting with this episode, we will be moving from working with
raster data to working with vector data. In this episode, we will open
and plot point, line and polygon vector data loaded from ESRI’s
<code>shapefile</code> format into R. These data refer to the <a href="https://www.neonscience.org/field-sites/field-sites-map/HARV" class="external-link">NEON
Harvard Forest field site</a>.</p>
<section id="import-vector-data"><h2 class="section-heading">Import Vector Data<a class="anchor" aria-label="anchor" href="#import-vector-data"></a>
</h2>
<hr class="half-width">
<p>We will use the <code>sf</code> package to work with vector data in
R. Fun fact: <code>sf</code> stands for “simple features”.</p>
<p>If you haven’t downloaded the <code>sf</code> package yet, you can do
so by going to the Packages tab in your R console and installing a new
package, or you can type the following code into your R console:</p>
<p><code>install.packages("sf")</code></p>
<p>Make sure you have the <code>sf</code> library loaded along with the
other libraries we will need.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span></code></pre>
</div>
<p>The vector layers that we will import from ESRI’s
<code>shapefile</code> format are:</p>
<ul>
<li>A polygon vector layer representing our field site boundary,</li>
<li>A line vector layer representing roads, and</li>
<li>A point vector layer representing the location of the <a href="https://www.neonscience.org/data-collection/flux-tower-measurements" class="external-link">Fisher
flux tower</a> located at the <a href="https://www.neonscience.org/field-sites/field-sites-map/HARV" class="external-link">NEON
Harvard Forest field site</a>.</li>
</ul>
<p>The first vector layer that we will open contains the boundary of our
study area (or our Area Of Interest or AOI, hence the name
<code>aoiBoundary</code>). To import a vector layer from an ESRI
<code>shapefile</code> we use the <code>sf</code> function
<code>st_read()</code>. <code>st_read()</code> requires the file path to
the ESRI <code>shapefile</code>.</p>
<p>Let’s import our AOI:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi_boundary_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span></span>
<span>  <span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `HarClip_UTMZ18' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 732128 ymin: 4713209 xmax: 732251.1 ymax: 4713359
Projected CRS: WGS 84 / UTM zone 18N</code></pre>
</div>
</section><section id="vector-layer-metadata-attributes"><h2 class="section-heading">Vector Layer Metadata &amp; Attributes<a class="anchor" aria-label="anchor" href="#vector-layer-metadata-attributes"></a>
</h2>
<hr class="half-width">
<p>When we import the <code>HarClip_UTMZ18</code> vector layer from an
ESRI <code>shapefile</code> into R (as our
<code>aoi_boundary_HARV</code> object), the <code>st_read()</code>
function automatically stores information about the data. We are
particularly interested in the geospatial metadata, describing the
format, CRS, extent, and other components of the vector data, and the
attributes which describe properties associated with each individual
vector object.</p>
</section><section id="spatial-metadata"><h2 class="section-heading">Spatial Metadata<a class="anchor" aria-label="anchor" href="#spatial-metadata"></a>
</h2>
<hr class="half-width">
<p>Key metadata for all vector layers includes:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Object Type:</strong> the class of the imported object.</li>
<li>
<strong>Coordinate Reference System (CRS):</strong> the projection
of the data.</li>
<li>
<strong>Extent:</strong> the spatial extent (i.e. geographic area
that the vector layer covers) of the data. Note that the spatial extent
for a vector layer represents the combined extent for all individual
objects in the vector layer.</li>
</ol>
<p>We can view metadata of a vector layer using the
<code>st_geometry_type()</code>, <code>st_crs()</code> and
<code>st_bbox()</code> functions. First, let’s view the geometry type
for our AOI vector layer:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">aoi_boundary_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POLYGON
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<p>Our <code>aoi_boundary_HARV</code> is a polygon spatial object. The
18 levels shown below our output list the possible categories of the
geometry type. Now let’s check what CRS this file data is in:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">aoi_boundary_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 / UTM zone 18N 
  wkt:
PROJCRS["WGS 84 / UTM zone 18N",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 18N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-75,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32618]]</code></pre>
</div>
<p>Our data in the CRS <strong>UTM zone 18N</strong>. The CRS is
critical to interpreting the spatial object’s extent values as it
specifies units. To find the extent of our AOI, we can use the
<code>st_bbox()</code> function:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">aoi_boundary_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 732128.0 4713208.7  732251.1 4713359.2 </code></pre>
</div>
<p>The spatial extent of a vector layer or R spatial object represents
the geographic “edge” or location that is the furthest north, south east
and west. Thus it represents the overall geographic coverage of the
spatial object.</p>
<figure><img src="fig/dc-spatial-vector/spatial_extent.png" alt="Extent image" class="figure mx-auto d-block"><div class="figcaption">Image Source:National Ecological Observatory
Network (NEON).</div>
</figure><p>Lastly, we can view all of the metadata and attributes for this R
spatial object by printing it to the screen:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi_boundary_HARV</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 1 feature and 1 field
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 732128 ymin: 4713209 xmax: 732251.1 ymax: 4713359
Projected CRS: WGS 84 / UTM zone 18N
  id                       geometry
1  1 POLYGON ((732128 4713359, 7...</code></pre>
</div>
</section><section id="plot-a-vector-layer"><h2 class="section-heading">Plot a vector layer<a class="anchor" aria-label="anchor" href="#plot-a-vector-layer"></a>
</h2>
<hr class="half-width">
<p>Next, let’s visualize the data in our <code>sf</code> object using
the <code>ggplot</code> package. Unlike with raster data, we do not need
to convert vector data to a dataframe before plotting with
<code>ggplot</code>.</p>
<p>We’re going to customize our boundary plot by setting the color and
fill for our plot. When plotting <code>sf</code> objects with
<code>ggplot2</code>, you need to use the <code>coord_sf()</code>
coordinate system.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"cyan1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"AOI Boundary Plot"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/12-vector-open-shapefile-in-r-rendered-plot-shapefile-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1-import-line-and-point-vector-layers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-import-line-and-point-vector-layers" class="callout-inner">
<h3 class="callout-title">Challenge 1: Import Line and Point Vector
Layers<a class="anchor" aria-label="anchor" href="#challenge-1-import-line-and-point-vector-layers"></a>
</h3>
<div class="callout-content">
<p>Using the steps above, import the HARV_roads and HARVtower_UTM18N
vector layers into R. Call the HARV_roads object <code>lines_HARV</code>
and the HARVtower_UTM18N <code>point_HARV</code>.</p>
<p>Answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>What type of R spatial object is created when you import each
layer?</p></li>
<li><p>What is the CRS and extent for each object?</p></li>
<li><p>Do the files contain points, lines, or polygons?</p></li>
<li><p>How many spatial objects are in each file?</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>First we import the data:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARV_roads.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `HARV_roads' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/HARV/HARV_roads.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 13 features and 15 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 730741.2 ymin: 4711942 xmax: 733295.5 ymax: 4714260
Projected CRS: WGS 84 / UTM zone 18N</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `HARVtower_UTM18N' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 14 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 732183.2 ymin: 4713265 xmax: 732183.2 ymax: 4713265
Projected CRS: WGS 84 / UTM zone 18N</code></pre>
</div>
<p>Then we check its geometry type.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] MULTILINESTRING MULTILINESTRING MULTILINESTRING MULTILINESTRING
 [5] MULTILINESTRING MULTILINESTRING MULTILINESTRING MULTILINESTRING
 [9] MULTILINESTRING MULTILINESTRING MULTILINESTRING MULTILINESTRING
[13] MULTILINESTRING
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_geometry_type</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] POINT
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<p>We also check the CRS and extent of each object:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 / UTM zone 18N 
  wkt:
PROJCRS["WGS 84 / UTM zone 18N",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 18N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-75,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32618]]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 730741.2 4711942.0  733295.5 4714260.0 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 / UTM zone 18N 
  wkt:
PROJCRS["WGS 84 / UTM zone 18N",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 18N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-75,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32618]]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 732183.2 4713265.0  732183.2 4713265.0 </code></pre>
</div>
<p>To see the number of objects in each file, we can look at the output
from when we read these objects into R. <code>lines_HARV</code> contains
13 features (all lines) and <code>point_HARV</code> contains only one
point.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Metadata for vector layers include geometry type, CRS, and
extent.</li>
<li>Load spatial objects into R with the <code>st_read()</code>
function.</li>
<li>Spatial objects can be plotted directly with <code>ggplot</code>
using the <code>geom_sf()</code> function. No need to convert to a
dataframe.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-13-vector-shapefile-attributes-in-r"><p>Content from <a href="13-vector-shapefile-attributes-in-r.html">Explore and Plot by Vector Layer Attributes</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/13-vector-shapefile-attributes-in-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I compute on the attributes of a spatial object?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Query attributes of a spatial object.</li>
<li>Subset spatial objects using specific attribute values.</li>
<li>Plot a vector feature, colored by unique attribute values.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode continues our discussion of vector layer attributes and
covers how to work with vector layer attributes in R. It covers how to
identify and query layer attributes, as well as how to subset features
by specific attribute values. Finally, we will learn how to plot a
feature according to a set of attribute values.</p>
<section id="load-the-data"><h2 class="section-heading">Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>We will continue using the <code>sf</code> and <code>ggplot2</code>
packages in this episode. Make sure that you have these packages loaded.
We will continue to work with the three ESRI <code>shapefiles</code>
(vector layers) that we loaded in a previous episode.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_HARV</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp"</span><span class="op">)</span></span>
<span><span class="va">lines_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARV_roads.shp"</span><span class="op">)</span></span>
<span><span class="va">aoi_boundary_HARV</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp"</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="query-vector-feature-metadata"><h2 class="section-heading">Query Vector Feature Metadata<a class="anchor" aria-label="anchor" href="#query-vector-feature-metadata"></a>
</h2>
<hr class="half-width">
<p>As we discussed in the <a href="12-vector-open-shapefile-in-r/">Open
and Plot Vector Layers in R</a> episode, we can view metadata associated
with an R object using:</p>
<ul>
<li>
<code>st_geometry_type()</code> - The type of vector data stored in
the object.</li>
<li>
<code>st_bbox()</code> - The spatial extent (geographic area covered
by) of the object.</li>
<li>
<code>st_crs()</code> - The CRS (spatial projection) of the
data.</li>
</ul>
<p>We started to explore our <code>point_HARV</code> object in the
previous episode. To see a summary of all of the metadata associated
with our object, we can view the object with
<code>View(point_HARV)</code> or print a summary of the object itself to
the console. We’re going to do this, but with <code>lines_HARV</code>
today:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_HARV</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 13 features and 15 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 730741.2 ymin: 4711942 xmax: 733295.5 ymax: 4714260
Projected CRS: WGS 84 / UTM zone 18N
First 10 features:
   OBJECTID_1 OBJECTID       TYPE             NOTES MISCNOTES RULEID
1          14       48 woods road Locust Opening Rd      &lt;NA&gt;      5
2          40       91   footpath              &lt;NA&gt;      &lt;NA&gt;      6
3          41      106   footpath              &lt;NA&gt;      &lt;NA&gt;      6
4         211      279 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
5         212      280 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
6         213      281 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
7         214      282 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
8         215      283 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
9         216      284 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
10        553      674  boardwalk              &lt;NA&gt;      &lt;NA&gt;      2
            MAPLABEL SHAPE_LENG             LABEL BIKEHORSE RESVEHICLE RECMAP
1  Locust Opening Rd 1297.35706 Locust Opening Rd         Y         R1      Y
2               &lt;NA&gt;  146.29984              &lt;NA&gt;         Y         R1      Y
3               &lt;NA&gt;  676.71804              &lt;NA&gt;         Y         R2      Y
4               &lt;NA&gt;  231.78957              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
5               &lt;NA&gt;   45.50864              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
6               &lt;NA&gt;  198.39043              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
7               &lt;NA&gt;  143.19240              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
8               &lt;NA&gt;   90.33118              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
9               &lt;NA&gt;   35.88146              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
10              &lt;NA&gt;   67.43464              &lt;NA&gt;         N         R3      N
   Shape_Le_1                            ResVehic_1                  BicyclesHo
1  1297.10617    R1 - All Research Vehicles Allowed Bicycles and Horses Allowed
2   146.29983    R1 - All Research Vehicles Allowed Bicycles and Horses Allowed
3   676.71807 R2 - 4WD/High Clearance Vehicles Only Bicycles and Horses Allowed
4   231.78962                                  &lt;NA&gt;                        &lt;NA&gt;
5    45.50859                                  &lt;NA&gt;                        &lt;NA&gt;
6   198.39041                                  &lt;NA&gt;                        &lt;NA&gt;
7   143.19241                                  &lt;NA&gt;                        &lt;NA&gt;
8    90.33114                                  &lt;NA&gt;                        &lt;NA&gt;
9    35.88152                                  &lt;NA&gt;                        &lt;NA&gt;
10   67.43466              R3 - No Vehicles Allowed      DO NOT SHOW ON REC MAP
                         geometry
1  MULTILINESTRING ((730819.2 ...
2  MULTILINESTRING ((732040.2 ...
3  MULTILINESTRING ((732057 47...
4  MULTILINESTRING ((731903.6 ...
5  MULTILINESTRING ((732039.1 ...
6  MULTILINESTRING ((732056.2 ...
7  MULTILINESTRING ((731964 47...
8  MULTILINESTRING ((732105.2 ...
9  MULTILINESTRING ((732222.9 ...
10 MULTILINESTRING ((732153.8 ...</code></pre>
</div>
<p>We can use the <code>ncol</code> function to count the number of
attributes associated with a spatial object too. Note that the geometry
is just another column and counts towards the total.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 16</code></pre>
</div>
<p>We can view the individual name of each attribute using the
<code>names()</code> function in R:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "OBJECTID_1" "OBJECTID"   "TYPE"       "NOTES"      "MISCNOTES" 
 [6] "RULEID"     "MAPLABEL"   "SHAPE_LENG" "LABEL"      "BIKEHORSE" 
[11] "RESVEHICLE" "RECMAP"     "Shape_Le_1" "ResVehic_1" "BicyclesHo"
[16] "geometry"  </code></pre>
</div>
<p>We could also view just the first 6 rows of attribute values using
the <code>head()</code> function to get a preview of the data:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Simple feature collection with 6 features and 15 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 730741.2 ymin: 4712685 xmax: 732232.3 ymax: 4713726
Projected CRS: WGS 84 / UTM zone 18N
  OBJECTID_1 OBJECTID       TYPE             NOTES MISCNOTES RULEID
1         14       48 woods road Locust Opening Rd      &lt;NA&gt;      5
2         40       91   footpath              &lt;NA&gt;      &lt;NA&gt;      6
3         41      106   footpath              &lt;NA&gt;      &lt;NA&gt;      6
4        211      279 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
5        212      280 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
6        213      281 stone wall              &lt;NA&gt;      &lt;NA&gt;      1
           MAPLABEL SHAPE_LENG             LABEL BIKEHORSE RESVEHICLE RECMAP
1 Locust Opening Rd 1297.35706 Locust Opening Rd         Y         R1      Y
2              &lt;NA&gt;  146.29984              &lt;NA&gt;         Y         R1      Y
3              &lt;NA&gt;  676.71804              &lt;NA&gt;         Y         R2      Y
4              &lt;NA&gt;  231.78957              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
5              &lt;NA&gt;   45.50864              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
6              &lt;NA&gt;  198.39043              &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;
  Shape_Le_1                            ResVehic_1                  BicyclesHo
1 1297.10617    R1 - All Research Vehicles Allowed Bicycles and Horses Allowed
2  146.29983    R1 - All Research Vehicles Allowed Bicycles and Horses Allowed
3  676.71807 R2 - 4WD/High Clearance Vehicles Only Bicycles and Horses Allowed
4  231.78962                                  &lt;NA&gt;                        &lt;NA&gt;
5   45.50859                                  &lt;NA&gt;                        &lt;NA&gt;
6  198.39041                                  &lt;NA&gt;                        &lt;NA&gt;
                        geometry
1 MULTILINESTRING ((730819.2 ...
2 MULTILINESTRING ((732040.2 ...
3 MULTILINESTRING ((732057 47...
4 MULTILINESTRING ((731903.6 ...
5 MULTILINESTRING ((732039.1 ...
6 MULTILINESTRING ((732056.2 ...</code></pre>
</div>
<div id="challenge-1-attributes-for-different-spatial-classes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-attributes-for-different-spatial-classes" class="callout-inner">
<h3 class="callout-title">Challenge 1: Attributes for Different Spatial
Classes<a class="anchor" aria-label="anchor" href="#challenge-1-attributes-for-different-spatial-classes"></a>
</h3>
<div class="callout-content">
<p>Explore the attributes associated with the <code>point_HARV</code>
and <code>aoi_boundary_HARV</code> spatial objects.</p>
<ol style="list-style-type: decimal">
<li><p>How many attributes does each have?</p></li>
<li><p>Who owns the site in the <code>point_HARV</code> data
object?</p></li>
<li><p>Which of the following is NOT an attribute of the
<code>point_HARV</code> data object?</p></li>
</ol>
<ol style="list-style-type: upper-alpha">
<li>Latitude B) County C) Country</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>To find the number of attributes, we use the <code>ncol()</code>
function:</li>
</ol>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ncol</span><span class="op">(</span><span class="va">aoi_boundary_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Ownership information is in a column named
<code>Ownership</code>:</li>
</ol>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_HARV</span><span class="op">$</span><span class="va">Ownership</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Harvard University, LTER"</code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>To see a list of all of the attributes, we can use the
<code>names()</code> function:</li>
</ol>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Un_ID"      "Domain"     "DomainName" "SiteName"   "Type"      
 [6] "Sub_Type"   "Lat"        "Long"       "Zone"       "Easting"   
[11] "Northing"   "Ownership"  "County"     "annotation" "geometry"  </code></pre>
</div>
<p>“Country” is not an attribute of this object.</p>
</div>
</div>
</div>
</div>
</section><section id="explore-values-within-one-attribute"><h2 class="section-heading">Explore Values within One Attribute<a class="anchor" aria-label="anchor" href="#explore-values-within-one-attribute"></a>
</h2>
<hr class="half-width">
<p>We can explore individual values stored within a particular
attribute. Comparing attributes to a spreadsheet or a data frame, this
is similar to exploring values in a column. We did this with the
<code>gapminder</code> dataframe in an earlier lesson. For spatial
objects, we can use the same syntax:
<code>objectName$attributeName</code>.</p>
<p>We can see the contents of the <code>TYPE</code> field of our lines
feature:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_HARV</span><span class="op">$</span><span class="va">TYPE</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "woods road" "footpath"   "footpath"   "stone wall" "stone wall"
 [6] "stone wall" "stone wall" "stone wall" "stone wall" "boardwalk" 
[11] "woods road" "woods road" "woods road"</code></pre>
</div>
<p>To see only unique values within the <code>TYPE</code> field, we can
use the <code>unique()</code> function for extracting the possible
values of a character variable.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">$</span><span class="va">TYPE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "woods road" "footpath"   "stone wall" "boardwalk" </code></pre>
</div>
<div class="section level3">
<h3 id="subset-features">Subset Features<a class="anchor" aria-label="anchor" href="#subset-features"></a>
</h3>
<p>We can use the <code>filter()</code> function from <code>dplyr</code>
to select a subset of features from a spatial object in R, just like
with data frames.</p>
<p>For example, we might be interested only in features that are of
<code>TYPE</code> “footpath”. Once we subset out this data, we can use
it as input to other code so that code only operates on the footpath
lines.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">footpath_HARV</span> <span class="op">&lt;-</span> <span class="va">lines_HARV</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">TYPE</span> <span class="op">==</span> <span class="st">"footpath"</span><span class="op">)</span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">footpath_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2</code></pre>
</div>
<p>Our subsetting operation reduces the <code>features</code> count to
2. This means that only two feature lines in our spatial object have the
attribute <code>TYPE == footpath</code>. We can plot only the footpath
lines:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">footpath_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Footpaths"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-plot-subset-shapefile-1.png" alt="Map of the footpaths in the study area." class="figure mx-auto d-block"><figcaption>
Map of the footpaths in the study area.
</figcaption></figure><p>There are two features in our footpaths subset. Why does the plot
look like there is only one feature? Let’s adjust the colors used in our
plot. If we have 2 features in our vector object, we can plot each using
a unique color by assigning a column name to the color aesthetic
(<code>color =</code>). We use the syntax
<code>mapping = aes(color = )</code> to do this. We’ll use the
<code>OBJECTID</code> column for the color aesthetic in this example,
but because it is a number, we will have to convert it to a categorical
value (a factor) first. We can also alter the default line thickness by
using the <code>linewidth =</code> parameter, as the default value can
be hard to see. Note that <code>linewidth</code> is placed outside of
the <code>aes()</code> function, as we are not connecting line thickness
to a data variable.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">footpath_HARV</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">OBJECTID</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Footpath ID"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Footpaths"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-plot-subset-shapefile-unique-colors-1.png" alt="Map of the footpaths in the study area where each feature is colored differently." class="figure mx-auto d-block"><figcaption>
Map of the footpaths in the study area where each feature is colored
differently.
</figcaption></figure><p>Now, we see that there are in fact two features in our plot!</p>
<div id="challenge-2-subset-spatial-line-objects-part-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-subset-spatial-line-objects-part-1" class="callout-inner">
<h3 class="callout-title">Challenge 2: Subset Spatial Line Objects Part
1<a class="anchor" aria-label="anchor" href="#challenge-2-subset-spatial-line-objects-part-1"></a>
</h3>
<div class="callout-content">
<p>Subset out all <code>boardwalk</code> from the lines layer and plot
it.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>First we will save an object with only the boardwalk lines:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boardwalk_HARV</span> <span class="op">&lt;-</span> <span class="va">lines_HARV</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">TYPE</span> <span class="op">==</span> <span class="st">"boardwalk"</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s check how many features there are in this subset:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">boardwalk_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1</code></pre>
</div>
<p>Now let’s plot that data:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boardwalk_HARV</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Boardwalks"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-harv-boardwalk-map-1.png" alt="Map of the boardwalks in the study area." class="figure mx-auto d-block"><figcaption>
Map of the boardwalks in the study area.
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="challenge-3-subset-spatial-line-objects-part-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3-subset-spatial-line-objects-part-2" class="callout-inner">
<h3 class="callout-title">Challenge 3: Subset Spatial Line Objects Part
2<a class="anchor" aria-label="anchor" href="#challenge-3-subset-spatial-line-objects-part-2"></a>
</h3>
<div class="callout-content">
<p>Subset out all <code>stone wall</code> features from the lines layer
and plot it. For each plot, color each feature using a unique color.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>First we will save an object with only the stone wall lines and check
the number of features:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stoneWall_HARV</span> <span class="op">&lt;-</span> <span class="va">lines_HARV</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">TYPE</span> <span class="op">==</span> <span class="st">"stone wall"</span><span class="op">)</span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">stoneWall_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 6</code></pre>
</div>
<p>Now we can plot the data:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">stoneWall_HARV</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">OBJECTID</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Wall ID"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Stonewalls"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-harv-stone-wall-map-1.png" alt="Map of the stone walls in the study area where each feature is colored differently." class="figure mx-auto d-block"><figcaption>
Map of the stone walls in the study area where each feature is colored
differently.
</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
</section><section id="customize-plots"><h2 class="section-heading">Customize Plots<a class="anchor" aria-label="anchor" href="#customize-plots"></a>
</h2>
<hr class="half-width">
<p>In the examples above, <code>ggplot()</code> automatically selected
colors for each line based on a default color order. If we don’t like
those default colors, we can create a vector of colors - one for each
feature.</p>
<p>First we will check how many unique line types there are:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">$</span><span class="va">TYPE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "woods road" "footpath"   "stone wall" "boardwalk" </code></pre>
</div>
<p>Then we can create a palette of four colors, one for each feature in
our vector object.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"navy"</span>, <span class="st">"purple"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can tell <code>ggplot</code> to use these colors when we plot the
data.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Trails"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-harv-paths-map-1.png" alt="Roads and trails in the area." class="figure mx-auto d-block"><figcaption>
Roads and trails in the area.
</figcaption></figure><div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>Note that <code>ggplot</code> automatically decides which colors
belong with which variables, based on the order of the colors in the
color vector, and the alphabetical order of the road types. You can
specify which colors to use for which road type by creating a named
vector:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"stone wall"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"board walk"</span> <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>                 <span class="st">"footpath"</span> <span class="op">=</span> <span class="st">"navy"</span>, <span class="st">"woods road"</span> <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="adjust-line-width">Adjust Line Width<a class="anchor" aria-label="anchor" href="#adjust-line-width"></a>
</h3>
<p>We adjusted line width universally earlier. If we want a unique line
width for each level or attribute category in our spatial object, we can
use the same syntax that we used for colors, above.</p>
<p>We already know that we have four different <code>TYPE</code>s in the
lines_HARV object, so we will set four different line widths.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_widths</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre>
</div>
<p>We can use those line widths when we plot the data.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span>, linewidth <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_widths</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>,</span>
<span>       linewidth <span class="op">=</span> <span class="st">"Road Type"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Trails - Line width varies"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-harv-paths-map-wide-1.png" alt="Roads and trails in the area demonstrating how to use different line thickness and colors." class="figure mx-auto d-block"><figcaption>
Roads and trails in the area demonstrating how to use different line
thickness and colors.
</figcaption></figure><div id="challenge-4-plot-line-width-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4-plot-line-width-by-attribute" class="callout-inner">
<h3 class="callout-title">Challenge 4: Plot Line Width by Attribute<a class="anchor" aria-label="anchor" href="#challenge-4-plot-line-width-by-attribute"></a>
</h3>
<div class="callout-content">
<p>In the example above, we set the line widths to be 1, 2, 3, and 4.
Because R orders alphabetically by default, this gave us a plot where
woods roads (the last type) were the thickest and boardwalks were the
thinnest.</p>
<p>Let’s create another plot where we show the different line types with
the following thicknesses:</p>
<ol style="list-style-type: decimal">
<li>woods road width = 6</li>
<li>boardwalks width = 1</li>
<li>footpath width = 3</li>
<li>stone wall width = 2</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>First we need to look at the levels of our factor to see what order
the road types are in:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">$</span><span class="va">TYPE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "woods road" "footpath"   "stone wall" "boardwalk" </code></pre>
</div>
<p>We then can create our <code>line_width</code> vector setting each of
the levels to the desired thickness.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">line_width</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"woods road"</span> <span class="op">=</span> <span class="fl">6</span>, <span class="st">"footpath"</span> <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                <span class="st">"stone wall"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"boardwalk"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can create our plot.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">line_width</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Trails - Line width varies"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-harv-path-line-types-1.png" alt="Roads and trails in the area with different line thickness for each type of paths." class="figure mx-auto d-block"><figcaption>
Roads and trails in the area with different line thickness for each type
of paths.
</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="add-plot-legend">Add Plot Legend<a class="anchor" aria-label="anchor" href="#add-plot-legend"></a>
</h3>
<p>When we plot a vector object and specify colors, line widths, etc.
using the <code>mapping = aes()</code> function, R will automatically
add a plot to our legend. By default, the plot legend will show up on
the right side of the plot and will include the values that we supplied
to the ggplot object. We can adjust the way our legends look in a
variety of ways.</p>
<ul>
<li>We specify the location of our legend by using a default keyword.
For example, we could use <code>bottomright</code>, <code>top</code>,
<code>topright</code>, etc.</li>
<li>We can change the font size</li>
<li>We can change the little things, like the color of the legend box
outline</li>
<li>And so much more!</li>
</ul>
<p>Pretty much anything you would want to change on a plot, you can! We
do this using the <code>theme()</code> function in R.</p>
<p>Let’s start with our basic plot. We will use the
<code>road_colors</code> object that we created above to color the
legend. We’ll also move the legend to the bottom by specifying
<code>theme(legend.position = "bottom")</code>.</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Trails - Default Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-add-legend-to-plot-1.png" alt="Roads and trails in the study area using thicker lines than the previous figure." class="figure mx-auto d-block"><figcaption>
Roads and trails in the study area using thicker lines than the previous
figure.
</figcaption></figure><p>Now, let’s change the appearance of our legend by manually setting
different parameters using the <code>theme()</code> function.</p>
<p>We can start by changing the font size in the legend. The way we
would do this is by adding the following line to our plot code:
<code>theme(legend.text = element_text(size = 20))</code></p>
<p>This may seem a little confusing, but there is a method to the
madness. First, we note what we’re trying to change (the
<code>legend.text</code> argument). Next, we have to specify what kind
of object it needs to be. Since we’re altering the legend <em>text</em>,
it needs to be a text element, so we use the <code>element_text()</code>
function. Within this function, we can specify what we want to change
from the default. In this case, it’s the size of the font
(<code>size = 20</code>), but we could do this for things like color,
the face (plain, italic, bold, bold.italic), the angle of rotation for
the text, etc.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Trails - Default Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>        legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-modify-legend-plot-1.png" alt="Map of the paths in the study area with large-font." class="figure mx-auto d-block"><figcaption>
Map of the paths in the study area with large-font.
</figcaption></figure><p>We can decide to have a box around the legend, by altering the
<code>legend.box.background</code> to have a black border. Since the
legend is a rectangle of sorts, we will use the element:
<code>element_rect()</code> to adjust these parameters.</p>
<p>So our new line would be:</p>
<p><code>theme(legend.box.background = element_rect(color = "black"))</code></p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Road Type"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads &amp; Trails - Default Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>        legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, </span>
<span>        legend.box.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-modify-legend-plot-box-1.png" alt="Map of the paths in the study area with large-font and an outline around the legend." class="figure mx-auto d-block"><figcaption>
Map of the paths in the study area with large-font and an outline around
the legend.
</figcaption></figure><div id="data-tip-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip-1" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip-1"></a>
</h3>
<div class="callout-content">
<p>You can modify the default R color palette using the palette method.
For example <code>palette(rainbow(6))</code> or
<code>palette(terrain.colors(6))</code>. You can reset the palette
colors using <code>palette("default")</code>!</p>
<p>You can also use colorblind-friendly palettes such as those in the <a href="https://cran.r-project.org/package=viridis" class="external-link">viridis
package</a>.</p>
</div>
</div>
</div>
<div id="challenge-5-plot-lines-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5-plot-lines-by-attribute" class="callout-inner">
<h3 class="callout-title">Challenge 5: Plot Lines by Attribute<a class="anchor" aria-label="anchor" href="#challenge-5-plot-lines-by-attribute"></a>
</h3>
<div class="callout-content">
<p>Create a plot that emphasizes only roads where bicycles and horses
are allowed. To emphasize this, make the lines where bicycles are not
allowed THINNER than the roads where bicycles are allowed. NOTE: this
attribute information is located in the
<code>lines_HARV$BicyclesHo</code> attribute.</p>
<p>Be sure to add a title and legend to your map. You might consider a
color palette that has all bike/horse-friendly roads displayed in a
bright color. All other lines can be black.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>First we explore the <code>BicyclesHo</code> attribute to learn the
values that correspond to the roads we need.</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_HARV</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">BicyclesHo</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unique</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Bicycles and Horses Allowed"     NA                               
[3] "DO NOT SHOW ON REC MAP"          "Bicycles and Horses NOT ALLOWED"</code></pre>
</div>
<p>Now, we can create a data frame with only those roads where bicycles
and horses are allowed.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines_showHarv</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lines_HARV</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">BicyclesHo</span> <span class="op">==</span> <span class="st">"Bicycles and Horses Allowed"</span><span class="op">)</span></span></code></pre>
</div>
<p>Finally, we plot the needed roads after setting them to magenta and a
thicker line width.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_showHarv</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">BicyclesHo</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="st">"magenta"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Roads Where Bikes and Horses Are Allowed"</span>, </span>
<span>       color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-harv-paths-bike-horses-1.png" alt="Roads and trails in the area highlighting paths where horses and bikes are allowed." class="figure mx-auto d-block"><figcaption>
Roads and trails in the area highlighting paths where horses and bikes
are allowed.
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="challenge-6-plot-polygon-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-6-plot-polygon-by-attribute" class="callout-inner">
<h3 class="callout-title">Challenge 6: Plot Polygon by Attribute<a class="anchor" aria-label="anchor" href="#challenge-6-plot-polygon-by-attribute"></a>
</h3>
<div class="callout-content">
<p>Create a map of the state boundaries in the United States using the
data located in your downloaded data folder:
<code>NEON-DS-Site-Layout-Files/US-Boundary-Layers\US-State-Boundaries-Census-2014</code>.
Note that this dataset includes Z and M coordinates, which we do not
need. Use the <code>st_zm()</code> function to drop these dimensions
before plotting.</p>
<p>When plotting, apply a line color to each state using its
<code>region</code> value. Be sure to add a legend to your plot as
well.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">Show me the solution</h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>First we read in the data and check how many levels there are in the
<code>region</code> column:</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_boundary_US</span> <span class="op">&lt;-</span></span>
<span><span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="co"># NOTE: We need neither Z nor M coordinates!</span></span>
<span><span class="fu">st_zm</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `US-State-Boundaries-Census-2014' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 58 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY, XYZ
Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_boundary_US</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu">as.factor</span><span class="op">(</span><span class="va">state_boundary_US</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">state_boundary_US</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Midwest"   "Northeast" "Southeast" "Southwest" "West"     </code></pre>
</div>
<p>Next we set a color vector with that many items:</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"springgreen"</span>, <span class="st">"yellow"</span>, <span class="st">"brown"</span>, <span class="st">"navy"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can create our plot:</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">state_boundary_US</span>, </span>
<span>          mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">region</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Contiguous U.S. State Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/13-vector-shapefile-attributes-in-r-rendered-colored-state-boundaries-1.png" alt="Map of the continental United States where the state lines are colored by region." class="figure mx-auto d-block"><figcaption>
Map of the continental United States where the state lines are colored
by region.
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Spatial objects in <code>sf</code> are similar to standard data
frames and can be manipulated using the same functions.</li>
<li>Almost any feature of a plot can be customized using the various
functions and options in the <code>ggplot2</code> package.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></section><section id="aio-14-vector-plot-shapefiles-custom-legend"><p>Content from <a href="14-vector-plot-shapefiles-custom-legend.html">Plot Multiple Vector and Raster Layers</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/14-vector-plot-shapefiles-custom-legend.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create map compositions with custom legends using
ggplot?</li>
<li>How can I plot raster and vector data together?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Plot multiple vector layers in the same plot.</li>
<li>Apply custom symbols to spatial objects in a plot.</li>
<li>Create a multi-layered plot with raster and vector data.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode builds upon previous episodes that work with vector
layers in R and explore how to plot multiple vector layers. It also
covers how to plot raster and vector data together on the same plot.</p>
<section id="load-the-data"><h2 class="section-heading">Load the Data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<hr class="half-width">
<p>To work with vector data in R, we can use the <code>sf</code>
package. To work with raster data in R, we can use the
<code>terra</code> package. Make sure that you have these packages
loaded.</p>
<p>We will continue to work with the three ESRI <code>shapefile</code>
that we loaded in the <a href="12-vector-open-shapefile-in-r/">Open and
Plot Vector Layers in R</a> episode and the raster file we used in
previous episodes.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the data</span></span>
<span><span class="va">aoi_boundary_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp"</span><span class="op">)</span></span>
<span><span class="va">lines_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARV_roads.shp"</span><span class="op">)</span></span>
<span><span class="va">point_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp"</span><span class="op">)</span></span>
<span><span class="va">CHM_HARV</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/CHM/HARV_chmCrop.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the color palette from earlier lessons</span></span>
<span><span class="va">road_colors</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"navy"</span>, <span class="st">"purple"</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="plotting-multiple-vector-layers"><h2 class="section-heading">Plotting Multiple Vector Layers<a class="anchor" aria-label="anchor" href="#plotting-multiple-vector-layers"></a>
</h2>
<hr class="half-width">
<p>In the previous episode, we learned how to plot information from a
single vector layer and do some plot customization including adding a
custom legend. However, what if we want to create a more complex plot
with many vector layers and unique symbols that need to be represented
clearly in a legend?</p>
<p>Now, let’s create a plot that combines our tower location
(<code>point_HARV</code>), site boundary
(<code>aoi_boundary_HARV</code>) and roads (<code>lines_HARV</code>)
spatial objects. We will need to build a custom legend as well.</p>
<p>To begin, we will create a plot with the site boundary as the first
layer. Then layer the tower location and road data on top using
<code>+</code>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-plot-many-shapefiles-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Next, let’s build a custom legend using the symbology (the colors and
symbols) that we used to create the plot above.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-plot-custom-shape-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>What if we wanted to have a legend for the tower location (the
point)? We can trick R into adding the legend for us, by specifying an
aesthetic and value to plot within the <code>mapping = aes()</code>
function for that layer. We’ve already used the color aesthetic in the
plot for the road colors, so we’ll have to use another aesthetic type
for getting the tower location to show up. In this example, let’s use
the fill aesthetic (note that there are also scales we can apply to the
point shape and alpha [transparency]).</p>
<p>We can do that by changing the line of code that plots the point:
<code>geom_sf(data = point_HARV, aes(fill = "Tower location"))</code></p>
<p>This tells the plot that we want to color the “fill” of the point to
be dictated by the “Tower location” label. We can pair this with a
custom fill palette so that it’s plotted the way we want. For
example:</p>
<p><code>scale_fill_manual(values = c("Tower location" = "black"))</code></p>
<p>This tells the plot that anything filled with the “Tower location”
tag will actually be colored black.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Tower location"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Tower location"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-plot-custom-shape-legend-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now lets adjust the legend titles by passing a <code>name</code> to
the respective <code>color</code> and <code>fill</code> palettes. We can
do this within the <code>color_scale_manual()</code> and
<code>color_fill_manual()</code> functions, or within the
<code>labs()</code> function. If we don’t want a title for either of
those values, we can assign the name to NULL.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Tower location"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Tower location"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       color <span class="op">=</span> <span class="st">"Line Type"</span>, </span>
<span>       fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-create-custom-legend-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Finally, it might be better if the points were symbolized as a
symbol. We can customize this using <code>shape</code> parameters in our
call to <code>geom_sf</code>: 16 is a point symbol, 15 is a box.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>To view a short list of <code>shape</code> symbols, type
<code>?pch</code> into the R console.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Tower location"</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Tower location"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       color <span class="op">=</span> <span class="st">"Line Type"</span>, </span>
<span>       fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-custom-symbols-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1-plot-polygon-by-attribute" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-plot-polygon-by-attribute" class="callout-inner">
<h3 class="callout-title">Challenge 1: Plot Polygon by Attribute<a class="anchor" aria-label="anchor" href="#challenge-1-plot-polygon-by-attribute"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Using the
<code>NEON-DS-Site-Layout-Files/HARV/PlotLocations_HARV.shp</code> ESRI
<code>shapefile</code>, create a map of study plot locations, with each
point colored by the soil type (<code>soilTypeOr</code>). How many
different soil types are there at this particular field site? Overlay
this layer on top of the <code>lines_HARV</code> layer (the roads).
Create a custom legend that applies line symbols to lines and point
symbols to the points.</p></li>
<li><p>Modify the plot above. Tell R to plot each point, using a
different symbol of <code>shape</code> value.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>First we need to read in the data and see how many unique soils are
represented in the <code>soilTypeOr</code> attribute.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_locations</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/PlotLocations_HARV.shp"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `PlotLocations_HARV' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/HARV/PlotLocations_HARV.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 21 features and 25 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 731405.3 ymin: 4712845 xmax: 732275.3 ymax: 4713846
Projected CRS: WGS 84 / UTM zone 18N</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">plot_locations</span><span class="op">$</span><span class="va">soilTypeOr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Inceptisols" "Histosols"  </code></pre>
</div>
<p>Next we can create a new color palette with one color for each soil
type.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blue_orange</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="st">"darkorange"</span><span class="op">)</span></span></code></pre>
</div>
<p>Finally, we will create our plot.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_locations</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">soilTypeOr</span><span class="op">)</span>,</span>
<span>          shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">blue_orange</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       color <span class="op">=</span> <span class="st">"Line Type"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"Soil Type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-harv-plot-locations-bg-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If we want each soil to be shown with a different symbol, we can give
multiple values to the <code>scale_shape_manual()</code> argument.</p>
<p>This get’s a little tricky though, because now we have a legend for
the fill color and a legend for the shape for the soil type from the
plot locations. We can override the aesthetics of the legends so that we
only display one of the legends for the plot soil type - a legend that
includes the right shape and the right colors. We do that by removing
one of the legends from the plot and altering the legend we want to
keep.</p>
<p>Let’s change the <code>scale_shape_manual()</code> to include the
appropriate fill colors for the points. To do this, we will use
<code>guide = guide_legend()</code> within the
<code>scale_shape_manual()</code> function. We override the aesthetics
by using <code>override.aes</code> and providing it with a list of
things to override.</p>
<p>Putting it all together results in a line of code that looks like
this:
<code>scale_shape_manual(values = c(21, 22), guide = guide_legend(override.aes = list(fill = blue_orange)))</code></p>
<p>Here, we’re specifying that we want to keep the legend for the
shapes, but we want the legend (the guide) to look different than the
default. We want to override the default fill values (which is black) to
the colors in the <code>blue_orange</code> vector. This will make the
legend match the actual points on the plot.</p>
<p>It’s a lot to take in, we know, but it might come in handy for our
own research!</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_locations</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">soilTypeOr</span>, shape <span class="op">=</span> <span class="va">soilTypeOr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">road_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">blue_orange</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_shape_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">22</span><span class="op">)</span>, </span>
<span>                     guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">blue_orange</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site"</span>, </span>
<span>       color <span class="op">=</span> <span class="st">"Line Type"</span>, </span>
<span>       shape <span class="op">=</span> <span class="st">"Soil Type"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-harv-plot-locations-pch-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="plotting-raster-vector-data-together"><h2 class="section-heading">Plotting Raster &amp; Vector Data Together<a class="anchor" aria-label="anchor" href="#plotting-raster-vector-data-together"></a>
</h2>
<hr class="half-width">
<p>You can plot vector data layered on top of raster data using the
<code>ggplot2</code> package or the <a href="https://r-tmap.github.io/tmap/" class="external-link"><code>tmap</code></a> package.</p>
<p>We’ll first go into how to do this using <code>ggplot</code>, and
then we’ll create a similar plot using <code>tmap</code>.</p>
<p>Together, let’s create a plot that uses the NEON AOI Canopy Height
Model
<code>data/NEON-DS-Airborne-Remote-Sensing/HARV/CHM/HARV_chmCrop.tif</code>
as a base layer. On top of the CHM, we will add the study site AOI,
roads, and the tower location.</p>
<p>Remember for <code>ggplot</code> to be able to plot raster data, we
first need to convert it to a data frame.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can add it to the plot as a <code>geom_raster()</code>
object:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_HARV_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lines_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NEON Harvard Forest Field Site w/ Canopy Height Model"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"Canopy Height"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now we can make a similar plot using <code>tmap</code>.</p>
<p>If you haven’t downloaded the <code>tmap</code> package yet, you can
do so by going to the Packages tab in your R console and installing a
new package, or you can type the following code into your R console:</p>
<p><code>install.packages("tmap")</code></p>
<p>Once downloaded, remember to load <code>tmap</code> into your
environment using:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tmap</span><span class="op">)</span></span></code></pre>
</div>
<p>The syntax for <code>tmap</code> is to first specify a layer to plot
and then to specify the kind of layer it is. For example, if you wanted
to plot a raster first, and then a vector layer on top of it, you would
write something like this:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">raster_object</span><span class="op">)</span> <span class="op">+</span> <span class="co"># first we specify the object to plot first</span></span>
<span>  <span class="fu">tm_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># then we specify the kind of object it is</span></span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">vector_object</span><span class="op">)</span> <span class="op">+</span> <span class="co"># then we specify the object to plot next</span></span>
<span>  <span class="fu">tm_sf</span><span class="op">(</span><span class="op">)</span> <span class="co"># then we specify the kind of object it is</span></span></code></pre>
</div>
<p>You can specify things like color and shape within the
<code>tm_sf()</code> function as <code>col = "black"</code> or
<code>shape = 8</code> for example.</p>
<p>Once we make our plot, we can add a title by adding
<code>tm_title("Title here")</code> at the end.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the plot</span></span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">CHM_HARV</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">lines_HARV</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">aoi_boundary_HARV</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_sf</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey20"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_shape</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_sf</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tm_title</span><span class="op">(</span><span class="st">"NEON Harvard Forest Field Site w/ Canopy Height Model"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>SpatRaster object downsampled to 898 by 1115 cells.</code></pre>
</div>
<figure><img src="fig/14-vector-plot-shapefiles-custom-legend-rendered-challenge-vector-raster-overlay-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>+</code> operator to add multiple layers to a
ggplot.</li>
<li>Multi-layered plots can combine raster and vector datasets.
<code>tmap</code> does this best (see Challenge 2)!</li>
<li>Use the <code>show.legend</code> argument to set legend symbol
types.</li>
<li>Use the <code>scale_fill_manual()</code> function to set legend
colors.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-15-vector-when-data-dont-line-up-crs"><p>Content from <a href="15-vector-when-data-dont-line-up-crs.html">Handling Spatial Projection &amp; CRS</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/15-vector-when-data-dont-line-up-crs.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What do I do when vector data don’t line up?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Plot vector objects with different CRSs in the same plot.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In an earlier episode we learned how to handle a situation where you
have two different files with raster data in different projections. Now
we will apply those same principles to working with vector data. We will
create a base map of our study site using United States state and
country boundary information accessed from the <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html" class="external-link">United
States Census Bureau</a>. We will learn how to map vector data that are
in different CRSs and thus don’t line up on a map.</p>
<p>We will continue to work with the some of the ESRI
<code>shapefiles</code> that we loaded in the previous episodes.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp"</span><span class="op">)</span></span></code></pre>
</div>
<section id="working-with-spatial-data-from-different-sources"><h2 class="section-heading">Working With Spatial Data From Different Sources<a class="anchor" aria-label="anchor" href="#working-with-spatial-data-from-different-sources"></a>
</h2>
<hr class="half-width">
<p>We often need to gather spatial datasets from different sources
and/or data that cover different spatial extents. These data are often
in different Coordinate Reference Systems (CRSs).</p>
<p>Some reasons for data being in different CRSs include:</p>
<ol style="list-style-type: decimal">
<li>The data are stored in a particular CRS convention used by the data
provider (for example, a government agency).</li>
<li>The data are stored in a particular CRS that is customized to a
region. For instance, many states in the US prefer to use a State Plane
projection customized for that state.</li>
</ol>
<figure><img src="fig/map_usa_different_projections.jpg" alt="Maps of the United States using data in different projections. Source: opennews.org, from: https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg" class="figure mx-auto d-block"><div class="figcaption">Maps of the United States using data in
different projections. Source: opennews.org, from: <a href="https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg" class="external-link uri">https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg</a>
</div>
</figure><p>Notice the differences in shape associated with each different
projection. These differences are a direct result of the calculations
used to “flatten” the data onto a 2-dimensional map. Often data are
stored purposefully in a particular projection that optimizes the
relative shape and size of surrounding geographic boundaries (states,
counties, countries, etc).</p>
<p>In this episode we will learn how to identify and manage spatial data
in different projections. We will learn how to reproject the data so
that they are in the same projection to support plotting / mapping. Note
that these skills are also required for any geoprocessing / spatial
analysis. Data need to be in the same CRS to ensure accurate
results.</p>
<p>We will continue to use the <code>sf</code> package in this
episode.</p>
</section><section id="import-us-boundaries---census-data"><h2 class="section-heading">Import US Boundaries - Census Data<a class="anchor" aria-label="anchor" href="#import-us-boundaries---census-data"></a>
</h2>
<hr class="half-width">
<p>There are many good sources of boundary base layers that we can use
to create a basemap. Some R packages even have these base layers built
in to support quick and efficient mapping. In this episode, we will use
boundary layers for the contiguous United States, provided by the <a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html" class="external-link">United
States Census Bureau</a>. It is useful to have vector layers in ESRI’s
<code>shapefile</code> format to work with because we can add additional
attributes to them if need be - for project specific mapping.</p>
</section><section id="read-us-boundary-file"><h2 class="section-heading">Read US Boundary File<a class="anchor" aria-label="anchor" href="#read-us-boundary-file"></a>
</h2>
<hr class="half-width">
<p>We will use the <code>st_read()</code> function to import the
<code>/US-Boundary-Layers/US-State-Boundaries-Census-2014</code> layer
into R. This layer contains the boundaries of all contiguous states in
the U.S. Please note that these data have been modified and reprojected
from the original data downloaded from the Census website to support the
learning goals of this episode. We only care about the x and y
coordinates, not the z or m dimensions, so we will use
<code>st_zm()</code> to drop the coordinates that we do not need.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_boundary_US</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_zm</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `US-State-Boundaries-Census-2014' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 58 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY, XYZ
Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<p>Next, let’s plot the U.S. states data:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">state_boundary_US</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous US State Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-vector-when-data-dont-line-up-crs-rendered-find-coordinates-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="u.s.-boundary-layer"><h2 class="section-heading">U.S. Boundary Layer<a class="anchor" aria-label="anchor" href="#u.s.-boundary-layer"></a>
</h2>
<hr class="half-width">
<p>We can add a boundary layer of the United States to our map - to make
it look nicer. We will import
<code>NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_boundary_US</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_zm</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `US-Boundary-Dissolved-States' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XYZ
Bounding box:  xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<p>If we specify a thicker line width using <code>linewidth = 0.5</code>
for the border layer, it will make our map pop! We will also manually
set the colors of the state boundaries and country boundaries.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">state_boundary_US</span>, color <span class="op">=</span> <span class="st">"gray60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_US</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.25</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous US State Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-vector-when-data-dont-line-up-crs-rendered-us-boundaries-thickness-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Next, let’s add the location of a flux tower where our study area is.
As we are adding these layers, take note of the CRS of each object.
First let’s look at the CRS of our tower location object:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs"</code></pre>
</div>
<p>Our project string for <code>point_HARV</code> specifies the UTM
projection as follows:</p>
<p><code>+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs</code></p>
<ul>
<li>
<strong>proj=utm:</strong> the projection is UTM, UTM has several
zones.</li>
<li>
<strong>zone=18:</strong> the zone is 18</li>
<li>
<strong>datum=WGS84:</strong> the datum WGS84 (the datum refers to
the 0,0 reference for the coordinate system used in the projection)</li>
<li>
<strong>units=m:</strong> the units for the coordinates are in
METERS.</li>
</ul>
<p>Note that the <code>zone</code> is unique to the UTM projection. Not
all CRSs will have a zone.</p>
<p>Let’s check the CRS of our state and country boundary objects:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">state_boundary_US</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=longlat +datum=WGS84 +no_defs"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">country_boundary_US</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "+proj=longlat +datum=WGS84 +no_defs"</code></pre>
</div>
<p>Our project string for <code>state_boundary_US</code> and
<code>country_boundary_US</code> specifies the lat/long projection as
follows:</p>
<p><code>+proj=longlat +datum=WGS84 +no_defs</code></p>
<ul>
<li>
<strong>proj=longlat:</strong> the data are in a geographic
(latitude and longitude) coordinate system</li>
<li>
<strong>datum=WGS84:</strong> the datum WGS84 (the datum refers to
the 0,0 reference for the coordinate system used in the projection)</li>
<li>
<strong>no_defs:</strong> ensures that no defaults are used, but
this is now obsolete</li>
</ul>
<p>Note that there are no specified units above. This is because this
geographic coordinate reference system is in latitude and longitude
which is most often recorded in decimal degrees.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>the last portion of each <code>proj4</code> string could potentially
be something like <code>+towgs84=0,0,0</code>. This is a conversion
factor that is used if a datum conversion is required. We will not deal
with datums in this episode series.</p>
</div>
</div>
</div>
</section><section id="crs-units---view-object-extent"><h2 class="section-heading">CRS Units - View Object Extent<a class="anchor" aria-label="anchor" href="#crs-units---view-object-extent"></a>
</h2>
<hr class="half-width">
<p>Next, let’s view the extent or spatial coverage for the
<code>point_HARV</code> spatial object compared to the
<code>state_boundary_US</code> object.</p>
<p>First we’ll look at the extent for our study site:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     xmin      ymin      xmax      ymax 
 732183.2 4713265.0  732183.2 4713265.0 </code></pre>
</div>
<p>And then the extent for the state boundary data.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">state_boundary_US</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      xmin       ymin       xmax       ymax 
-124.72584   24.49813  -66.94989   49.38436 </code></pre>
</div>
<p>Note the difference in the units for each object. The extent for
<code>state_boundary_US</code> is in latitude and longitude which yields
smaller numbers representing decimal degree units. Our tower location
point is in UTM, is represented in meters.</p>
<div id="proj4-crs-resources" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="proj4-crs-resources" class="callout-inner">
<h3 class="callout-title">Proj4 &amp; CRS Resources<a class="anchor" aria-label="anchor" href="#proj4-crs-resources"></a>
</h3>
<div class="callout-content">
<ul>
<li><a href="https://proj4.org/" class="external-link">Official PROJ library
documentation</a></li>
<li><a href="https://proj.maptools.org/faq.html" class="external-link">More information on the
proj4 format.</a></li>
<li><a href="https://spatialreference.org" class="external-link">A fairly comprehensive list
of CRSs by format.</a></li>
</ul>
</div>
</div>
</div>
</section><section id="reproject-vector-data-or-no"><h2 class="section-heading">Reproject Vector Data or No?<a class="anchor" aria-label="anchor" href="#reproject-vector-data-or-no"></a>
</h2>
<hr class="half-width">
<p>We saw in <a href="11-raster-reproject-in-r/">an earlier episode</a>
that when working with raster data in different CRSs, we needed to
convert all objects to the same CRS. We can do the same thing with our
vector data - however, we don’t need to! When using the
<code>ggplot2</code> package, <code>ggplot</code> automatically converts
all objects to the same CRS before plotting. This means we can plot our
three data sets together without doing any conversion:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">state_boundary_US</span>, color <span class="op">=</span> <span class="st">"gray60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_US</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span>, shape <span class="op">=</span> <span class="fl">19</span>, color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Contiguous US State Boundaries"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-vector-when-data-dont-line-up-crs-rendered-layer-point-on-states-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1-plot-multiple-layers-of-spatial-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-plot-multiple-layers-of-spatial-data" class="callout-inner">
<h3 class="callout-title">Challenge 1: Plot Multiple Layers of Spatial
Data<a class="anchor" aria-label="anchor" href="#challenge-1-plot-multiple-layers-of-spatial-data"></a>
</h3>
<div class="callout-content">
<p>Create a map of the North Eastern United States as follows:</p>
<ol style="list-style-type: decimal">
<li>Import and plot <code>Boundary-US-State-NEast.shp</code>. Adjust
line width as necessary.</li>
<li>Layer the Fisher Tower (in the NEON Harvard Forest site) point
location <code>point_HARV</code> onto the plot.</li>
<li>Add a title.</li>
<li>Add a legend that shows both the state boundary and the Tower
location point.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NE.States.Boundary.US</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/Boundary-US-State-NEast.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_zm</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Reading layer `Boundary-US-State-NEast' from data source 
  `/Users/echelleburns/Documents/2024-07-01-ucsb-intro-geospatial/site/built/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/Boundary-US-State-NEast.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 12 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY, XYZ
Bounding box:  xmin: -80.51989 ymin: 37.91685 xmax: -66.9499 ymax: 47.45716
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NE.States.Boundary.US</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span><span class="st">"State Boundary"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"State Boundary"</span> <span class="op">=</span> <span class="st">"gray18"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_HARV</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"Fisher Tower"</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_shape_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Fisher Tower"</span> <span class="op">=</span> <span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>         shape <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>         title <span class="op">=</span> <span class="st">"Fisher Tower location"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/15-vector-when-data-dont-line-up-crs-rendered-ne-states-harv-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<code>ggplot2</code> automatically converts all objects in a plot to
the same CRS.</li>
<li>Still be aware of the CRS and extent for each object.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-16-vector-csv-to-shapefile-in-r"><p>Content from <a href="16-vector-csv-to-shapefile-in-r.html">Convert from .csv to a Vector Layer</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/16-vector-csv-to-shapefile-in-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I import CSV files as vector layers in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Import .csv files containing x,y coordinate locations into R as a
data frame.</li>
<li>Convert a data frame to a spatial object.</li>
<li>Export a spatial object to a text file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode will review how to import spatial points stored in
<code>.csv</code> (Comma Separated Value) format into R as an
<code>sf</code> spatial object. We will also reproject data imported
from an ESRI <code>shapefile</code> format and export the reprojected
data as an ESRI <code>shapefile</code>.</p>
<p>Let’s load our packages and data for this episode:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi_boundary_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp"</span><span class="op">)</span></span>
<span><span class="va">country_boundary_US</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp"</span><span class="op">)</span></span>
<span><span class="va">point_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp"</span><span class="op">)</span></span></code></pre>
</div>
<section id="spatial-data-in-text-format"><h2 class="section-heading">Spatial Data in Text Format<a class="anchor" aria-label="anchor" href="#spatial-data-in-text-format"></a>
</h2>
<hr class="half-width">
<p>The <code>HARV_PlotLocations.csv</code> file contains
<code>x, y</code> (point) locations for study plot where NEON collects
data on <a href="https://www.neonscience.org/data-collection/terrestrial-organismal-sampling" class="external-link">vegetation
and other ecological metrics</a>. We would like to:</p>
<ul>
<li>Create a map of these plot locations.</li>
<li>Export the data in an ESRI <code>shapefile</code> format to share
with our colleagues. This <code>shapefile</code> can be imported into
most GIS software.</li>
<li>Create a map showing vegetation height with plot locations layered
on top.</li>
</ul>
<p>Spatial data are sometimes stored in a text file format
(<code>.txt</code> or <code>.csv</code>). If the text file has an
associated <code>x</code> and <code>y</code> location column, then we
can convert it into an <code>sf</code> spatial object. The
<code>sf</code> object allows us to store both the <code>x,y</code>
values that represent the coordinate location of each point and the
associated attribute data - or columns describing each feature in the
spatial object.</p>
<p>We will continue using the <code>sf</code> package in this
episode.</p>
</section><section id="import-.csv"><h2 class="section-heading">Import .csv<a class="anchor" aria-label="anchor" href="#import-.csv"></a>
</h2>
<hr class="half-width">
<p>To begin let’s import a <code>.csv</code> file that contains plot
coordinate <code>x, y</code> locations at the NEON Harvard Forest Field
Site (<code>HARV_PlotLocations.csv</code>) and look at the structure of
that new object:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_locations_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARV_PlotLocations.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">plot_locations_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	21 obs. of  16 variables:
 $ easting   : num  731405 731934 731754 731724 732125 ...
 $ northing  : num  4713456 4713415 4713115 4713595 4713846 ...
 $ geodeticDa: chr  "WGS84" "WGS84" "WGS84" "WGS84" ...
 $ utmZone   : chr  "18N" "18N" "18N" "18N" ...
 $ plotID    : chr  "HARV_015" "HARV_033" "HARV_034" "HARV_035" ...
 $ stateProvi: chr  "MA" "MA" "MA" "MA" ...
 $ county    : chr  "Worcester" "Worcester" "Worcester" "Worcester" ...
 $ domainName: chr  "Northeast" "Northeast" "Northeast" "Northeast" ...
 $ domainID  : chr  "D01" "D01" "D01" "D01" ...
 $ siteID    : chr  "HARV" "HARV" "HARV" "HARV" ...
 $ plotType  : chr  "distributed" "tower" "tower" "tower" ...
 $ subtype   : chr  "basePlot" "basePlot" "basePlot" "basePlot" ...
 $ plotSize  : int  1600 1600 1600 1600 1600 1600 1600 1600 1600 1600 ...
 $ elevation : num  332 342 348 334 353 ...
 $ soilTypeOr: chr  "Inceptisols" "Inceptisols" "Inceptisols" "Histosols" ...
 $ plotdim_m : int  40 40 40 40 40 40 40 40 40 40 ...</code></pre>
</div>
<p>We now have a data frame that contains 21 locations (rows) and 16
variables (attributes). Note that all of our character data was imported
into R as character (text) data. Next, let’s explore the dataframe to
determine whether it contains columns with coordinate values. If we are
lucky, our <code>.csv</code> will contain columns labeled:</p>
<ul>
<li>“X” and “Y” OR</li>
<li>Latitude and Longitude OR</li>
<li>easting and northing (UTM coordinates)</li>
</ul>
<p>Let’s check out the column names of our dataframe.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">plot_locations_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "easting"    "northing"   "geodeticDa" "utmZone"    "plotID"    
 [6] "stateProvi" "county"     "domainName" "domainID"   "siteID"    
[11] "plotType"   "subtype"    "plotSize"   "elevation"  "soilTypeOr"
[16] "plotdim_m" </code></pre>
</div>
</section><section id="identify-xy-location-columns"><h2 class="section-heading">Identify X,Y Location Columns<a class="anchor" aria-label="anchor" href="#identify-xy-location-columns"></a>
</h2>
<hr class="half-width">
<p>Our column names include several fields that might contain spatial
information. The <code>plot_locations_HARV$easting</code> and
<code>plot_locations_HARV$northing</code> columns contain coordinate
values. We can confirm this by looking at the first six rows of our
data.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">plot_locations_HARV</span><span class="op">$</span><span class="va">easting</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 731405.3 731934.3 731754.3 731724.3 732125.3 731634.3</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">plot_locations_HARV</span><span class="op">$</span><span class="va">northing</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4713456 4713415 4713115 4713595 4713846 4713295</code></pre>
</div>
<p>We have coordinate values in our data frame. In order to convert our
data frame to an <code>sf</code> object, we also need to know the CRS
associated with those coordinate values.</p>
<p>There are several ways to figure out the CRS of spatial data in text
format.</p>
<ol style="list-style-type: decimal">
<li>We can check the file metadata in hopes that the CRS was recorded in
the data.</li>
<li>We can explore the file itself to see if CRS information is embedded
in the file header or somewhere in the data columns.</li>
</ol>
<p>Following the <code>easting</code> and <code>northing</code> columns,
there is a <code>geodeticDa</code> and a <code>utmZone</code> column.
These appear to contain CRS information (<code>datum</code> and
<code>projection</code>). Let’s view those next.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">plot_locations_HARV</span><span class="op">$</span><span class="va">geodeticDa</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "WGS84" "WGS84" "WGS84" "WGS84" "WGS84" "WGS84"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">plot_locations_HARV</span><span class="op">$</span><span class="va">utmZone</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "18N" "18N" "18N" "18N" "18N" "18N"</code></pre>
</div>
<p>It is not typical to store CRS information in a column. But this
particular file contains CRS information this way. The
<code>geodeticDa</code> and <code>utmZone</code> columns contain the
information that helps us determine the CRS:</p>
<ul>
<li>
<code>geodeticDa</code>: WGS84 – this is geodetic datum WGS84</li>
<li>
<code>utmZone</code>: 18</li>
</ul>
<p>In <a href="15-vector-when-data-dont-line-up-crs.html">the previous
episode</a> we learned about the components of a <code>proj4</code>
string. We have everything we need to assign a CRS to our data
frame.</p>
<p>To create the <code>proj4</code> associated with UTM Zone 18 WGS84 we
can look up the projection on the <a href="https://spatialreference.org/ref/epsg/32618/" class="external-link">Spatial Reference
website</a>, which contains a list of CRS formats for each projection.
From here, we can extract the <a href="https://spatialreference.org/ref/epsg/32618/proj4.txt" class="external-link">proj4
string for UTM Zone 18N WGS84</a>.</p>
<p>However, if we have other data in the UTM Zone 18N projection, it’s
much easier to use the <code>st_crs()</code> function to extract the CRS
in <code>proj4</code> format from that object and assign it to our new
spatial object. We’ve seen this CRS before with our Harvard Forest study
site (<code>point_HARV</code>).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 / UTM zone 18N 
  wkt:
PROJCRS["WGS 84 / UTM zone 18N",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 18N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-75,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32618]]</code></pre>
</div>
<p>The output above shows that the points vector layer is in UTM zone
18N. We can thus use the CRS from that spatial object to convert our
non-spatial dataframe into an <code>sf</code> object.</p>
<p>Next, let’s create a <code>crs</code> object that we can use to
define the CRS of our <code>sf</code> object when we create it.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">utm18nCRS</span> <span class="op">&lt;-</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span>
<span><span class="va">utm18nCRS</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 / UTM zone 18N 
  wkt:
PROJCRS["WGS 84 / UTM zone 18N",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 18N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-75,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",32618]]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">utm18nCRS</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "crs"</code></pre>
</div>
</section><section id="csv-to-sf-object"><h2 class="section-heading">.csv to sf object<a class="anchor" aria-label="anchor" href="#csv-to-sf-object"></a>
</h2>
<hr class="half-width">
<p>Next, let’s convert our dataframe into an <code>sf</code> object. To
do this, we need to specify:</p>
<ol style="list-style-type: decimal">
<li>The columns containing X (<code>easting</code>) and Y
(<code>northing</code>) coordinate values</li>
<li>The CRS that the column coordinate represent (units are included in
the CRS) - stored in our <code>utmCRS</code> object.</li>
</ol>
<p>We will use the <code>st_as_sf()</code> function to perform the
conversion.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_locations_sp_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">plot_locations_HARV</span>,</span>
<span>                                   coords <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"easting"</span>, <span class="st">"northing"</span><span class="op">)</span>,</span>
<span>                                   crs <span class="op">=</span> <span class="va">utm18nCRS</span><span class="op">)</span></span></code></pre>
</div>
<p>We should double check the CRS to make sure it is correct and matches
the CRS of <code>point_HARV</code>.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">plot_locations_sp_HARV</span><span class="op">)</span> <span class="op">==</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">point_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] TRUE</code></pre>
</div>
</section><section id="plot-spatial-object"><h2 class="section-heading">Plot Spatial Object<a class="anchor" aria-label="anchor" href="#plot-spatial-object"></a>
</h2>
<hr class="half-width">
<p>We now have a spatial R object, we can plot our newly created spatial
object.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_locations_sp_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of Plot Locations"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-vector-csv-to-shapefile-in-r-rendered-plot-data-points-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="plot-extent"><h2 class="section-heading">Plot Extent<a class="anchor" aria-label="anchor" href="#plot-extent"></a>
</h2>
<hr class="half-width">
<p>In <a href="12-vector-open-shapefile-in-r.html">Open and Plot Vector
Layers in R</a> we learned about spatial object extent. When we plot
several spatial layers in R using <code>ggplot</code>, all of the layers
of the plot are considered in setting the boundaries of the plot. To
show this, let’s plot our <code>country_boundary_US</code> object.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">country_boundary_US</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_locations_sp_HARV</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Country Boundary Plot"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-vector-csv-to-shapefile-in-r-rendered-plot-data-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>When we plot the two layers together, <code>ggplot</code> sets the
plot boundaries so that they are large enough to include all of the data
included in all of the layers. That’s really handy!</p>
<div id="challenge-1-import-plot-additional-points" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-import-plot-additional-points" class="callout-inner">
<h3 class="callout-title">Challenge 1: Import &amp; Plot Additional
Points<a class="anchor" aria-label="anchor" href="#challenge-1-import-plot-additional-points"></a>
</h3>
<div class="callout-content">
<p>We want to add two phenology plots to our existing map of vegetation
plot locations.</p>
<p>Import the .csv: <code>HARV/HARV_2NewPhenPlots.csv</code> into R and
do the following:</p>
<ol style="list-style-type: decimal">
<li>Find the X and Y coordinate locations. Which value is X and which
value is Y?</li>
<li>These data were collected in a geographic coordinate system (WGS84).
Convert the dataframe into an <code>sf</code> object.</li>
<li>Plot the new points with the plot location points from above. Be
sure to add a legend. Use a different symbol for the 2 new points!</li>
</ol>
<p>If you have extra time, feel free to add roads and other layers to
your map!</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>First we will read in the new csv file and look at the data
structure.</li>
</ol>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newplot_locations_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARV_2NewPhenPlots.csv"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">newplot_locations_HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	2 obs. of  13 variables:
 $ decimalLat: num  42.5 42.5
 $ decimalLon: num  -72.2 -72.2
 $ country   : chr  "unitedStates" "unitedStates"
 $ stateProvi: chr  "MA" "MA"
 $ county    : chr  "Worcester" "Worcester"
 $ domainName: chr  "Northeast" "Northeast"
 $ domainID  : chr  "D01" "D01"
 $ siteID    : chr  "HARV" "HARV"
 $ plotType  : chr  "tower" "tower"
 $ subtype   : chr  "phenology" "phenology"
 $ plotSize  : int  40000 40000
 $ plotDimens: chr  "200m x 200m" "200m x 200m"
 $ elevation : num  358 346</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>The US boundary data we worked with previously is in a geographic
WGS84 CRS. We can use that data to establish a CRS for this data. First
we will extract the CRS from the <code>country_boundary_US</code> object
and confirm that it is WGS84.</li>
</ol>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geogCRS</span> <span class="op">&lt;-</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">country_boundary_US</span><span class="op">)</span></span>
<span><span class="va">geogCRS</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
<p>Then we will convert our new data to a spatial dataframe, using the
<code>geogCRS</code> object as our CRS.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newPlot.Sp.HARV</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">newplot_locations_HARV</span>,</span>
<span>                            coords <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"decimalLon"</span>, <span class="st">"decimalLat"</span><span class="op">)</span>,</span>
<span>                            crs <span class="op">=</span> <span class="va">geogCRS</span><span class="op">)</span></span></code></pre>
</div>
<p>Next we’ll confirm that the CRS for our new object is correct.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_crs</span><span class="op">(</span><span class="va">newPlot.Sp.HARV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
<p>We will be adding these new data points to the plot we created
before. The data for the earlier plot was in UTM. Since we’re using
<code>ggplot</code>, it will reproject the data for us.</p>
<ol start="3" style="list-style-type: decimal">
<li>Now we can create our plot.</li>
</ol>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_locations_sp_HARV</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">newPlot.Sp.HARV</span>, color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map of All Plot Locations"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/16-vector-csv-to-shapefile-in-r-rendered-plot-locations-harv-orange-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="export-to-an-esri-shapefile"><h2 class="section-heading">Export to an ESRI <code>shapefile</code><a class="anchor" aria-label="anchor" href="#export-to-an-esri-shapefile"></a>
</h2>
<hr class="half-width">
<p>We can write an R spatial object to an ESRI <code>shapefile</code>
using the <code>st_write</code> function in <code>sf</code>. To do this
we need the following arguments:</p>
<ul>
<li>the name of the spatial object
(<code>plot_locations_sp_HARV</code>)</li>
<li>the directory where we want to save our ESRI <code>shapefile</code>
(to use <code>current = getwd()</code> or you can specify a different
path)</li>
<li>the name of the new ESRI <code>shapefile</code>
(<code>PlotLocations_HARV</code>)</li>
<li>the driver which specifies the file format (ESRI Shapefile)</li>
</ul>
<p>We can now export the spatial object as an ESRI
<code>shapefile</code>.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_write</span><span class="op">(</span>obj <span class="op">=</span> <span class="va">plot_locations_sp_HARV</span>,</span>
<span>         dsn <span class="op">=</span> <span class="st">"data/cleaned-data/PlotLocations_HARV.shp"</span>, </span>
<span>         driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Know the projection (if any) of your point data prior to converting
to a spatial object.</li>
<li>Convert a data frame to an <code>sf</code> object using the
<code>st_as_sf()</code> function.</li>
<li>Export an <code>sf</code> object as text using the
<code>st_write()</code> function.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-17-vector-raster-integration"><p>Content from <a href="17-vector-raster-integration.html">Manipulate Raster Data</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/17-vector-raster-integration.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I crop raster objects to vector objects, and extract the
summary of raster pixels?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Crop a raster to the extent of a vector layer.</li>
<li>Extract values from a raster that correspond to a vector file
overlay.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode explains how to crop a raster using the extent of a
vector layer. We will also cover how to extract values from a raster
that occur within a set of polygons, or in a buffer (surrounding) region
around a set of points.</p>
<p>Let’s start by loading the libraries and data we need for this
episode:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp"</span><span class="op">)</span></span>
<span><span class="va">aoi_boundary_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CHM data, and convert it to a dataframe</span></span>
<span><span class="va">CHM_HARV</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">rast</span><span class="op">(</span><span class="st">"data/NEON-DS-Airborne-Remote-Sensing/HARV/CHM/HARV_chmCrop.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CHM_HARV_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_HARV</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_locations_sp_HARV</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/cleaned-data/PlotLocations_HARV.shp"</span><span class="op">)</span></span></code></pre>
</div>
<section id="crop-a-raster-to-vector-extent"><h2 class="section-heading">Crop a Raster to Vector Extent<a class="anchor" aria-label="anchor" href="#crop-a-raster-to-vector-extent"></a>
</h2>
<hr class="half-width">
<p>We often work with spatial layers that have different spatial
extents. The spatial extent of a vector layer or R spatial object
represents the geographic “edge” or location that is the furthest north,
south east and west. Thus it represents the overall geographic coverage
of the spatial object.</p>
<p><img src="fig/dc-spatial-vector/spatial_extent.png" alt="Extent illustration" class="figure"> Image Source: National Ecological
Observatory Network (NEON)</p>
<p>The graphic below illustrates the extent of several of the spatial
layers that we have worked with in this workshop:</p>
<ul>
<li>Area of interest (AOI) – blue</li>
<li>Roads and trails – purple</li>
<li>Vegetation plot locations (marked with white dots)– black</li>
<li>A canopy height model (CHM) in GeoTIFF format – green</li>
</ul>
<figure><img src="fig/17-vector-raster-integration-rendered-compare-data-extents-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Frequent use cases of cropping a raster file include reducing file
size and creating maps. Sometimes we have a raster file that is much
larger than our study area or area of interest. It is often more
efficient to crop the raster to the extent of our study area to reduce
file sizes as we process our data. Cropping a raster can also be useful
when creating pretty maps so that the raster layer matches the extent of
the desired vector layers.</p>
</section><section id="crop-a-raster-using-vector-extent"><h2 class="section-heading">Crop a Raster Using Vector Extent<a class="anchor" aria-label="anchor" href="#crop-a-raster-using-vector-extent"></a>
</h2>
<hr class="half-width">
<p>We can use the <code>crop()</code> function to crop a raster to the
extent of another spatial object. To do this, we need to specify the
raster to be cropped and the spatial object that will be used to crop
the raster. R will use the <code>extent</code> of the spatial object as
the cropping boundary.</p>
<p>To illustrate this, we will crop the Canopy Height Model (CHM) to
only include the area of interest (AOI). Let’s start by plotting the
full extent of the CHM data and overlay where the AOI falls within it.
The boundaries of the AOI will be colored blue, and we use
<code>fill = NA</code> to make the area transparent.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_HARV_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Canopy Height"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-crop-by-vector-extent-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now that we have visualized the area of the CHM we want to subset, we
can perform the cropping operation. We are going to <code>crop()</code>
function from the raster package to create a new object with only the
portion of the CHM data that falls within the boundaries of the AOI.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_HARV_Cropped</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>, y <span class="op">=</span> <span class="va">aoi_boundary_HARV</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can plot the cropped CHM data, along with a boundary box
showing the full CHM extent. However, remember, since this is raster
data, we need to convert to a data frame in order to plot using
<code>ggplot</code>. To get the boundary box from CHM, the
<code>st_bbox()</code> will extract the 4 corners of the rectangle that
encompass all the features contained in this object. The
<code>st_as_sfc()</code> converts these 4 coordinates into a polygon
that we can plot:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_HARV_Cropped_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_HARV_Cropped</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="fu">st_as_sfc</span><span class="op">(</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">CHM_HARV</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">boundary</span>, fill <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>          color <span class="op">=</span> <span class="st">"green"</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_HARV_Cropped_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Canopy Height"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-show-cropped-area-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The plot above shows that the full CHM extent (plotted in green) is
much larger than the resulting cropped raster. Our new cropped CHM now
has the same extent as the <code>aoi_boundary_HARV</code> object that
was used as a crop extent (blue border below).</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_HARV_Cropped_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Canopy Height"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-view-crop-extent-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1-crop-to-vector-points-extent" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-crop-to-vector-points-extent" class="callout-inner">
<h3 class="callout-title">Challenge 1: Crop to Vector Points Extent<a class="anchor" aria-label="anchor" href="#challenge-1-crop-to-vector-points-extent"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Crop the Canopy Height Model to the extent of the study plot
locations.</li>
<li>Plot the vegetation plot location points on top of the Canopy Height
Model.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_plots_HARVcrop</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>, y <span class="op">=</span> <span class="va">plot_locations_sp_HARV</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CHM_plots_HARVcrop_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_plots_HARVcrop</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_plots_HARVcrop_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_locations_sp_HARV</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Canopy Height"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-challenge-code-crop-raster-points-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>In the plot above, created in the challenge, all the vegetation plot
locations (black dots) appear on the Canopy Height Model raster layer
except for one. One is situated on the blank space to the left of the
map. Why?</p>
<p>A modification of the first figure in this episode is below, showing
the relative extents of all the spatial objects. Notice that the extent
for our vegetation plot layer (black) extends further west than the
extent of our CHM raster (bright green). The <code>crop()</code>
function will make a raster extent smaller, it will not expand the
extent in areas where there are no data. Thus, the extent of our
vegetation plot layer will still extend further west than the extent of
our (cropped) raster data (dark green).</p>
<figure><img src="fig/17-vector-raster-integration-rendered-repeat-compare-data-extents-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="define-an-extent"><h2 class="section-heading">Define an Extent<a class="anchor" aria-label="anchor" href="#define-an-extent"></a>
</h2>
<hr class="half-width">
<p>So far, we have used a vector layer to crop the extent of a raster
dataset. Alternatively, we can also the <code>ext()</code> function to
define an extent to be used as a cropping boundary. This creates a new
object of class extent. Here we will provide the <code>ext()</code>
function our xmin, xmax, ymin, and ymax (in that order).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_extent</span> <span class="op">&lt;-</span> <span class="fu">ext</span><span class="op">(</span><span class="fl">732161.2</span>, <span class="fl">732238.7</span>, <span class="fl">4713249</span>, <span class="fl">4713333</span><span class="op">)</span></span>
<span><span class="fu">class</span><span class="op">(</span><span class="va">new_extent</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "SpatExtent"
attr(,"package")
[1] "terra"</code></pre>
</div>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>The extent can be created from a numeric vector (as shown above), a
matrix, or a list. For more details see the <code>ext()</code> function
help file (<code>?terra::ext</code>).</p>
</div>
</div>
</div>
<p>Once we have defined our new extent, we can use the
<code>crop()</code> function to crop our raster to this extent
object.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_HARV_manual_cropped</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>, y <span class="op">=</span> <span class="va">new_extent</span><span class="op">)</span></span></code></pre>
</div>
<p>To plot this data using <code>ggplot()</code> we need to convert it
to a dataframe.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CHM_HARV_manual_cropped_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">CHM_HARV_manual_cropped</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can plot this cropped data. We will show the AOI boundary on
the same plot for scale.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CHM_HARV_manual_cropped_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">terrain.colors</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Canopy Height"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-show-manual-crop-area-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="extract-raster-pixels-values-using-vector-polygons"><h2 class="section-heading">Extract Raster Pixels Values Using Vector Polygons<a class="anchor" aria-label="anchor" href="#extract-raster-pixels-values-using-vector-polygons"></a>
</h2>
<hr class="half-width">
<p>Often we want to extract values from a raster layer for particular
locations - for example, plot locations that we are sampling on the
ground. We can extract all pixel values within 20m of our x,y point of
interest. These can then be summarized into some value of interest
(e.g. mean, maximum, total).</p>
<p><img src="fig//BufferSquare.png" alt="Image shows raster information extraction using 20m polygon boundary." class="figure">
Image Source: National Ecological Observatory Network (NEON)</p>
<p>To do this in R, we use the <code>extract()</code> function. The
<code>extract()</code> function requires:</p>
<ul>
<li>The raster that we wish to extract values from,</li>
<li>The vector layer containing the polygons that we wish to use as a
boundary or boundaries,</li>
<li>We can also tell it to store the output values in a data frame using
<code>raw = FALSE</code> (this is optional).</li>
</ul>
<p>We will begin by extracting all canopy height pixel values located
within our <code>aoi_boundary_HARV</code> polygon which surrounds the
tower located at the NEON Harvard Forest field site.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_height</span> <span class="op">&lt;-</span> <span class="fu">extract</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>, y <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>, raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">tree_height</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'data.frame':	18450 obs. of  2 variables:
 $ ID          : num  1 1 1 1 1 1 1 1 1 1 ...
 $ HARV_chmCrop: num  21.2 23.9 23.8 22.4 23.9 ...</code></pre>
</div>
<p>When we use the <code>extract()</code> function, R extracts the value
for each pixel located within the boundary of the polygon being used to
perform the extraction - in this case the <code>aoi_boundary_HARV</code>
object (a single polygon). Here, the function extracted values from
18,450 pixels.</p>
<p>We can create a histogram of tree height values within the boundary
to better understand the structure or height distribution of trees at
our site. We will use the column <code>HARV_chmCrop</code> from our data
frame as our x values, as this column represents the tree heights for
each pixel.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree_height</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Histogram of CHM Height Values (m)"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"Tree Height"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Frequency of Pixels"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-view-extract-histogram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can also use the <code>summary()</code> function to view
descriptive statistics including min, max, and mean height values. These
values help us better understand vegetation at our field site.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">tree_height</span><span class="op">$</span><span class="va">HARV_chmCrop</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2.03   21.36   22.81   22.43   23.97   38.17 </code></pre>
</div>
</section><section id="summarize-extracted-raster-values"><h2 class="section-heading">Summarize Extracted Raster Values<a class="anchor" aria-label="anchor" href="#summarize-extracted-raster-values"></a>
</h2>
<hr class="half-width">
<p>We often want to extract summary values from a raster. We can tell R
the type of summary statistic we are interested in using the
<code>fun =</code> argument. Let’s extract a mean height value for our
AOI.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_tree_height_AOI</span> <span class="op">&lt;-</span> <span class="fu">extract</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>, y <span class="op">=</span> <span class="va">aoi_boundary_HARV</span>,</span>
<span>                                fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mean_tree_height_AOI</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  ID HARV_chmCrop
1  1     22.43018</code></pre>
</div>
<p>It appears that the mean height value, extracted from our LiDAR data
derived canopy height model is 22.43 meters.</p>
</section><section id="extract-data-using-xy-locations"><h2 class="section-heading">Extract Data using x,y Locations<a class="anchor" aria-label="anchor" href="#extract-data-using-xy-locations"></a>
</h2>
<hr class="half-width">
<p>We can also extract pixel values from a raster by defining a buffer
or area surrounding individual point locations using the
<code>st_buffer()</code> function. To do this we define the summary
argument (<code>fun = mean</code>) and the buffer distance
(<code>dist = 20</code>) which represents the radius of a circular
region around each point. By default, the units of the buffer are the
same units as the data’s CRS. All pixels that are touched by the buffer
region are included in the extract.</p>
<p><img src="fig/BufferCircular.png" alt="Image shows raster information extraction using 20m buffer region." class="figure">
Image Source: National Ecological Observatory Network (NEON)</p>
<p>Let’s put this into practice by figuring out the mean tree height in
the 20m around the tower location (<code>point_HARV</code>).</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_tree_height_tower</span> <span class="op">&lt;-</span> <span class="fu">extract</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>,</span>
<span>                                  y <span class="op">=</span> <span class="fu">st_buffer</span><span class="op">(</span><span class="va">point_HARV</span>, dist <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>                                  fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mean_tree_height_tower</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  ID HARV_chmCrop
1  1     22.38806</code></pre>
</div>
<div id="challenge-2-extract-raster-height-values-for-plot-locations" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-extract-raster-height-values-for-plot-locations" class="callout-inner">
<h3 class="callout-title">Challenge 2: Extract Raster Height Values For
Plot Locations<a class="anchor" aria-label="anchor" href="#challenge-2-extract-raster-height-values-for-plot-locations"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Use the plot locations object
(<code>plot_locations_sp_HARV</code>) to extract an average tree height
for the area within 20m of each vegetation plot location in the study
area. Because there are multiple plot locations, there will be multiple
averages returned.</p></li>
<li><p>Create a plot showing the mean tree height of each area.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract data at each plot location</span></span>
<span><span class="va">mean_tree_height_plots_HARV</span> <span class="op">&lt;-</span> <span class="fu">extract</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CHM_HARV</span>,</span>
<span>                                       y <span class="op">=</span> <span class="fu">st_buffer</span><span class="op">(</span><span class="va">plot_locations_sp_HARV</span>,</span>
<span>                                                     dist <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>                                       fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view data</span></span>
<span><span class="va">mean_tree_height_plots_HARV</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   ID HARV_chmCrop
1   1          NaN
2   2     23.96756
3   3     22.34937
4   4     16.49739
5   5     21.54419
6   6     19.16772
7   7     20.61651
8   8     21.61439
9   9     12.23006
10 10     19.13398
11 11     21.36966
12 12     19.32084
13 13     17.25975
14 14     20.47120
15 15     12.68301
16 16     15.51888
17 17     18.90894
18 18     18.19369
19 19     19.67441
20 20     20.23245
21 21     20.44984</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_tree_height_plots_HARV</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ID</span>, y <span class="op">=</span> <span class="va">HARV_chmCrop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean Tree Height at each Plot"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"Plot ID"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Tree Height (m)"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_col()`).</code></pre>
</div>
<figure><img src="fig/17-vector-raster-integration-rendered-hist-tree-height-veg-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>crop()</code> function to crop a raster object.</li>
<li>Use the <code>extract()</code> function to extract pixels from a
raster object that fall within a particular extent boundary.</li>
<li>Use the <code>ext()</code> function to define an extent.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-18-plot-time-series-rasters-in-r"><p>Content from <a href="18-plot-time-series-rasters-in-r.html">Create Publication-quality Graphics</a></p>
<hr>
<p>Last updated on 2024-04-23 |
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/episodes/18-plot-time-series-rasters-in-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I deal with multiple raster layers?</li>
<li>How can I create a publication-quality graphic and customize plot
parameters?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a raster stack</li>
<li>Assign custom names to bands in a RasterStack.</li>
<li>Customize raster plots using the <code>ggplot2</code> package.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This episode covers how to customize your raster plots using the
<code>ggplot2</code> package in R to create publication-quality
plots.</p>
<p>First, let’s load the libraries that we will need for this
episode.</p>
<p>We will be using the <code>tidyr</code> package in this episode,
which you might not have used yet!</p>
<p>If you haven’t downloaded <code>tidyr</code> to your R yet, do so now
using:</p>
<p><code>install.packages("tidyr")</code></p>
<p>Once it’s downloaded, load in all the packages for this episode:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">terra</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span></span></code></pre>
</div>
<section id="faceting-plots"><h2 class="section-heading">Faceting plots<a class="anchor" aria-label="anchor" href="#faceting-plots"></a>
</h2>
<hr class="half-width">
<p>There may come a time when you will need to plot several smaller
plots within a larger plot. The result is a plot with facets. These
plots can be useful if you have several variables that you want to show
at once, or if you’re trying to look at maps over time.</p>
<p>We have a time series of raster data that are spread across several
files. These data show the normalized difference vegetation index (NDVI)
from the Harvard Forest Site. We can best visualize these data by using
facets. To do this, we need to read the data in as a “raster stack”.</p>
<p>First, let’s get the list of all the raster files in our time series.
We can do this using the <code>list.files()</code> function. We will
only add files that have a .tif extension to our list. To do this, we
will use the syntax <code>pattern=".tif$"</code>. If we specify
<code>full.names = TRUE</code>, the full path for each file will be
added to the list.</p>
<div id="data-tip" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip"></a>
</h3>
<div class="callout-content">
<p>In the pattern above, the <code>$</code> character represents the end
of a line. Using it ensures that our pattern will only match files that
end in <code>.tif</code>. This pattern matching uses a language called
“regular expressions”, which is beyond the scope of this workshop.</p>
<ul>
<li><a href="https://regexone.com/" class="external-link">Regular expressions
tutorial</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/blob/main/regex.pdf" class="external-link">Regular
expressions cheatsheet</a></li>
</ul>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_path</span> <span class="op">&lt;-</span> <span class="st">"data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI"</span></span>
<span></span>
<span><span class="va">all_NDVI_HARV</span> <span class="op">&lt;-</span> <span class="fu">list.files</span><span class="op">(</span><span class="va">NDVI_HARV_path</span>,</span>
<span>                            full.names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            pattern <span class="op">=</span> <span class="st">".tif$"</span><span class="op">)</span></span></code></pre>
</div>
<p>It’s a good idea to look at the file names that matched our search to
make sure they meet our expectations.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_NDVI_HARV</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/005_HARV_ndvi_crop.tif"
 [2] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/037_HARV_ndvi_crop.tif"
 [3] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/085_HARV_ndvi_crop.tif"
 [4] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/133_HARV_ndvi_crop.tif"
 [5] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/181_HARV_ndvi_crop.tif"
 [6] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/197_HARV_ndvi_crop.tif"
 [7] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/213_HARV_ndvi_crop.tif"
 [8] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/229_HARV_ndvi_crop.tif"
 [9] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/245_HARV_ndvi_crop.tif"
[10] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/261_HARV_ndvi_crop.tif"
[11] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/277_HARV_ndvi_crop.tif"
[12] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/293_HARV_ndvi_crop.tif"
[13] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/309_HARV_ndvi_crop.tif"</code></pre>
</div>
<p>Now we have a list of all GeoTIFF files in the NDVI directory for
Harvard Forest. The number at the start of the filenames represents the
julilan day. Next, we will create a stack of rasters from this list
using the <code>rast()</code> function. This is the same function we use
to read in any raster file.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_stack</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="va">all_NDVI_HARV</span><span class="op">)</span></span>
<span><span class="va">NDVI_HARV_stack</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>class       : SpatRaster 
dimensions  : 5, 4, 13  (nrow, ncol, nlyr)
resolution  : 30, 30  (x, y)
extent      : 239415, 239535, 4714215, 4714365  (xmin, xmax, ymin, ymax)
coord. ref. : UTM Zone 19, Northern Hemisphere 
sources     : 005_HARV_ndvi_crop.tif  
              037_HARV_ndvi_crop.tif  
              085_HARV_ndvi_crop.tif  
              ... and 10 more source(s)
names       : 005_H~_crop, 037_H~_crop, 085_H~_crop, 133_H~_crop, 181_H~_crop, 197_H~_crop, ... 
min values  :        2732,        1534,        1917,        5669,        8685,        8768, ... 
max values  :        5545,        3736,        3600,        6394,        8903,        9140, ... </code></pre>
</div>
<p>We can see from looking that the data that we will need to scale the
values. NDVI data should be a value between 0 and 1 (and it’s currently
a value between 0 and 10,000!):</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_stack</span> <span class="op">&lt;-</span> <span class="va">NDVI_HARV_stack</span><span class="op">/</span><span class="fl">10000</span></span></code></pre>
</div>
<p>Once we have created our RasterStack, we can visualize our data. We
can use the <code>ggplot()</code> command to create a multi-panelled
plot showing each band in our RasterStack. First we need to create a
data frame object. Because there are multiple columns in our data that
are not variables, we will tidy (or “pivot”) the data so that we have a
single column with the NDVI observations. We will use the function
<code>pivot_longer()</code> from the <code>tidyr</code> package to do
this. Since there are so many columns with relevant data, instead of
specifying the columns we want to pivot, we can specify the columns we
<em>don’t</em> want to pivot instead. We do this by specifying
<code>cols = -(x:y)</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_stack_df</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">NDVI_HARV_stack</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">:</span><span class="va">y</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can plot our data using <code>ggplot()</code>. We want to
create a separate panel for each time point in our time series, so we
will use the <code>facet_wrap()</code> function to create a
multi-paneled plot by the <code>variable</code> column:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-ndvi-wrap-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Although this plot is informative, it isn’t something we would expect
to see in a journal publication. The x and y-axis labels aren’t
informative. There is a lot of unnecessary gray background and the
titles of each panel don’t clearly state that the number refers to the
Julian day the data was collected. In this episode, we will customize
this plot above to produce a publication quality graphic. We will go
through these steps iteratively. When we’re done, we will have created
the plot shown below.</p>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-levelplot-time-series-after-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="adjust-the-plot-theme"><h2 class="section-heading">Adjust the Plot Theme<a class="anchor" aria-label="anchor" href="#adjust-the-plot-theme"></a>
</h2>
<hr class="half-width">
<p>The first thing we will do to our plot remove the x and y-axis labels
and axis ticks, as these are unnecessary and make our plot look messy.
We can do this by using a pre-set <code>ggplot</code> theme that
simplifies all plot parameters. We will add the function
<code>theme_void()</code> to tell <code>ggplot</code> that we want to
use this theme.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"NEON Harvard Forest"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-adjust-theme-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Next we will center our plot title and subtitle. We need to do this
<strong>after</strong> the <code>theme_void()</code> layer, because R
interprets the <code>ggplot</code> layers in order. If we first tell R
to center our plot title, and then set the theme to <code>void</code>,
any adjustments we’ve made to the plot theme will be over-written by the
<code>theme_void()</code> function. So first we make the theme
<code>void</code> and then we center the title. We center both the title
and subtitle by using the <code>theme()</code> function and setting the
<code>hjust</code> parameter to 0.5. The <code>hjust</code> parameter
stands for “horizontal justification” and takes any value between 0 and
1. A setting of 0 indicates left justification and a setting of 1
indicates right justification. We can also update the “face” of the
font, to be bold or italics, or bold and italics. To do this, we would
adjust the <code>face</code> parameter.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"NEON Harvard Forest"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-adjust-theme-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Change the plot title (but not the subtitle) to bold font. You can
(and should!) use the help menu in RStudio or any internet resources to
figure out how to change this setting.</p>
<p><em>Hint</em>: Use <code>?element_text()</code> to pull up the help
file and see how you might be able to change the appearance of text in
the <code>theme()</code> function.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Learners can find this information in the help files for the
<code>theme()</code> function. The parameter to set is called
<code>face</code>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"NEON Harvard Forest"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-use-bold-face-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="adjust-the-color-ramp"><h2 class="section-heading">Adjust the Color Ramp<a class="anchor" aria-label="anchor" href="#adjust-the-color-ramp"></a>
</h2>
<hr class="half-width">
<p>Next, let’s adjust the color ramp used to render the rasters. First,
we can change the blue color ramp to a green one that is more visually
suited to our NDVI (greenness) data using the
<code>colorRampPalette()</code> function in combination with
<code>colorBrewer</code> which requires loading the
<code>RColorBrewer</code> library.</p>
<p>If you don’t have the <code>RColorBrewer</code> library yet, install
it using:</p>
<p><code>install.packages("RColorBrewer")</code></p>
<p>Now we need to create a set of colors to use.</p>
<p>We can view the palettes available in <code>RColorBrewer</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">display.brewer.all</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-display-color-brewer-options-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We will select a set of nine colors from the “YlGn” (yellow-green)
color palette. This returns a set of hex color codes:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="fu">brewer.pal</span><span class="op">(</span><span class="fl">9</span>, <span class="st">"YlGn"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "#FFFFE5" "#F7FCB9" "#D9F0A3" "#ADDD8E" "#78C679" "#41AB5D" "#238443"
[8] "#006837" "#004529"</code></pre>
</div>
<p>Then we will pass those color codes to the
<code>colorRampPalette</code> function, which will interpolate from
those colors a more nuanced color range.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">green_colors</span> <span class="op">&lt;-</span> <span class="fu">brewer.pal</span><span class="op">(</span><span class="fl">9</span>, <span class="st">"YlGn"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">colorRampPalette</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>We can tell the <code>colorRampPalette()</code> function how many
discrete colors within this color range to create. In our case, we will
use 20 colors when we plot our graphic. We can specify this in the
<code>scale_fill_gradientn()</code> function.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">green_colors</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"NEON Harvard Forest"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-change-color-ramp-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The yellow to green color ramp visually represents NDVI well given
it’s a measure of greenness. Someone looking at the plot can quickly
understand that pixels that are more green have a higher NDVI value.</p>
<div id="data-tip-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip-1" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip-1"></a>
</h3>
<div class="callout-content">
<p>For all of the <code>brewer.pal</code> ramp names see the <a href="https://www.datavis.ca/sasmac/brewerpal.html" class="external-link">brewerpal
page</a>.</p>
</div>
</div>
</div>
<div id="data-tip-2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-tip-2" class="callout-inner">
<h3 class="callout-title">Data Tip<a class="anchor" aria-label="anchor" href="#data-tip-2"></a>
</h3>
<div class="callout-content">
<p>Cynthia Brewer, the creator of ColorBrewer, offers an online tool to
help choose suitable color ramps, or to create your own. <a href="https://colorbrewer2.org/" class="external-link">ColorBrewer 2.0; Color Advise for
Cartography</a></p>
</div>
</div>
</div>
</section><section id="refine-plot-tile-labels"><h2 class="section-heading">Refine Plot &amp; Tile Labels<a class="anchor" aria-label="anchor" href="#refine-plot-tile-labels"></a>
</h2>
<hr class="half-width">
<p>Next, let’s label each panel in our plot with the Julian day that the
raster data for that panel was collected. The current names come from
the band “layer names” stored in the <code>RasterStack</code> and the
first part of each name is the Julian day.</p>
<p>To create a more meaningful label we can remove the pieces of the
label we don’t want and replace it with something we do by using the
<code>gsub()</code> function in R. The syntax is as follows:
<code>gsub("StringToReplace", "TextToReplaceIt", object)</code>.</p>
<p>First let’s remove “_HARV_NDVI_crop” from each label to make the
labels shorter and remove repetition. To illustrate how this works, we
will first look at the names for our <code>NDVI_HARV_stack_df</code>
object in the <code>variable</code> column:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unique</span><span class="op">(</span><span class="va">NDVI_HARV_stack_df</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "005_HARV_ndvi_crop" "037_HARV_ndvi_crop" "085_HARV_ndvi_crop"
 [4] "133_HARV_ndvi_crop" "181_HARV_ndvi_crop" "197_HARV_ndvi_crop"
 [7] "213_HARV_ndvi_crop" "229_HARV_ndvi_crop" "245_HARV_ndvi_crop"
[10] "261_HARV_ndvi_crop" "277_HARV_ndvi_crop" "293_HARV_ndvi_crop"
[13] "309_HARV_ndvi_crop"</code></pre>
</div>
<p>Now we will use the <code>gsub()</code> function to find the
character string “_HARV_ndvi_crop” and replace it with a blank string
(““). We will assign this output to a new column
(<code>panel_name</code>) using the <code>mutate()</code> function and
look at that column to sure our code is doing what we want it to.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_stack_df</span> <span class="op">&lt;-</span> <span class="va">NDVI_HARV_stack_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>panel_name <span class="op">=</span> <span class="fu">gsub</span><span class="op">(</span><span class="st">"_HARV_ndvi_crop"</span>, <span class="st">""</span>, <span class="va">variable</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">NDVI_HARV_stack_df</span><span class="op">$</span><span class="va">panel_name</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "005" "037" "085" "133" "181" "197" "213" "229" "245" "261" "277" "293"
[13] "309"</code></pre>
</div>
<p>So far so good. Now let’s use the <code>paste()</code> function to
add the word “Day” in front of each of those numbers:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_stack_df</span> <span class="op">&lt;-</span> <span class="va">NDVI_HARV_stack_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>panel_name <span class="op">=</span> <span class="fu">paste</span><span class="op">(</span><span class="st">"Day"</span>, <span class="va">panel_name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">NDVI_HARV_stack_df</span><span class="op">$</span><span class="va">panel_name</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "Day 005" "Day 037" "Day 085" "Day 133" "Day 181" "Day 197" "Day 213"
 [8] "Day 229" "Day 245" "Day 261" "Day 277" "Day 293" "Day 309"</code></pre>
</div>
<p>Our labels look good now. Let’s render our plot again. This time,
we’ll facet by the <code>panel_name</code> column.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">panel_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">green_colors</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"NEON Harvard Forest"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-create-levelplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="change-layout-of-panels"><h2 class="section-heading">Change Layout of Panels<a class="anchor" aria-label="anchor" href="#change-layout-of-panels"></a>
</h2>
<hr class="half-width">
<p>We can adjust the columns of our plot by setting the number of
columns <code>ncol</code> and the number of rows <code>nrow</code> in
<code>facet_wrap</code>. Let’s make our plot so that it has a width of
five panels.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">panel_name</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">green_colors</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"NEON Harvard Forest"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-adjust-layout-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now we have a beautiful, publication quality plot!</p>
<p>We can save this plot using the <code>ggsave()</code> function.
Remember that by default R will save the last rendered plot. We can
specify the height, width, and dpi for the figure when we save it. This
makes it super easy to meet your target journal’s figure formatting
requirements.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"figures/time_series_NDVI.png"</span>, </span>
<span>       height <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-2-divergent-color-ramps" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-divergent-color-ramps" class="callout-inner">
<h3 class="callout-title">Challenge 2: Divergent Color Ramps<a class="anchor" aria-label="anchor" href="#challenge-2-divergent-color-ramps"></a>
</h3>
<div class="callout-content">
<p>When we used the <code>paste()</code> function to modify the tile
labels we replaced the beginning of each tile title with “Day”. A more
descriptive name could be “Julian Day”. Update the plot above with the
following changes:</p>
<ol style="list-style-type: decimal">
<li>Label each tile “Julian Day” with the julian day value
following.</li>
<li>Change the color ramp to a divergent brown to green color ramp.</li>
</ol>
<p><strong>Questions:</strong> Does having a divergent color ramp
represent the data better than a sequential color ramp (like “YlGn”)?
Can you think of other data sets where a divergent color ramp may be
best?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NDVI_HARV_stack_df</span> <span class="op">&lt;-</span> <span class="va">NDVI_HARV_stack_df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>panel_name <span class="op">=</span> <span class="fu">gsub</span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Julian Day"</span>, <span class="va">panel_name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brown_green_colors</span> <span class="op">&lt;-</span> <span class="fu">colorRampPalette</span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="fl">9</span>, <span class="st">"BrBG"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">NDVI_HARV_stack_df</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">panel_name</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">brown_green_colors</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Landsat NDVI - Julian Days"</span>, </span>
<span>       subtitle <span class="op">=</span> <span class="st">"Harvard Forest 2011"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, </span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="fig/18-plot-time-series-rasters-in-r-rendered-final-figure-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>For NDVI data, the sequential color ramp is better than the divergent
as it is more akin to the process of greening up, which starts off at
one end and just keeps increasing.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>theme_void()</code> function for a clean background to
your plot.</li>
<li>Use the <code>element_text()</code> function to adjust text size,
font, and position.</li>
<li>Use the <code>brewer.pal()</code> function to create a custom color
palette.</li>
<li>Use the <code>gsub()</code> function to do pattern matching and
replacement in text and the <code>paste()</code> function to add to your
current text.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/" class="external-link">Source</a></p>
				<p><a href="https://github.com/echelleburns/2024-07-01-ucsb-intro-geospatial/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.3" class="external-link">sandpaper (0.16.3)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.4" class="external-link">pegboard (0.7.4)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://echelleburns.github.io/2024-07-01-ucsb-intro-geospatial/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://echelleburns.github.io/2024-07-01-ucsb-intro-geospatial/aio.html",
  "identifier": "https://echelleburns.github.io/2024-07-01-ucsb-intro-geospatial/aio.html",
  "dateCreated": "2024-04-02",
  "dateModified": "2024-06-28",
  "datePublished": "2024-06-28"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

